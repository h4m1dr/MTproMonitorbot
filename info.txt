ุจุงุดูุ ุจุฐุงุฑ ุฌูุนโุจูุฏ ฺฉูู ฺฉู ุงู ุฏู ุชุง ูพุฑูฺู **ุงุฒ ูฺฏุงู MTProto / MTProxy ุฑู ุณุฑูุฑ** ฺู ุฑููุฏ ุฑู ุท ูโฺฉููุ ุงุฒ ูุญุธูโุง ฺฉู ูพุฑูฺฉุณ ุณุงุฎุชู ูโุดู ุชุง ููุช ุจูโุนููุงู ุณุฑูุณ ุฑู ุณุฑูุฑ ุจุงูุง ูุงุฏ ู ุจุนุฏ ุชูุณุท ุจุงุช ูุฏุฑุช ูโุดู.

---

## ฑ. ุชุตูุฑ ฺฉู ุฏู ูพุฑูฺู

### โ ูพุฑูฺู ุงูู: `telegram-proxy-specifier-bot` ([GitHub][1])

ุงู ูพุฑูฺู ุฎูุฏุด **MTProxy ุฑู ูุตุจ ุง ุณุฑูุณ ููโฺฉูู**ุ
ุจูฺฉู:

* ูุฑุถ ูโฺฏุฑู ุชู ู ุณุฑูุฑ **ูุจูุงู MTProxy ูุตุจ ุดุฏู ู ุจูโุตูุฑุช ุณุฑูุณ (ูุซูุงู systemd) ุฏุงุฑู ฺฉุงุฑ ูโฺฉูู**.
* ุจุงุช ุจุง ุงุณุชูุงุฏู ุงุฒ **SSH** ุจู ุณุฑูุฑ MTProxy ูุตู ูโุดู ู:

  * ูพุฑูฺฉุณ ุจุฑุง ูุฒุฑ ูโุณุงุฒู
  * ููุช ุงุฒ ฺฉุงูุงู ููุช ุจุฏูุ ุฏุณุชุฑุณโุงุด ุฑู ูโฺฏุฑู
* `setup.sh` ูู (ุจุง ุชูุฌู ุจู README) ุจุดุชุฑ ุจุฑุง:

  * ูุตุจ Python ู ูพฺฉุฌโูุง
  * ุชูุธู `.env`
  * ุณุงุฎุช ุณุฑูุณ ุจุฑุง ุฎูุฏ ุจุงุช (ูู ุฎูุฏ MTProxy)
    ุงุณุชูุงุฏู ูโุดู. ([GitHub][1])

ูพุณ ุงูุฌุง **ุณุฑูุณโุณุงุฒ MTProxy ุฎุงุฑุฌ ุงุฒ ุงู ุฑูพู ุงูุฌุงู ุดุฏู**ุ ุงู ุจุงุช ููุท ุฑูุด ุณูุงุฑ ูโุดู ู ุงุฒ ุจุฑูู ฺฉูุชุฑูุด ูโฺฉูู.

---

### โ ูพุฑูฺู ุฏูู: `mtproxybot` ([GitHub][2])

ุงู ูพุฑูฺู ูู **ุฎูุฏุด MTProto core ุฑู ูุตุจ ููโฺฉูุฏ**ุ
ุชู README ุตุฑุงุญุชุงู ฺฏูุชู:

> 1. Install the **MTProtoProxyInstaller** project ([GitHub][2])

ุนู ุฑููุฏ ุจู ุงู ุดฺฉู ุงุณุช:

1. ุดูุง ุงูู ุจุง ูพุฑูฺูโ ุฌุฏุงฺฏุงููโ `MTProtoProxyInstaller`ุ **ุฎูุฏ MTProxy ุฑู ุฑู ุณุฑูุฑ ูุตุจ ู ุจูโุนููุงู ุณุฑูุณ ุฑุงู ูโุงูุฏุงุฒุฏ** (ูุนูููุงู ุจุง systemd).
2. ุจุนุฏ:

   * Node.js ุฑู ูุตุจ ูโฺฉูุฏ
   * ุงู ุฑูพู ุฑู ฺฉููู ูโฺฉูุฏ
   * `npm i` ู `npm start` ุง ุจุง `pm2` ุจูโุตูุฑุช ุณุฑูุณ NodeJS ุจุงูุง ูโุขุฑุฏ ([GitHub][2])
3. ุงู ุจุงุชุ ุฑู ูููู ุณุฑูุฑ ฺฉู MTProxy ูุตุจ ุดุฏู ุงุฌุฑุง ูโุดู ู ุจุง ุงุณฺฉุฑูพุชโูุง / ูุงูโูุง MTProxy ุงุฑุชุจุงุท ูโฺฏุฑู ุชุง:

   * ูพุฑูฺฉุณ ุจุณุงุฒู
   * ูุณุช ฺฉูู
   * ุญุฐู ฺฉูู
   * ูโฆ

---

## ฒ. ุฑููุฏ ยซููุดุชู / ุฑุงูโุงูุฏุงุฒ MTProxyยป ุชุง ยซุณุฑูุณ ุดุฏู ุฑู ุณุฑูุฑยป

ุญุงูุง ุงฺฏุฑ ุจุฎูุง ููุท **ุฑููุฏ ฺฉู MTProxy** ุฑู (ุจุง ุงููุงู ุงุฒ ุงู ุฏู ูพุฑูฺู) ุจูููุ ุชูุฑุจุงู ุงู ุณูุงุฑู ุงุชูุงู ูโุงูุชู:

### ูุฑุญูู ฑ โ ูุตุจ ูุณุชูโ MTProto / MTProxy ุฑู ุณุฑูุฑ

* ุง ุงุฒ ูพุฑูฺูโุง ูุซู `MTProtoProxyInstaller` ุงุณุชูุงุฏู ูโฺฉู (ฺฉู ุฏุฑ README ูพุฑูฺูโ ุฏูู ุจูุด ุงุดุงุฑู ุดุฏู). ([GitHub][2])
* ุง ุฎูุฏุช ุฏุณุช:

  * ุณูุฑุณ MTProxy ุฑู ฺฉููู ูโฺฉู
  * ฺฉุงููพุงู ูโฺฉู (ูุซูุงู ุจุง `make`)
  * ุจุงูุฑ ููุง ุฑู ูโุฐุงุฑ ุชู `/usr/local/bin/` ุง ูุดุงุจู

ุฎุฑูุฌ ุงู ูุฑุญูู:
ฺฉ ุจุงูุฑ/ุงุณฺฉุฑูพุช ฺฉู ูโุชููู MTProxy ุฑู ุจุง ูพุงุฑุงูุชุฑูุง ูุงุฒู (port, secret, tag, โฆ) ุงุฌุฑุง ฺฉูู.

---

### ูุฑุญูู ฒ โ ุชูุธู ูพุงุฑุงูุชุฑูุง ู ฺฉุงููฺฏ MTProxy

ูุนูููุงู ฺุฒูุง ฺฉู ูุงุฒ ุฏุงุฑ:

* IP ุณุฑูุฑ
* ูพูุฑุช MTProxy (ูุซูุงู 443 ุง ู ูพูุฑุช ุฏูุฎูุงู)
* **secret** (ูููู ฺฉูุฏ ูพุฑูฺฉุณ)
* **ad tag** (ุงุฎุชุงุฑุ ุจุฑุง ุชุจูุบุงุช ุฏุฑ ุงูพ ุฑุณู ุชูฺฏุฑุงู)
* mode (TLS, classic, โฆ)

ุฏุฑ ูพุฑูฺูโูุง ูุงูุน:

* ุงู ููุงุฏุฑ ุง ุฏุงุฎู **ูุงู ฺฉุงููฺฏ** ุฐุฎุฑู ูโุดู
* ุง ุงุฒ ุทุฑู ูุชุบุฑ ูุญุท / ุขุฑฺฏููุงู ุฎุท ูุฑูุงู ูพุงุณ ุฏุงุฏู ูโุดู
* ู ุฏุฑ ุงู ุฏู ูพุฑูฺูุ **ุจุงุช** ุจุนุฏุงู ุจุง ููู ฺุฒูุง ููฺฉ ูโุณุงุฒู ู ุจู ูุฒุฑ ูโุฏู.

---

### ูุฑุญูู ณ โ ุณุงุฎุช ุณุฑูุณ ุณุณุชู (systemd ุง pm2)

ุญุงูุง ุจุฑุง ุงูฺฉู MTProxy ููุดู ุจุงูุง ุจุงุดู ู ุจุง ุฑุจูุช ุณุฑูุฑ ุฎูุฏุด ุงุณุชุงุฑุช ุจุดูุ ุฏู ุฑูุด ุงุตู ุงุณุชูุงุฏู ูโุดู:

#### ุงูู) ุณุฑูุณ ูููฺฉุณ ุจุง systemd (ุฑุงุฌ ุฏุฑ installerูุง)

ุงู ฺฉุงุฑู ฺฉู ูุนูููุงู ูพุฑูฺูโูุง ูุซู `MTProtoProxyInstaller` ุงูุฌุงู ูโุฏู:

1. ู ูุงู ุณุฑูุณ ูุซู `/etc/systemd/system/mtproxy.service` ูโุณุงุฒู ฺฉู ุฏุงุฎูุด ูุซูุงู ฺุฒ ุดุจู ุงูู (ุจูโุตูุฑุช ฺฉูุ ูู ุฏูู):

```ini
[Unit]
Description=MTProto Proxy Server
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/mtproto-proxy -p 443 -H 443 -S <SECRET> --aes-pwd /path/to/secret --nat-info <IP>:<PORT>
Restart=always
User=mtproxy

[Install]
WantedBy=multi-user.target
```

2. ุจุนุฏ:

   * `systemctl daemon-reload`
   * `systemctl enable mtproxy`
   * `systemctl start mtproxy`

ูุชุฌู: MTProxy ุงุฒ ุงู ุจู ุจุนุฏ ูุซู ูุฑ ุณุฑูุณ ุฏฺฏู ุฑู ุณุฑูุฑ ููุดู ูุนุงูู.

#### ุจ) ุณุฑูุณ NodeJS ุจุง pm2 (ุจุฑุง ุฎูุฏ ุจุงุช ุฏุฑ `mtproxybot`) ([GitHub][2])

* ุชู ูพุฑูฺูโ ุฏููุ ุฎูุฏ **ุจุงุช NodeJS** ุจุง `pm2` ุจู ุดฺฉู ุณุฑูุณ ุงุฌุฑุง ูโุดู:

  * ูุตุจ pm2: `npm i pm2 -g` ([GitHub][2])
  * ุงุฌุฑุง ุฏุงุฆู: `pm2 start app.js` (ุง ุจุง `ecosystem.config.js`)
* ุงู ูุฑุญูู ูุฑุจูุท ุจู ุฎูุฏ **ุจุงุช**ูุ ูู ุฎูุฏ MTProxyุ ูู ุงูฺฏู ูุดุงุจู ูููู ยซุณุฑูุณ ฺฉุฑุฏูยปู.

---

### ูุฑุญูู ด โ ุงุชุตุงู ุจุงุช ุจู MTProxy ููุฌูุฏ ุฑู ุณุฑูุฑ

ุญุงูุง ฺฉู MTProxy ุฑู ุณุฑูุฑ ุจูโุนููุงู ุณุฑูุณ ุจุงูุง ุงุณุช:

#### ุฏุฑ `telegram-proxy-specifier-bot` ([GitHub][1])

* ุชู `.env` ุงุญุชูุงูุงู ุงุทูุงุนุงุช ูุซู:

  * ุขุฏุฑุณ ุณุฑูุฑ MTProxy
  * ูพูุฑุช SSH
  * ูุงู ฺฉุงุฑุจุฑ / ฺฉูุฏ SSH
* ุฎูุฏ ุจุงุช (Python) ุงุฒ ุทุฑู SSH:

  * ุจุฑุง ูุฒุฑ ุฌุฏุฏุ ฺฉ secret ุฌุฏุฏ ุชููุฏ ูโฺฉูุฏ ุง ุงุฒ ฺฉ ุณุงุฎุชุงุฑ ุงุฒ ูุจู ุชุนุฑูโุดุฏู ุงุณุชูุงุฏู ูโฺฉูุฏ
  * ุฏุณุชูุฑูุง ูุซู:

    * ุงุถุงูู ฺฉุฑุฏู secret ุฌุฏุฏ ุจู ูุณุช ูุฌุงุฒ (ุจุณุชู ุจู ุณุงุฎุชุงุฑ MTProxy ฺฉู ูุจูุงู ูุตุจ ุดุฏู)
    * ุฑโููุฏ ุง ุฑโุงุณุชุงุฑุช ุณุฑูุณ MTProxy ุฏุฑ ุตูุฑุช ูุฒูู
  * ููุช ูุฒุฑ ฺฉุงูุงู ุฑู ุชุฑฺฉ ูโฺฉูู:

    * secret ูุฑุจูุท ุจู ุงูู ูุฒุฑ ุฑู ุญุฐู ูโฺฉูู
    * ูุฌุฏุฏุงู ุณุฑูุณ ุฑู ุฑโููุฏ / ุฑโุงุณุชุงุฑุช ูโฺฉูู ุชุง ุฏฺฏู ุฏุณุชุฑุณ ูุฏุงุดุชู ุจุงุดู

ุนู:
**ุณุฑูุณ MTProxy ุงุฒ ูุจู ูุณุชุ ุงู ุจุงุช ููุท ุจุงูุงุด ุตุญุจุช ูโฺฉูู.**

---

#### ุฏุฑ `mtproxybot` ([GitHub][2])

* ุงูู ุทุจู README ูโฺฏ:
  `MTProtoProxyInstaller` ุฑู ูุตุจ ฺฉู โ ุงูู MTProxy ุฑู ุณุฑูุณ ูโฺฉูู. ([GitHub][2])
* ุจุนุฏ ุจุงุช NodeJS:

  * ุชู `.env` ููุท ุชูฺฉู ุจุงุช ู ูุณุช ุงุฏููโูุง ุฑู ูโุฐุงุฑ (`TOKEN`, `USER_IDS`). ([GitHub][2])
  * ุฏุงุฎู `app.js` (ฺฉู ูุญุชูุงุด ุงูุฌุง ูุงุจู ุฏุฏู ูุณุชุ ูู ุงุฒ ุชูุถุญุงุช README ูโุดู ูููุฏ):

    * ุจุงุช ุงุฒ ุทุฑู ููููุง / ุฏุณุชูุฑุงุชุ ุจู ุงุฏูู ุงุฌุงุฒู ูโุฏู:

      * ุณุงุฎุช / ูุฏุฑุช ูพุฑูฺฉุณโูุง
      * ููุงุด ูุณุช
      * ุงุญุชูุงูุงู change port / secret ู...
    * ุงู ฺฉุงุฑูุง ูุนูููุงู ุจุง:

      * ุงุฌุฑุง ุงุณฺฉุฑูพุชโูุง MTProtoProxyInstaller
      * ุง ูุฑุงุด ูุงูโูุง config ูุฑุจูุท ุจู ุงูู
      * ู ุฏุฑ ููุงุช ุฑโููุฏ/ุฑโุงุณุชุงุฑุช ุณุฑูุณ
        ุงูุฌุงู ูโุดู.

ุงูุฌุง ูู ุงูฺฏู ููููู:
**ุณุฑูุณ MTProxy ุฌุฏุง ูุตุจ ู ุณุฑูุณ ุดุฏูุ ุจุงุช ููุท ฺฉูุชุฑูโูพูู ุชูฺฏุฑุงูโุดู.**

---

## ณ. ุงฺฏุฑ ุฎูุฏุช ุจุฎูุง ฺุฒ ุดุจู ุงู ุฏู ุชุง ุจุณุงุฒุ ุฑููุฏ ฺฉูโุงุด ุงู ูโุดู

ุจุง ุงููุงู ุงุฒ ุงู ุฏู ุฑูพูุ ฺฉ ููู ุงุณุชุงูุฏุงุฑุฏ ุจุฑุง ูพุฑูฺูโ ุดุฎุต ุฎูุฏุช:

1. **ุฑู ุณุฑูุฑ: ูุตุจ MTProxy**

   * ุง ุจุง ฺฉ installer ุขูุงุฏู
   * ุง ุฏุณุช (clone + build + systemd service)

2. **ุณุฑูุณ ฺฉุฑุฏู MTProxy**

   * ุณุงุฎุช ูุงู `mtproxy.service` (ุง ูุดุงุจู)
   * `enable` + `start` ฺฉุฑุฏู ุณุฑูุณ

3. **ููุดุชู ุจุงุช (NodeJS / Python / ูุฑฺ)**

   * ฺฏุฑูุชู ุชูฺฉู ุงุฒ `@BotFather`
   * ูุดุฎุต ฺฉุฑุฏู adminูุง (ูุซู `USER_IDS` ุฏุฑ ูพุฑูฺู ุฏูู) ([GitHub][2])

4. **ูพู ุฒุฏู ุจู ุจุงุช ู ุณุฑูุณ MTProxy**

   * ุง ุจุง `SSH` ุจู ุณุฑูุฑ ู ุงุฌุฑุง ุฏุณุชูุฑูุง (ูุซู ูพุฑูฺู ุงูู)
   * ุง ุจุง ุงุฌุฑุง ูุณุชูู ุงุณฺฉุฑูพุชโูุง ููฺฉุงู / ูุฑุงุด ูุงู config (ูุซู ุงูฺฏู ูพุฑูฺู ุฏูู)

5. **ุณุฑูุณ ฺฉุฑุฏู ุจุงุช**

   * ุงฺฏุฑ Python ูุณุช โ `systemd` ุณุฑูุณ ุจุฑุง `bot.py`
   * ุงฺฏุฑ NodeJS ูุณุช โ `pm2` ุง ุจุงุฒ ูู `systemd` ุจุฑุง `app.js` ([GitHub][2])

6. ุงุฒ ุงูุฌุง ุจู ุจุนุฏ:

   * ูุฑ event ุฏุฑ ุจุงุช (join/leave ฺฉุงูุงูุ ุฏุณุชูุฑ admin) โ
     ฺฉ ุนููุงุช ุฑู MTProxy (ุณุงุฎุช/ุญุฐู secretุ ุฑโููุฏ ุณุฑูุณ ูโฆ).

---

ุงฺฏู ุฏูุณุช ุฏุงุดุชู ุจุงุดุ ุชู ู ูพุงู ุจุนุฏ ูโุชููู ุจุฑุงุช **ูุฏูโุจูโูุฏู ฺฉ ุณูุงุฑู ูุงูุน** ุจููุณูุ ูุซูุงู:

* Ubuntu ุณุฑูุฑ
* ูุตุจ MTProxy
* ุณุงุฎุช systemd service
* ููุดุชู ู ุจุงุช ุฎู ูููุงู (Python ุง Node) ฺฉู ุจุง ู ุฏุณุชูุฑ `/new` ฺฉ secret ุฌุฏุฏ ุจุณุงุฒู ู ุณุฑูุณ ุฑู ุฑโููุฏ ฺฉูู.

[1]: https://github.com/rraammiinn/telegram-proxy-specifier-bot "GitHub - rraammiinn/telegram-proxy-specifier-bot"
[2]: https://github.com/mmdzov/mtproxybot "GitHub - mmdzov/mtproxybot: Manage your mtproto proxies in Telegram bot"





ฺฉูุงู ุจููุ ุงู ูพุฑูฺู **ุฎูุฏู MTProto Proxy ุฑู ูุตุจ ููโฺฉูู**ุ ููุท ฺฉ **ุจุงุช ูุงูุชูุฑูฺฏ + ุงูุณุชุงูุฑ ุฎูุฏุด**ู. ูพุณ ุงฺฏุฑ ุฑู ุณุฑูุฑ ูฺ MTProxyุง ูุฏุงุดุชู ุจุงุดุ ุงู ููุท ูโุชููู ุจุงูุง ุจุงุฏ ู ุจฺฏู ยซMTProxy ูพุฏุง ูฺฉุฑุฏู!ยป ๐

ุจุงุฑ ูุฏูโุจูโูุฏู ูฺฏุงู ฺฉูู ุจุจูู ฺ ฺฉุงุฑ ูโฺฉูู ู ฺฉุฌุง ููฺฉูู ูุดฺฉู ุจุฎูุฑู.

---

## ฑ. ุงู ุฑูพู ุฏููุงู ฺ ูุณุชุ

ุชู README ฺฉุงููุงู ูุงุถุญ ููุดุชู: ุงู ู **auto installer ู manager ุจุฑุง MTPro Monitor Bot** ููุ ุนู: ([GitHub][1])

* ูุตุจ ุฎูุฏ ุจุงุชุ ูพุดโูุงุฒูุง ู pm2
* ููู ูุฏุฑุช pm2 (Start/Stop/Restart/Status) ([GitHub][1])
* ยซMTProxy detectionยป ุฏุงุฎู status bar (ููุท ุชุดุฎุต ูโุฏู MTProxy ูุณุช ุง ูู) ([GitHub][1])

ูฺโุฌุง ูฺฏูุชู:

* MTProto Proxy ูุตุจ ูโฺฉูู
* ุณุฑูุณ MTProxy ูโุณุงุฒู
* secret / port / tag ุจุฑุง MTProxy ูโุณุงุฒู

ูพุณ **ุงู ุฑูพู ููุท:**

1. Node.js + npm + pm2 ุฑู ูุตุจ ูโฺฉูู
2. ฺฉุฏ ุจุงุช ุฑู ุงุฒ GitHub ูโฺฉุดูุ `npm install` ูโุฒููุ ุชูฺฉู ุฑู ุชู `bot/index.js` ุณุช ูโฺฉูู ([GitHub][1])
3. ุจุง pm2 ุจุงุช ุฑู ุจู ุนููุงู ุณุฑูุณ ุจุงูุง ูโุขุฑู (ูุซูุงู `pm2 start bot/index.js --name mtpromonitorbot`) ([GitHub][1])

---

## ฒ. ุฌูุงุจ ุณุคุงู ุงุตูุช

> ูพุณ ุนู ุงู ูพุฑูฺู ูู ุจุงุฏ ุงูู ุงู ุช ูพุฑู ูพุฑูฺฉุณ ุฑู ูุตุจ ฺฉููุ

โ **ุขุฑูุ ุฏููุงู.**
ุงู ุจุงุช ููุท **ูููุชูุฑ**โูุ ุนู ูุฑุถุด ุงูู ฺฉู:

* ูุจูุงู ุฑู ููู ุณุฑูุฑุ ฺฉ ุง ฺูุฏ ุชุง **MTProto Proxy** ูุตุจ ู ุจูโุตูุฑุช ุณุฑูุณ ุฏุงุฑู ฺฉุงุฑ ูโฺฉูู (ูุซูุงู ุจุง ู ุงูุณุชุงูุฑ ุฌุฏุงุ ุง ุฏุณุช ุจุง systemd).
* ุงุณฺฉุฑูพุชโูุง ุฏุงุฎู `scripts/` ููุท ูุถุนุช MTProxy ุฑู **ฺฺฉ ูโฺฉูู** (ูพุฑูุณุณุ ูพูุฑุชุ ูุงฺฏุ โฆ)ุ ูู ุงูฺฉู ุฎูุฏุดูู ูุตุจุด ฺฉูู. ุงุฒ README ููุท ูโูููู ยซMTProxy detectionยป ุฏุงุฑูุ ูู ูุตุจ. ([GitHub][1])

ุงฺฏุฑ ุฑู ู VPS ุฎุงู ุงู ุงุณฺฉุฑูพุช ุฑู ุงุฌุฑุง ฺฉูุ ุจู ุงุญุชูุงู ุฒุงุฏ:

* ุชู status bar ูโุฒูู: `MTProxy: Not detected`
* ฺฏุฑุงูโูุง ู ุขูุงุฑูุง ฺุฒ ูุดูู ููโุฏูุ ฺูู ูพุฑูฺฉุณโุง ุจุฑุง ูุงูุชูุฑ ฺฉุฑุฏู ูุฌูุฏ ูุฏุงุฑู.

---

## ณ. ยซูุดฺฉูุด ฺูุยป โ ุนุจโุงุจ ุงุฒ ุฏุฏ ููุทู ูพุฑูฺู

ุฎูุฏ ุฑูพู ุงุฒ ูุธุฑ ุทุฑุงุญ ุงุฑุงุฏ ููุทู ุฎุงุต ูุฏุงุฑูุ ูุดฺฉู ูุนูููุงู ฺฉ ุงุฒ ุงูุงุณุช:

### ูุดฺฉู ฑ โ ุงูุชุธุงุฑ ุงุดุชุจุงู ุงุฒ ุฑูพู

ุงฺฏุฑ ูฺฉุฑ ฺฉู ยซุงู ุงุณฺฉุฑูพุช ุจุฑุงู MTProxy ูุตุจ ูโฺฉูู + ุจุงุช ูุงูุชูุฑูฺฏยปุ ุงููโููุช:

* MTProxy ุฑู ูุตุจ ููโฺฉูู โ
* ุจุงุช ุจุงูุง ูโุขุฏ ูู ููุดู ูโฺฏู MTProxy ูุฌูุฏ ูุฏุงุฑู / ุฏุชุง ูุฏุงุฑู โ
* ุชู ูฺฉุฑ ูโฺฉู ูพุฑูฺู ุฎุฑุงุจูุ ุฏุฑุญุงูโฺฉู ููุท ูุตู ุฒูุฌุฑู ุฑู ุฏุงุฑ.

๐ ุฑุงูโุญู:
ุงูู ุจุง ู ุงูุณุชุงูุฑ ุฏฺฏู (ุง ุฏุณุช) MTProto Proxy ุฑู ูุตุจ ฺฉูุ ุณุฑูุณุด ุฑู ูุนุงู ฺฉูุ ุจุนุฏ ุงู ูุงูุชูุฑ ุฑู ูุตุจ ฺฉู ุชุง ุจู ุฏุฑุฏ ุจุฎูุฑู.

---

### ูุดฺฉู ฒ โ MTProxy ูุตุจ ูุณุช ูู ูุงูุชูุฑ ููโุชููู ูพุฏุงุด ฺฉูู

ฺูู ููโุชููู ุฎูุฏ ุงุณฺฉุฑูพุชโูุง `scripts/` ุฑู ุงุฒ GitHub ุจุฎููู (GitHub ุชู HTML ุงู ุจุฎุด ุฑู ุฏุฑุณุช ุฑูุฏุฑ ูฺฉุฑุฏู ู ูุญุชูุง ูุงูโูุง ุชู ุฎุฑูุฌ ุงุณุชุงุชฺฉ ูููุฏู)ุ ุฏูู ููโุชููู ุจฺฏู ุฏููุงู ุงุฒ ฺู ุฏุณุชูุฑ ุจุฑุง detection ุงุณุชูุงุฏู ฺฉุฑุฏูุ ุงูุง ุจูโุตูุฑุช ูุนููู ฺฉ ุงุฒ ุงู ฺฉุงุฑูุง ุงูุฌุงู ูโุดู:

* `ps aux | grep mtproto` ุง ุงุณู ุณุฑูุณ
* ุง `systemctl is-active mtproto-proxy` / ุงุณู ูุดุงุจู
* ุง ฺฺฉ ฺฉุฑุฏู ฺฉ ูพูุฑุช ุฎุงุต (ูุซูุงู ดดณ) ุจุง `ss` / `netstat`

ุฌุง ฺฉู ููฺฉูู mismatch ุจุดู:

* ุงุณู ุณุฑูุณ ุชู ุณุฑูุฑ ุชู: ูุซูุงู `mtproxy.service`
* ูู ุงุณฺฉุฑูพุช ุฏูุจุงู `mtprotod.service` ุง ู ุงุณู ุฎุงุต ุฏฺฏู ูโฺฏุฑุฏู
* ุง ูพุฑูฺฉุณ ุฑู ูพูุฑุช ุฏฺฏุฑูุ ูู ุงุณฺฉุฑูพุช ููุท ูพูุฑุช ุฏูุงูุช ุฑู ฺฺฉ ูโฺฉูู

๐ ุฑุงูโุญู ฺฉู ฺฉู ูพุดููุงุฏ ูโุฏู:

1. ุงูู ูุทูุฆู ุดู ูพุฑูฺฉุณ ูุงูุนุงู ุจุงูุง ุงุณุช:

   * `systemctl status mtproxy` (ุง ูุฑ ุงุณู ฺฉู ุฎูุฏุช ุฏุงุฏ)
   * ุง `ps aux | grep mtproto`
   * ุงุฒ ุชู ุชูฺฏุฑุงู ุจุง ููฺฉ ุฏุณุช ูุตู ุดู ุจุจู ฺฉุงุฑ ูโฺฉูู ุง ูู

2. ุจุนุฏ ุฑู ุณุฑูุฑ ูููู ุงุณฺฉุฑูพุช detection (ูุซูุงู `scripts/check_mtproxy.sh` ุง ูุดุงุจู) ุฑู **ูุณุชูู ุงุฌุฑุง ฺฉู** ู ุฎุฑูุฌโุงุด ุฑู ุจุจู:

   * ุงฺฏุฑ ุงุณู ุณุฑูุณ/ูพูุฑุช match ูุจุงุดูุ ุฑุงุญุช ูโุชูู ุชู ุงุณฺฉุฑูพุช ุฎูุฏุช ุนูุถุด ฺฉู ุชุง ุจุง ูุตุจ ุฎูุฏุช ููุงููฺฏ ุดู.

---

### ูุดฺฉู ณ โ ุฎูุฏ ุจุงุช NodeJS ุจุงูุง ููโุขุฏ / ูุตู ุจู ุชูฺฏุฑุงู ููโุดู

ุจุง ุชูุฌู ุจู READMEุ ุงู ููุงุฑุฏ ุฎู ูููู: ([GitHub][1])

* ุชูฺฉู ุจุงุช ุจุงุฏ ุฏุฑุณุช ุชู `bot/index.js` ุณุช ุจุดู (ุงุณฺฉุฑูพุช ุฎูุฏุด ุงู ฺฉุงุฑ ุฑู ูโฺฉููุ ูู ุงฺฏุฑ ุชู ุฏุณุช ุฏุณุช ุจุฑุฏู ุจุงุด ููฺฉูู ุฎุฑุงุจ ุดุฏู ุจุงุดู).
* Node.js ู npm ุจุงุฏ ูุตุจ ุจุงุดู ู ูุณุฎูโุดูู ูุงุจูโูุจูู ุจุฑุง ฺฉุชุงุจุฎุงููโูุง ุชูฺฏุฑุงู ุจุงุดู.
* pm2 ุจุงุฏ global ูุตุจ ุดุฏู ุจุงุดู ู ุฏุณุชูุฑ `pm2 start bot/index.js --name mtpromonitorbot` ุจุฏูู ุฎุทุง ุงุฌุฑุง ุจุดู.

๐ ุจุฑุง ุฏุจุงฺฏ ุงู ุจุฎุด:

* ุฎุฑูุฌ `pm2 logs mtpromonitorbot` ุฑู ุจุจูุ

  * ุงฺฏุฑ `ETELEGRAM: 401 Unauthorized` ุจูุฏ โ ุชูฺฉู ุจุงุช ุงุดุชุจุงูู
  * ุงฺฏุฑ ูุงฺูู ูพุฏุง ูุดู โ `npm install` ุฏุฑุณุช ุงุฌุฑุง ูุดุฏู

---

## ด. ุฌูุนโุจูุฏ ฺฉูุชุงู ุจุฑุง ุฎูุฏุช

* ุงู ูพุฑูฺู = **ุงูุณุชุงูุฑ + ููุฌุฑ ุจุฑุง โุจุงุช ูุงูุชูุฑ MTProxyโ**
* **ุฎูุฏ MTProto Proxy ุฑู ูุตุจ ููโฺฉูู.**
* ูพุณ:

  1. ุงูู ุจุงุฏ MTProxy ุฑู **ุฌุฏุงฺฏุงูู** ูุตุจ ู ุจูโุนููุงู ุณุฑูุณ ุฑุงู ุจูุฏุงุฒ.
  2. ุจุนุฏ ุงู ุฑูพู ุฑู ุชู `/opt/MTproMonitorbot` ูุตุจ ฺฉูุ `mtpromonitor.sh` ุฑู ุงุฌุฑุง ฺฉู ู ุจุงุช ุฑู ุจุง pm2 ุจุงูุง ุจุงุฑ. ([GitHub][1])
  3. ุงฺฏุฑ MTProxy ุฑู detect ูฺฉุฑุฏุ ุจุงุฏ ุงุณฺฉุฑูพุช detection ุฑู ุจุง ุณุงุฎุชุงุฑ ุณุฑูุณ ุฎูุฏุช ููุงููฺฏ ฺฉู.

ุงฺฏุฑ ุฏูุณุช ุฏุงุดุชุ ูพุงู ุจุนุฏ ูโุชููู ุจุฑุงุช ู ุณูุงุฑู ฺฉุงูู ุจููุณู:

* ูุตุจ ฺฉ MTProxy ุณุงุฏู (ูุซูุงู ุจุง ู ุงุณฺฉุฑูพุช ูุนุฑูู)
* ุจุนุฏ ุฏููุงู ฺุทูุฑ ุงู MTproMonitorbot ุฑู ฺฉูุงุฑุด ุจุงุฑ ุจุงูุง ฺฉู ูุดูฺฏ ฺฏุฑุงู ู health check ุจุฏู.

[1]: https://github.com/h4m1dr/MTproMonitorbot "GitHub - h4m1dr/MTproMonitorbot: A modern MTProto proxy monitoring bot with a clean command system, live charts, bandwidth stats, health checks and scalability support."


ุฎูุฏ ูพุฑูฺูโูุงุฑู ุณุน ฺฉุฑุฏู ูุณุชูู ุงุฒ ฺฏุชโูุงุจ ุจุงุฒ ฺฉููุ ูู ูุชุฃุณูุงูู GitHub ุฑู ูุงูโูุง `app.js` ู `bot.py` ุฎุทุง *โUh oh! There was an error while loadingโ* ูโุฏูุฏ ู ูุญุชูุง ุฑู ุจู ูู ููโุฏูุฏุ ุญุช ุงุฒ ุทุฑู raw ูู ุจูุงฺฉ ูโุดูุฏ. 
ูพุณ **ููโุชููู ุฎูุฏ ุชุงุจุนโูุง ุฑู ุฎุทโุจูโุฎุท ุงุฒ ุงู ุฏูุชุง ุฑูพู ุฏุฑุจุงุฑู** ๐ 
ูู ุงุฒ ุฑู ุฏุงฺฉูููุช ู ุชูุถุญุงุช ุฌุงูุจ ู ูููโุทูุฑ ูุนูุงุฑ ฺฉู ูโุชููู ุจุฑุงุช ุชูุถุญ ุจุฏู *ฺุทูุฑ* ุฏุงุฑูุฏ MTProto ูโุณุงุฒูุฏ ู ููฺฉ ุดุดูโุง (one-click proxy link) ุชููุฏ ูโฺฉููุฏุ ู ฺุทูุฑ ููู ุงุฏูโูุง ุฑุง ุชู ุฑุจุงุช ุฎูุฏุช ุงุณุชูุงุฏู ฺฉู. 
 
--- 
 
## 1. ูุนูุงุฑ ฺฉู ูุฑ ุฏู ูพุฑูฺู (ุณุทุญ ุจุงูุง) 
 
### 1.1. `mtproxybot` (ุฑูพู mmdzov) 
 
ุทุจู ูฺฉ ุชุญูู ุงู ูพุฑูฺู (DeepWiki)ุ ุงู ุจุงุช: 
 
* ุจุง **Node.js** ู ูุฑูโูุฑฺฉ **[grammY](https://grammy.dev)** ุณุงุฎุชู ุดุฏู. ([DeepWiki][1]) 
* ุฎูุฏุด ูุณุชููุงู MTProto ุฑุง ุฑุงู ููโฺฉูุฏุ ุจูฺฉู ุจู ฺฉ ุงุณฺฉุฑูพุช ุจุฑูู ุจู ุงุณู **MTProtoProxyInstaller** ูุตู ุดุฏู ู ุจุงูุงุด ฺฉุงุฑ ูโฺฉูุฏ. ([DeepWiki][1]) 
* ุจุฑุง ูุฏุฑุช ูพุฑูฺฉุณ ุงู ฺฉุงุฑูุงุฑู ูโฺฉูุฏ:([DeepWiki][1]) 
 
  * ุณุงุฎุช ู ูุณุชโฺฉุฑุฏู ููฺฉโูุง ูพุฑูฺฉุณ 
  * ุณุงุฎุช / revoke ฺฉุฑุฏู secret ุจุฑุง ูุฒุฑ 
  * ุชูุธู limit, quota, expiry ูโฆ 
* ุงู ฺฉุงุฑูุง ุฑุง ุจุง ุชุงุจุน ุดุจู `scripts.run(N)` ุงูุฌุงู ูโุฏูุฏ ฺฉู `N` ุดูุงุฑูโ ุนููุงุช ุฑู ุงุณฺฉุฑูพุช ูุตุงุจ ูพุฑูฺฉุณ ุงุณุช:([DeepWiki][1]) 
 
  * `run(1)` โ ูุณุช ููฺฉโูุง 
  * `run(4)` โ ุณุงุฎุช secret ุฌุฏุฏ (ุนู ุนููุงู MTProto ุฌุฏุฏ ุจุฑุง ู ูุฒุฑ) 
  * `run(5)` โ revoke secret 
  * โฆ ู ุบุฑู 
 
**ุนู ุชุงุจุน โุณุงุฎุช ูพุฑูฺฉุณโ ุฏุฑ ุงู ูพุฑูฺูุ ูุณุชูู ุฑู mtproxy ฺฉุงุฑ ููโฺฉูุฏุ ููุท ฺฉ ุฏุณุชูุฑ ุดูู (exec) ุจู ุงุณฺฉุฑูพุช ูุตุจโุฏููุฏู ูโูุฑุณุชุฏ ู ุฎุฑูุฌ ุฑุง ูโฺฏุฑุฏ.** 
 
--- 
 
### 1.2. `telegram-proxy-specifier-bot` (ุฑูพู rraammiinn) 
 
ุงุฒ ุฑู README ู ุณุงุฎุชุงุฑ ุฑูพู: ([GitHub][2]) 
 
* ุจู ุฒุจุงู **Python** ููุดุชู ุดุฏู (ทถูช Pythonุ ุจูู Shell). ([GitHub][2]) 
* ุจุฑุง ุจุงุช ุงุฒ ฺฉ ุงุฒ ูุงุจุฑุฑโูุง bot (ุงุญุชูุงูุงู `pyTelegramBotAPI` ุง `aiogram`) ุงุณุชูุงุฏู ฺฉุฑุฏู. 
* ุงุฒ ุทุฑู **SSH** ุจู ุณุฑูุฑ MTProxy ูุตู ูโุดูุฏ ู ุฏุณุชูุฑุงุช ูุงุฒู ุจุฑุง ุงุถุงูู ฺฉุฑุฏู secret / ุญุฐู secret ุฑุง ุงุฌุฑุง ูโฺฉูุฏ. ([GitHub][2]) 
* ุจุฑุง ูุฏุฑุช ูุฒุฑูุง ุงุฒ **SQLite** ุงุณุชูุงุฏู ูโฺฉูุฏ: ูุฑ ฺฉุงุฑุจุฑ ฺฉู ุนุถู ฺฉุงูุงู ูโุดูุฏุ ุจุฑุงุด ฺฉ secret ู ููฺฉ ูพุฑูฺฉุณ ุฐุฎุฑู ูโฺฉูุฏุ ู ููุช ุงุฒ ฺฉุงูุงู ุฎุงุฑุฌ ุดุฏุ secret ุฑุง ุฑู ุณุฑูุฑ revoke ูโฺฉูุฏ ู ุงุฒ ุฏุชุงุจุณ ูพุงฺฉ ูโฺฉูุฏ. ([GitHub][2]) 
 
ูพุณ ุงูุฌุง ุชุงุจุน โุณุงุฎุช ูพุฑูฺฉุณโ ุชูุฑุจุงู ุงู ฺฉุงุฑูุง ุฑุง ูโฺฉูุฏ (ุฏุฑ ุญุฏ ูุนูุงุฑ): 
 
1. ุจุฑุฑุณ ูโฺฉูุฏ ุขุง ฺฉุงุฑุจุฑ ุฏุฑ ุฏุชุงุจุณ ูุจูุงู secret ุฏุงุฑุฏ ุง ูู. 
2. ุงฺฏุฑ ูุฏุงุฑุฏ: 
 
   * ุชููุฏ ฺฉ secret (ุจู ุดฺฉู hex random) 
   * ุงุฌุฑุง ฺฉ ุฏุณุชูุฑ ุฑู ุณุฑูุฑ MTProto ุงุฒ ุทุฑู SSH (ูุซูุงู ุงุณฺฉุฑูพุช ุง ุจุงูุฑ mtproto) ุจุฑุง ุงุถุงูู ฺฉุฑุฏู ุงู secret 
   * ุฐุฎุฑู ุฏุฑ `bot_data.db` (SQLite) 
3. ุณุงุฎุชู ููฺฉ MTProto (`t.me/proxy?server=...&port=...&secret=...`) 
4. ุงุฑุณุงู ููฺฉ ุจู ฺฉุงุฑุจุฑุ ุบุงูุจุงู ุจู ุตูุฑุช **ุฏฺฉูู ุดุดูโุง** (inline keyboard ุจุง URL). 
 
--- 
 
## 2. ููฺฉ ุดุดูโุง MTProto ฺุทูุฑ ุณุงุฎุชู ูโุดูุฏุ 
 
ูุฑูุช ุฑุณู ููฺฉ MTProto (one-click link) ุงู ุงุณุช: ([mtproto.io][3]) 
 
```text 
https://t.me/proxy?server=YOUR_SERVER&port=YOUR_PORT&secret=YOUR_SECRET 
``` 
 
ุง ุงุณฺฉูู native: 
 
```text 
tg://proxy?server=YOUR_SERVER&port=YOUR_PORT&secret=YOUR_SECRET 
``` 
 
ูพุณ ูู ุฏุฑ Node.js ู ูู ุฏุฑ Pythonุ ุชุงุจุน ุชููุฏ ููฺฉ ฺุฒ ุดุจู ุงู ุงุณุช (ุดุจูโฺฉุฏ): 
 
```js 
function buildMtprotoLink(server, port, secret) { 
  return `https://t.me/proxy?server=${server}&port=${port}&secret=${secret}`; 
} 
``` 
 
ุจุนุฏ ุจุฑุง โููฺฉ ุดุดูโุงโ ุฏุฑ ุจุงุช ุชูฺฏุฑุงูุ ุงู ููฺฉ ุฑุง ูโฺฏุฐุงุฑ ุฑู ฺฉ ุฏฺฉููโ inline: 
 
* ุฏุฑ Node.js (grammY): 
 
```js 
await bot.api.sendMessage(chatId, 'Your MTProto proxy:', { 
  reply_markup: { 
    inline_keyboard: [[ 
      { text: 'Connect Proxy โ', url: proxyUrl } 
    ]] 
  } 
}); 
``` 
 
* ุฏุฑ Python (ูุซูุงู ุจุง `pyTelegramBotAPI`): 
 
```python 
keyboard = types.InlineKeyboardMarkup() 
keyboard.add(types.InlineKeyboardButton("Connect Proxy โ", url=proxy_url)) 
bot.send_message(chat_id, "Your MTProto proxy:", reply_markup=keyboard) 
``` 
 
ุงู ุฏููุงู ูููู ฺุฒโู ฺฉู ุชู ฺฉุงูุงูโูุง ุจูโุนููุงู **ููฺฉ ุดุดูโุง** ูโุจู. 
 
--- 
 
## 3. ุนููุงู ุชุงุจุน ุณุงุฎุช ูพุฑูฺฉุณ ุฏุฑ ุงู ุฏู ูุฏู *ฺุทูุฑ* ุงุณุชุ 
 
ฺูู ฺฉุฏ ูุงูุน ุฑู ููโุชูุงูู ุจุจููุ ุงูุฌุง ุจุง ุชูุฌู ุจู ูุนูุงุฑ ูุฑ ฺฉุฏูู ฺฉ ูุณุฎูโ ุฎู ูุฒุฏฺฉ ุจู ูุงูุนุช ุจุฑุงุช ูโููุณู ุชุง ุจููู ฺู ุฎุจุฑู ู ฺุทูุฑ ุฏุฑ ุฑุจุงุช ุฎูุฏุช ุงุณุชูุงุฏูโุงุด ฺฉู. 
 
### 3.1. ุงูฺฏู mtproxybot (Node.js + ุงุณฺฉุฑูพุช ุจุฑูู) 
 
ุงุฏู: 
 
* ุงุฒ `child_process.execSync` ุจุฑุง ุงุฌุฑุง ุงุณฺฉุฑูพุช ูุตุจ MTProto ุงุณุชูุงุฏู ูโฺฉูุฏ. 
* ุจุฑุง ุณุงุฎุช secret ุฌุฏุฏ ูุนูููุงู ฺฉ ุฏุณุชูุฑ ูุซู `./MTProtoProxyInstaller.sh 4` (ุนุฏุฏ ด ุทุจู ูฺฉ ุจุฑุง โAdd user secretโ ุงุณุช) ุงุฌุฑุง ูโุดูุฏุ ู ุฎุฑูุฌ ุดุงูู `secret`, `server`, `port`, `link` ุงุณุช. ([DeepWiki][1]) 
 
ฺฉ ูพุงุฏูโุณุงุฒ ููููู (ุจุฑุง ุฎูุฏุช): 
 
```js 
// comments MUST be English only 
const { execSync } = require('child_process'); 
 
function createMtprotoProxyFromInstaller() { 
  // Run external installer script with command "4" = add user secret 
  const output = execSync('bash MTProtoProxyInstaller.sh 4', { 
    encoding: 'utf8' 
  }); 
 
  // Here you should parse output to extract server, port and secret 
  // For example, if output contains lines like: 
  // Server: 1.2.3.4 
  // Port: 443 
  // Secret: ee1230f1234567890abcdef 
  const server = parseServer(output); 
  const port = parsePort(output); 
  const secret = parseSecret(output); 
 
  const link = `https://t.me/proxy?server=${server}&port=${port}&secret=${secret}`; 
  return { server, port, secret, link }; 
} 
``` 
 
ู ุจุนุฏ ุงู ุฎุฑูุฌ ุฑู ุฏุงุฎู ฺฉ ููุฏูุฑ `/newproxy` ุง ูุฑ ฺฉุงููุฏ ุฏฺฏู ุงุณุชูุงุฏู ูโฺฉู ู ุฏฺฉูู ุดุดูโุง ูโูุฑุณุช (ูุซู ูุซุงู ุจุงูุง ุจุง grammY). 
 
--- 
 
### 3.2. ุงูฺฏู telegram-proxy-specifier-bot (Python + SSH + SQLite) 
 
ุงุฏู: 
 
* ุงู ุจุงุช ุฎูุฏุด ุฏุชุงุจุณ ุฏุงุฑุฏุ ูพุณ ูุฑ ุจุงุฑ ฺฉู ูพุฑูฺฉุณ ูโุณุงุฒุฏุ **ุซุจุช ูโฺฉูุฏ ฺฉุฏุงู ฺฉุงุฑุจุฑ ฺู secretโุง ุฏุงุฑุฏ**. ([GitHub][2]) 
* ุฑู ุณุฑูุฑ MTProxy ุจู ฺฉูฺฉ SSH (ูุซูุงู `paramiko`) ุฏุณุชูุฑ ุงุถุงููโฺฉุฑุฏู secret ุฑุง ุงุฌุฑุง ูโฺฉูุฏ. 
* ููฺฉ ุฑุง ุฎูุฏุด ุงุฒ ุฑู `server`, `port`, `secret` ูโุณุงุฒุฏ ู ุจุฑุง ูุฒุฑ ูโูุฑุณุชุฏ. 
 
ูููููโ ุจุณุงุฑ ูุฒุฏฺฉ ุจู ฺฉุงุฑ ฺฉู ุงูุฌุงู ูโุฏูุฏ: 
 
```python 
# comments MUST be English only 
import os 
import secrets 
import sqlite3 
import paramiko 
 
DB_PATH = "bot_data.db" 
MT_SERVER = os.getenv("MT_SERVER") 
MT_PORT = int(os.getenv("MT_PORT", "443")) 
MT_USER = os.getenv("MT_SSH_USER") 
MT_HOST = os.getenv("MT_HOST") 
MT_SSH_KEY = os.getenv("MT_SSH_KEY", "~/.ssh/id_rsa") 
 
def create_mtproto_secret_for_user(user_id: int) -> dict: 
  """Create new MTProto secret for a user and register it on the MTProxy server.""" 
  conn = sqlite3.connect(DB_PATH) 
  cur = conn.cursor() 
 
  # Check if user already has a secret 
  cur.execute("SELECT secret FROM users WHERE user_id = ?", (user_id,)) 
  row = cur.fetchone() 
  if row: 
      secret = row[0] 
  else: 
      # Generate random 32-hex secret 
      secret = secrets.token_hex(16) 
 
      # Register secret on remote MTProxy server via SSH 
      ssh = paramiko.SSHClient() 
      ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy()) 
      ssh.connect(MT_HOST, username=MT_USER, key_filename=os.path.expanduser(MT_SSH_KEY)) 
 
      # Here you call your proxy script or binary, e.g.: 
      # mtproto-proxy --add-secret=secret 
      cmd = f"/usr/local/bin/mtproto-manager add-user {secret}" 
      stdin, stdout, stderr = ssh.exec_command(cmd) 
      exit_status = stdout.channel.recv_exit_status() 
      ssh.close() 
 
      if exit_status != 0: 
          raise RuntimeError("Failed to register MTProto secret on server") 
 
      # Save user -> secret mapping to DB 
      cur.execute( 
          "INSERT INTO users (user_id, secret) VALUES (?, ?)", 
          (user_id, secret), 
      ) 
      conn.commit() 
 
  conn.close() 
 
  link = f"https://t.me/proxy?server={MT_SERVER}&port={MT_PORT}&secret={secret}" 
  return {"server": MT_SERVER, "port": MT_PORT, "secret": secret, "link": link} 
``` 
 
ุจุนุฏ ุฏุฑ ููุฏูุฑ ุจุงุช (ูุซูุงู `on_chat_member` ููุช ฺฉุณ ุนุถู ฺฉุงูุงู ุดุฏ)ุ ุงู ุชุงุจุน ุฑู ุตุฏุง ูโฺฉูุฏุ ู ููฺฉ ุดุดูโุง ุจุฑุง ูุฒุฑ ูโูุฑุณุชุฏ. 
 
--- 
 
## 4. ฺฉุฏุงู ุจูุชุฑู ู ุจุฑุง ฺุ 
 
ุจุง ุชูุฌู ุจู ุชูุถุญุงุช ุจุงูุง (ู ูู ฺฉุฏ ูุงูุน): 
 
| ูฺฺฏ          | mtproxybot (Node.js)                    | telegram-proxy-specifier-bot (Python)               | 
| -------------- | --------------------------------------- | --------------------------------------------------- | 
| ุฒุจุงู ู ุงุณุชฺฉ    | Node.js + grammY + ุงุณฺฉุฑูพุช ุจุฑูู       | Python + ุจุงุช ุชูฺฏุฑุงู + SSH + SQLite                  | 
| ูุฏุฑุช ฺฉุงุฑุจุฑุงู | ุจุดุชุฑ ุงุฏููโูุง ูุดุฎุต (USER_IDS)         | ุชูุฑฺฉุฒ ุฑู ุงุนุถุง ฺฉุงูุงูุ ูุฑ ุนุถู ฺฉ secret             | 
| ุฐุฎุฑูโุณุงุฒ     | ุฑู ุงุณฺฉุฑูพุช / ูุงูโูุง MTProxyInstaller | ุฏุชุงุจุณ SQLite ุจุฑุง track ฺฉุฑุฏู ูุฒุฑูุง               | 
| ุณุงุฎุช proxy     | ฺฉุงู ุจู ุงุณฺฉุฑูพุช ุนุฏุฏ (`scripts.run(4)`)  | ฺฉุงู ุจู ุงุณฺฉุฑูพุช ุง binary ุงุฒ ุทุฑู SSH ู ุฐุฎุฑู ุฏุฑ DB  | 
| ูพฺุฏฺฏ        | ุณุงุฏูโุชุฑุ ูู ูุงุจุณุชู ุจู ุงุณฺฉุฑูพุช ุฎุงุฑุฌ    | ูพฺุฏูโุชุฑุ ูู ุชูุฒุชุฑ ู ุฎูุฏฺฉูุง ุจุฑุง user management | 
 
**ุงฺฏุฑ ูุฏูุช ุงูู ฺฉู ูุซู ฺฉ ูพูู ููุท ูพุฑูฺฉุณโูุง ุฑู ุจุง ุจุงุช ูุฏุฑุช ฺฉู (ุจุฑุง ุฎูุฏุช / ฺูุฏ ุงุฏูู):** 
ูุฏู `mtproxybot` ุณุงุฏูโุชุฑูุ ูุฎุตูุตุงู ุงฺฏุฑ ููู MTProtoProxyInstaller ุฑุง ูุตุจ ฺฉุฑุฏู ุจุงุด. 
 
**ุงฺฏุฑ ูุฏูุช ุงูู ฺฉู ุจูโุตูุฑุช ุฎูุฏฺฉุงุฑ ุจู ุงุนุถุง ฺฉ ฺฉุงูุงูุ ูพุฑูฺฉุณ ุงุฎุชุตุงุต ุจุฏ ู ููฺฏุงู ุฎุฑูุฌ ุฏุณุชุฑุณโุดูู ูุทุน ุจุดู:** 
ุงูฺฏู `telegram-proxy-specifier-bot` ุจูุชุฑู ฺูู: 
 
* ุฏุชุงุจุณ ุฏุงุฑุฏุ 
* ุจุฑ ุงุณุงุณ ุนุถู ุดุฏู/ุฎุงุฑุฌ ุดุฏู ฺฉุงุฑุจุฑ ุงุฒ ฺฉุงูุงู ุฑูุชุงุฑ ูโฺฉูุฏุ 
* ูโุดูุฏ policyโ-ูุง ูพฺุฏูโุชุฑ ุฑู ูุฒุฑโูุง ูพุงุฏู ฺฉุฑุฏ. 
 
--- 
 
## 5. ฺุทูุฑ ุงูโูุง ุฑุง ุฏุฑ ุฑุจุงุช ุฎูุฏุช ุงุณุชูุงุฏู ฺฉูุ 
 
### 5.1. ูุฏูโูุง (ูุฑ ุฒุจุงู ฺฉู ุจุงุด) 
 
1. **ุณูุช ุณุฑูุฑ MTProto** 
 
   * ฺฉ ุงุณฺฉุฑูพุช ุง ูุฑูุงู ูุดุฎุต ุฏุงุดุชู ุจุงุด ฺฉู ุจุชูุงู ุจุง ฺฉ ุฏุณุชูุฑ: 
 
     * secret ุฌุฏุฏ ุจุณุงุฒ 
     * secret ุฑุง ุญุฐู ฺฉู 
   * ูุซูุงู ุจุฑุง MTProxy-officialุ ุณุงุฎุช ููฺฉ ุจู ุดฺฉู ุฒุฑ ุงุณุช: ([GitHub][4]) 
 
     ```text 
     tg://proxy?server=SERVER_NAME&port=PORT&secret=SECRET 
     ``` 
 
2. **ุณูุช ุฑุจุงุช** 
 
   * ุชุงุจุน ุจููุณ ฺฉู: 
 
     * secret ุฌุฏุฏ ุจุณุงุฒุฏ/ุจฺฏุฑุฏ (ุจุง SSH ุง exec) 
     * ููฺฉ MTProto ุฑุง ุจุง ูุฑูุช `https://t.me/proxy?server=...&port=...&secret=...` ุจุณุงุฒุฏ 
     * ููฺฉ ุฑุง ุฏุฑ ฺฉ ุฏฺฉูู ุดุดูโุง ุจุฑุง ูุฒุฑ ุจูุฑุณุชุฏ. 
 
3. **Trigger**ูุง 
 
   * ูโุชูุงูุฏ ฺฉ `/newproxy` ุจุฑุง ุงุฏููโูุง ุจุงุดุฏุ ุดุจู mtproxybot. 
   * ุง eventูุง join/leave ฺฉุงูุงูุ ุดุจู telegram-proxy-specifier-bot. 
 
--- 
 
ุงฺฏุฑ ุฏูุณุช ุฏุงุดุชุ ุชู ูพุงู ุจุนุฏ ุจฺฏู ุฑุจุงุช ุฎูุฏุช ุฑู ุจุง ฺ ูโููุณ (Node.js/grammY ุง Python/aiogram ูโฆ)ุ ูู ูู ุฏููุงู ุจุฑ ุงุณุงุณ ููููุ ฺฉ **ุชุงุจุน ฺฉุงูู `createProxy()` + ููุฏูุฑ `/newproxy`** ุจุฑุงุช ูโููุณู ฺฉู ุขูุงุฏูโ- ุงุณุชูุงุฏู ุชู ูพุฑูฺู ุฎูุฏุช ุจุงุดูุ ููุฑุงู ุจุง ุณุงุฎุช ููฺฉ ุดุดูโุง. 
 
[1]: https://deepwiki.com/mmdzov/mtproxybot "mmdzov/mtproxybot | DeepWiki" 
[2]: https://github.com/rraammiinn/telegram-proxy-specifier-bot "GitHub - rraammiinn/telegram-proxy-specifier-bot" 
[3]: https://mtproto.io/en-us/tutorial-generate-link.html?utm_source=chatgpt.com "How to Generate an MTProto Proxy Link?" 
[4]: https://github.com/mtProtoProxy/MTProxy-official?utm_source=chatgpt.com "GitHub - mtProtoProxy/MTProxy-official: official telegram" 

ู ุงู

ุฎู ุฎูุจ ุดุฏ ฺฉู ููู ูุงูโูุง ุฑู ุฏุงุฏุ ุงูุงู ุฏฺฏู ูโุชููู *ุฏูู* ุฏุฑุจุงุฑู ฺ ุจู ฺู ๐ 
ุฌูุงุจ ุฑู ฺูุฏ ุชฺฉู ูโฺฉูู: 
 
--- 
 
## ฑ. ูุฑู ูุนูุงุฑ ฺฉู ุฏู ุฑุจุงุช 
 
### ฑ.ฑ. ุฑุจุงุช Node (`mtproxybot` โ ูุงู `app.js`) 
 
ุงู ุฑุจุงุช ุฏุฑ ูุงูุน ููุท **ูพูู ูุฏุฑุช ุฑู ุงุณฺฉุฑูพุช ูุตุจ MTProto** ูุณุช: 
 
* ุจุงูุง ุชุนุฑู ฺฉุฑุฏู:  
 
  ```js 
  let scripts = { 
    run: "curl -o MTProtoProxyInstall.sh -L https://git.io/fjo34 && bash MTProtoProxyInstall.sh", 
  }; 
  ``` 
* ุจุนุฏ **ููู ฺฉุงุฑูุง** ุฑู ุจุง ุงุฌุฑุง ููู ุงุณฺฉุฑูพุช ู ุฏุงุฏู ูุฑูุฏ ุงูุฌุงู ูโุฏูุ ูุซูุงู: 
 
  * `scripts.run 1` โ ูุณุช ูพุฑูฺฉุณโูุง (View all links)  
  * `scripts.run 3` โ ูุฏุฑุช AD Tag  
  * `scripts.run 4` โ ุงุถุงููโฺฉุฑุฏู secret ุฌุฏุฏ (ุฏุฑ ูุงูุน ุณุงุฎุช ูพุฑูฺฉุณ ุจุฑุง ฺฉ user)  
  * `scripts.run 5` โ Revoke secret  
  * `scripts.run 6` โ Limit connection 
  * `scripts.run 7` โ Expiry date 
  * `scripts.run 8` โ Quota options  
 
ุฎูุฏ Node.js **ุงุตูุงู ูุณุชููุงู ุจุง MTProxy ุณุฑูุณ/ุจุงูุฑ ฺฉุงุฑ ููโฺฉูุฏ**ุ ููุท ุจุง `execSync` ุงู ุงุณฺฉุฑูพุช ุฑุง ุตุฏุง ูโุฒูุฏ ู ุฎุฑูุฌ ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ. ุณุงุฎุชุงุฑ: 
 
* ููููุง ุจุง `@grammyjs/menu` ุณุงุฎุชู ุดุฏูโุงูุฏ: `mainMenu`, `revokeSecretMenu`, `limitConnectionMenu`, `expiryDateMenu`, `quotaOptionMenu`, `addSecretMenu`.  
* ุจุฑุง ุฏุงููฺฏ ฺูุฏูุฑุญููโุง ุงุฒ `session` ุงุณุชูุงุฏู ุดุฏู (ููฺฏโูุง ูุซู `waitForNewSecret`, `waitForLimitConnection` ูโฆ) ู ุจุฑุง ูุฑ stateุ `.filter(...).on("message", ...)` ุชุนุฑู ฺฉุฑุฏู.  
 
**ุณุงุฎุช secret:** 
 
* ุง ุฎูุฏ ฺฉุงุฑุจุฑ secret ูโูุฑุณุชุฏ 
* ุง ุงุฒ ุฏฺฉููโ `Generate` ุงุณุชูุงุฏู ูโฺฉูุฏ ฺฉู `randomSecret()` ุฑุง ุตุฏุง ูโุฒูุฏ ู ุจุนุฏ ุจุง `scripts.run 4` ุขู ุฑุง ุจู ุงุณฺฉุฑูพุช ูโุฏูุฏ:  
 
```js 
const secret = randomSecret(); 
const result = execSync(`${scripts.run} 4`, { 
  input: `${user}\n1\n${secret}\n`, 
}).toString(); 
``` 
 
**ููฺฉ ุดุดูโุง / ููฺฉ ูพุฑูฺฉุณ ุงูุฌุง ุณุงุฎุชู ููโุดูุฏ**ุ ุงุณฺฉุฑูพุช Bash ูุตุจ MTProto ุฎูุฏุด ููฺฉโูุง ุฑุง ูโุณุงุฒุฏ ู ููุช ุฑู Bot ยซView all linksยป ูโุฒูุ ููุท ุฎุฑูุฌ ุฎุงู ููุงู ุงุณฺฉุฑูพุช ุฑุง ฺุงูพ ูโฺฉูุฏ.  
 
### ฑ.ฒ. ุฑุจุงุช Python (`telegram-proxy-specifier-bot` โ ูุงู `bot.py`) 
 
ุงูุฌุง ุฏุงุณุชุงู ุฎู ฺฉุงููโุชุฑ ู โุณุณุชูโุชุฑโ ุงุณุช:  
 
* `WorkingMTProxyBot`: 
 
  * ูุณุชูู ุจู **ูุงู ุณุฑูุณ systemd** (`/etc/systemd/system/MTProxy.service`) ูุตู ูโุดูุฏ. 
  * ExecStart ุณุฑูุณ ุฑุง ูพุงุฑุณ ูโฺฉูุฏ ู `-S` (secretูุง)ุ `-H` (port)ุ `-P` (AD tag)ุ `-D` (TLS domain) ู `-M` (workers) ุฑุง ุฏุฑูโุขูุฑุฏ.  
  * secret ุฌุฏุฏ ุฑุง ุฎูุฏุด ุจู ูุณุช ุงุถุงูู ูโฺฉูุฏุ ูุงู ุณุฑูุณ ุฑุง ุฏูุจุงุฑู ูโููุณุฏ ู ุณุฑูุณ MTProxy ุฑุง **ุจุง ฺฉูุชุฑู ฺฉุงูู** ุฑุณุชุงุฑุช ูโฺฉูุฏ (ุจู ููุฑุงู hack ุจุฑุง `pid_max`).  
 
* ุฏุชุงุจุณ SQLite (`Database`): ุจุฑุง ูุฑ ูุฒุฑ `user_id, username, secret, is_active, created_at` ุฐุฎุฑู ูโฺฉูุฏุ ู ุงุฒ ุงูุฌุง ูโูููุฏ ฺู ฺฉุณ ฺู ูพุฑูฺฉุณ ุฏุงุฑุฏ.  
 
* ุจุง `ChatMemberHandler` ููุช ฺฉุณ ุนุถู/ุฎุงุฑุฌ ูโุดูุฏ: 
 
  * ูููุน join โ ุจุฑุง ฺฉุงุฑุจุฑ secret ูโุณุงุฒุฏุ ูโูุฑุณุชุฏ ุจู MTProxyุ ุฏุฑ DB ุฐุฎุฑู ูโฺฉูุฏ.  
  * ูููุน leave โ secret ุฑุง ุงุฒ service ุญุฐู ูโฺฉูุฏ (remove_secret) ู `is_active` ุฑุง ฐ ูโฺฉูุฏ.  
 
* rate-limit / ุขูุงุฑ ูู ุฏุงุฑุฏ (`stats`, `user_rate_limit`ุ queue ุนููุงุช MTProxy).  
 
--- 
 
## ฒ. ุฑููุฏ ุฏูู ุณุงุฎุช ูพุฑูฺฉุณ ู ููฺฉ ุดุดูโุง ุฏุฑ ูุฑ ฺฉุฏูู 
 
### ฒ.ฑ. Node โ ุงุณฺฉุฑูพุชโูุญูุฑ (mtproxybot) 
 
**ูุฏูโูุง ุจุฑุง ุณุงุฎุช ูพุฑูฺฉุณ ุฌุฏุฏ:** 
 
1. ุงุฏูู ุฏุฑ ููู `New secret` ุฑุง ูโุฒูุฏ.  
2. ุฑุจุงุช ุงุฒุด username ูโฺฏุฑุฏ (`waitForNewSecretUsername = true`). 
3. ุจุนุฏ ุงุฒ ฺฏุฑูุชู usernameุ ูพุงู ุฒุฑ ุฑุง ูโูุฑุณุชุฏ ู ููู `addSecretMenu` ุฑุง ูโุขูุฑุฏ (ฺฉุงุฑุจุฑ ูโุชูุงูุฏ ุฎูุฏุด secret ุจุฏูุฏ ุง ุฑู Generate ุจุฒูุฏ).  
4. ุงฺฏุฑ Generate ุงูุชุฎุงุจ ุดูุฏ: 
 
   * `randomSecret()` โ ณฒ ฺฉุงุฑุงฺฉุชุฑ hex ูโุณุงุฒุฏ 
   * ุงุณฺฉุฑูพุช ูุตุจ ุฑุง ุจุง option 4 ุตุฏุง ูโุฒูุฏ ู user/secret ุฑุง ุจูโุตูุฑุช input ูโูุฑุณุชุฏ.  
5. ูุณุฆูู update ฺฉุฑุฏู MTProxyุ ุณุงุฎุช ููฺฉ ูโฆ ููฺฏ **ุฏุงุฎู ุงุณฺฉุฑูพุช Bash** ุงุณุชุ ูู Node. 
 
**ูฺฉุชู:** ุงูุฌุง Bot ูฺ ุงุทูุงุน ุงุฒ ุณุงุฎุชุงุฑ `ExecStart`ุ TLSุ port ูโฆ ูุฏุงุฑุฏุ ููู ฺุฒ black-box ุงุณุช. 
 
--- 
 
### ฒ.ฒ. Python โ ุณุฑูุณโูุญูุฑ (WorkingMTProxyBot) 
 
#### ุณุงุฎุช secret ู ุซุจุช ุฏุฑ MTProxy 
 
1. `generate_secret()` โ `secrets.token_hex(16)` (ณฒ ฺฉุงุฑุงฺฉุชุฑ hex).  
 
2. `add_secret(secret)`: 
 
   * ููู async ูโฺฏุฑุฏ (operation_lock) ู cooldown ุจู ุฑุณุชุงุฑุชโูุง ุฑุง ุฑุนุงุช ูโฺฉูุฏ. 
   * ุณุฑูุณ ูุงู ุฑุง ุจุง `_parse_service_file()` ูโุฎูุงูุฏ ู secrets ููุฌูุฏ ุฑุง ุฏุฑูโุขูุฑุฏ.  
   * ุงฺฏุฑ secret ุฌุฏุฏ ุงุณุช โ ุจู ุขุฑุงู `secrets` ุงุถุงูู ูโฺฉูุฏ. 
   * `_write_service_file(config)` ุฑุง ุตุฏุง ูโุฒูุฏ ุชุง ExecStart ุฌุฏุฏ ุจุง `-S secret1 -S secret2 ...` ุณุงุฎุชู ุดูุฏ.  
   * `_restart_mtproxy_service()` ุฑุง ุงุฌุฑุง ูโฺฉูุฏ: stop โ ุตุจุฑ โ ุชูุธู pid_max โ start โ ุตุจุฑ ุชุง status active ุดูุฏ โ ุจุงุฒฺฏุฑุฏุงูุฏู pid_max.  
 
3. ุฏุฑ ููู ูุญุธู ูพุฑูฺฉุณ ุจุฑุง ุขู secret ุฑู MTProxy ุจุงูุง ุขูุฏู ู ุขูุงุฏู ุงุณุชูุงุฏู ุงุณุช. 
 
#### ุณุงุฎุช ููฺฉ ุดุดูโุง 
 
ฺฉู ูุงุฌุฑุง ุชู `get_proxy_link(secret)` ุงุณุช:  
 
* ุฏูุจุงุฑู ุณุฑูุณ ูุงู ุฑุง ูโุฎูุงูุฏ ุชุง `port` ู `tls_domain` ุฑุง ุจูููุฏ. 
* `curl https://api.ipify.org` ูโุฒูุฏ ุชุง IP ูพุงุจูฺฉ ุณุฑูุฑ ุฑุง ุจฺฏุฑุฏ (ุงฺฏุฑ ูุดุฏ fallback ุจู ฺฉ IP ุซุงุจุช). 
* ุงฺฏุฑ `tls_domain` ุชูุธู ุดุฏู ุจุงุดุฏ: 
 
  * `hex_domain = tls_domain.encode('utf-8').hex().lower()` 
  * `full_secret = "ee" + secret + hex_domain` 
* ุงฺฏุฑ TLS ูุจุงุดุฏ: 
 
  * `full_secret = "dd" + secret` 
* ููฺฉ ููุง: 
 
  ```text 
  https://t.me/proxy?server=PUBLIC_IP&port=PORT&secret=FULL_SECRET 
  ``` 
 
ุงู ุฏููุงู ูููู ููฺฉ ุดุดูโุง one-click ูุณุช ฺฉู ฺฏูุช ยซุงูู ูุณูุช ฺฉู ููฺฉ ุดุดูโุง ุณุงุฎุชู ุฑู ูู ฺฺฉ ฺฉูยป. โ๏ธ 
 
#### ุงุชุตุงู ุงู flow ุจู ููู 
 
* ููุช ฺฉุงุฑุจุฑ `/start` ุง `/menu` ูโุฒูุฏุ ุง ุนุถู ฺฉุงูุงู ูโุดูุฏ: 
 
  * ุงฺฏุฑ ุชู DB ุฑฺฉูุฑุฏ ูุนุงู ุฏุงุดุชู ุจุงุดุฏ โ ููุท ุฏฺฉูู ยซฺฏุฑูุชู ูพุฑูฺฉุณยป ุจูุด ูโุฏูุฏ. 
  * ุงฺฏุฑ ูุฏุงุดุชู ุจุงุดุฏ โ secret ุฌุฏุฏ ูโุณุงุฒุฏุ ูโุจุฑุฏ ุฏุงุฎู MTProxyุ ุฏุฑ DB ุฐุฎุฑู ูโฺฉูุฏุ ุจุนุฏ ุฏฺฉููโ ยซฺฏุฑูุชู ูพุฑูฺฉุณยป ุฑุง ูโุฏูุฏ.  
 
* ููุช ุฑู ุฏฺฉูู ูโุฒูุฏ (`get_proxy_xxx`): 
 
  * `handle_proxy_callback` โ ุงุฒ DB secretุด ุฑุง ูโฺฏุฑุฏ โ `get_proxy_link` โ ฺฉ **ุฏฺฉูู ุจุง `url=proxy_link`** ุจุฑุงุด ูโูุฑุณุชุฏ (ูููู ููฺฉ ุดุดูโุง).  
 
--- 
 
## ณ. ูุงูุชูุฑูฺฏ ู ุณุฑูุณโูุง 
 
### ณ.ฑ. ูุงูุชูุฑ ูุงฺฏโูุง (`monitor_logs.sh`) 
 
ุงู ุงุณฺฉุฑูพุช (ฺฉู ฺฉูุงุฑ ุฑุจุงุช Python ฺฏุฐุงุดุชู ุดุฏู) ุงูโุทูุฑู:  
 
* ุจุง `systemctl is-active` ูุถุนุช ุฏู ุณุฑูุณ ุฑุง ูุดุงู ูโุฏูุฏ: 
 
  * `mtproxy-bot` (ุณุฑูุณ ุฑุจุงุช ุชูฺฏุฑุงู) 
  * `MTProxy` (ุณุฑูุณ ูพุฑูฺฉุณ) 
* ุจุนุฏ `journalctl -u mtproxy-bot -u MTProxy -f` ุฑุง ูโุฎูุงูุฏ ู: 
 
  * ูุงฺฏโูุง ฺฉู ุดุงูู `error | failed | โ` ูุณุชูุฏ โ ูุฑูุฒ 
  * `success | โ | active` โ ุณุจุฒ 
  * `restart | pid_max` โ ุฒุฑุฏ 
 
ุนู ุจุฑุง ุฏุจุงฺฏ real-time ุจุณุงุฑ ุฎูุจู. 
 
### ณ.ฒ. ูุตุจ ู ุฑุงูโุงูุฏุงุฒ (`setup.sh`) 
 
ุงู ุงุณฺฉุฑูพุช ุบููโูุฑุญููโุงู ฺฉู: 
 
* OS ุฑุง ุชุดุฎุต ูโุฏูุฏุ ูพฺฉุฌโูุง (python3, venv, curl, ...) ุฑุง ูุตุจ ูโฺฉูุฏ.  
* venv ูโุณุงุฒุฏุ `python-telegram-bot`, `paramiko`, `python-dotenv` ูุตุจ ูโฺฉูุฏ.  
* `.env` ุฑุง ูโุณุงุฒุฏ/ุขูพุฏุช ูโฺฉูุฏุ ุงุฒ ุฎูุฏุช `BOT_TOKEN`, `CHANNEL_ID`, `BOT_LANGUAGE` ูโูพุฑุณุฏ (ุจุง ฺฉู ูุชู ุฑุงูููุง ู ุงููุฌ ๐ง๐ค๐ข).  
* ุงฺฏุฑ MTProxy ูุตุจ ูุจุงุดุฏ โ ุงุณฺฉุฑูพุช official ุฑุง ุฏุงูููุฏ ู ุงุฌุฑุง ูโฺฉูุฏุ ุจุนุฏ port ุฑุง ุงุฒ service ุชุดุฎุต ูโุฏูุฏ ู ุฏุฑ `.env` ูโููุณุฏ.  
* `mtproxy-bot.service` systemd ูโุณุงุฒุฏ ู ุณุฑูุณโูุง ุฑุง start + enable ูโฺฉูุฏ.  
 
--- 
 
## ด. ุณุงุฎุช ุฏุณุชูุฑุงุช Bot ู ููููุง (ฺุฑุง ูู ูููโ ุฏุณุชูุฑูุง ุงุถุงูู ุดุฏุ) 
 
ุงู ูุฑุจูุท ุจู ูุณูุช `post_init` ุฏุฑ `WorkingMTProxyBot` ุงุณุช:  
 
```python 
async def post_init(self, application): 
    from telegram import MenuButtonCommands 
 
    commands = [ 
        ("start", self.t('cmd_start_desc')), 
        ("menu", self.t('cmd_menu_desc')), 
        ("help", self.t('cmd_help_desc')), 
        ("pin", self.t('cmd_pin_desc')), 
        ("unpin", self.t('cmd_unpin_desc')), 
        ("stats", self.t('cmd_stats_desc')), 
        ("restart_proxy", self.t('cmd_restart_proxy_desc')), 
        ("reboot_vps", self.t('cmd_reboot_vps_desc')), 
    ] 
     
    await application.bot.set_my_commands(commands) 
    await application.bot.set_chat_menu_button( 
        menu_button=MenuButtonCommands() 
    ) 
``` 
 
ู ุฏุฑ `run()`ุ ุงู ุฑุง ุณุช ฺฉุฑุฏู:  
 
```python 
application = Application.builder().token(self.config.BOT_TOKEN).build() 
application.post_init = self.post_init 
``` 
 
ุนู **ููุช ุฑุจุงุช ุฑุง ุฑุงู ูโฺฉู**: 
 
* ฺฉ ุจุงุฑ `post_init` ุงุฌุฑุง ูโุดูุฏ 
* `set_my_commands` ูโุฒูุฏ โ Telegram client ุจุฑุง ูููโ ูุฒุฑูุงุ ุงู ุฏุณุชูุฑูุง ุฑุง ุฏุฑ ููู `/` ู ุฏฺฉูู Menu ูุดุงู ูโุฏูุฏ. 
 
ุจุฑุง ููู ุชู ูโฺฏ ยซูู ููู ุฏุณุชูุฑูุง ุงุถุงูู ุดุฏยป ๐ 
ฺฉู ุณุณุชู command list ุงูุฌูุฑ auto ุงุฒ ุฑู ฺฉุฏ ุณุงุฎุชู ูโุดูุฏุ ูู ุฏุณุช. 
 
ููู ุฏุงุฎู ุฑุจุงุช ูู ุจุง `InlineKeyboardButton` ู `InlineKeyboardMarkup` ุณุงุฎุชู ุดุฏูุ ู ุจุฑุง ูุชูโูุง ุงุฒ ุณุณุชู ุชุฑุฌูู `get_text(key, language)` ุงุณุชูุงุฏู ุดุฏูุ ุจูุงุจุฑุงู **ูุงูุจ ู ุงููุฌโูุง ุฏุฑ `languages.py` ูุณุชูุฏ** ูู ูุง ฺูุฏุชุง ูููููโ hardcoded ูู ุฏุงุฑู: 
 
ูุซูุงู ูุชู ูพูโุดุฏู ููู ุฏุฑ ฺฉุงูุงู:  
 
```python 
menu_text = ( 
    "๐ **ุฏุฑุงูุช ูพุฑูฺฉุณ ุฑุงฺฏุงู MTProxy**\n\n" 
    "๐ **ุจุฑุง ุงุนุถุง ฺฉุงูุงู ฺฉุงููุงู ุฑุงฺฏุงู!**\n\n" 
    "๐ฑ **ูุญูู ุฏุฑุงูุช:**\n" 
    "๐ ุฑู ุฏฺฉูู 'ุฏุฑุงูุช ูพุฑูฺฉุณ' ฺฉูฺฉ ฺฉูุฏ\n\n" 
    "โ๏ธ **ููู:** ููุท ุงุนุถุง ฺฉุงูุงู ูพุฑูฺฉุณ ุฏุฑุงูุช ูโฺฉููุฏ\n" 
    "๐ **ุงููุช:** ูพุฑูฺฉุณ ุฎูุฏ ุฑุง ุจุง ุฏฺฏุฑุงู ุจู ุงุดุชุฑุงฺฉ ูฺฏุฐุงุฑุฏ" 
) 
``` 
 
ุงูฺฏู ฺฉู ูพุงูโูุง: 
 
* ุฎุท ุงูู: ุนููุงู ุจุง ุงููุฌ (๐ุ ๐ุ ๐จุ โุ โุ โฆ) 
* ุจุนุฏ ุจุง **Bold** ุชูุถุญ ฺฉูุชุงู 
* ุจุนุฏ ูุฑุญููโูุง ุจุง ุฎุท ุฌุฏุฏ ู ุงููุฌ (๐ฑุ ๐ุ โ๏ธุ ๐ุ โฆ) 
* ุฏุฑ ุงูุชูุง ูุดุฏุงุฑ ุงููุช ุง ูฺฉุงุช ููู. 
 
ุงฺฏุฑ ุจุฎูุง ููููุง ุฌุฏุฏ/ูพุงูโูุง ุฎูุฏุช ุฑุง ุจุณุงุฒ ู ููโุงุณุชุงู ููู ุฑุจุงุช ุจุงุดุฏุ ุจุงุฏ ููู pattern ุฑุง ุฑุนุงุช ฺฉู. 
 
--- 
 
## ต. ฺฉุฏูู ุฑูุด ุณุงุฎุช ูพุฑูฺฉุณ ยซุจูุชุฑูยปุ ูพูฺฏ ฺฉูุชุฑ ู ุณุฑุนุช ุจุดุชุฑุ 
 
ุงูุฌุง ูููู ู ฺุฒ ุฑู ุดูุงู ุจฺฏู ๐ 
 
### ต.ฑ. ฺู ฺุฒูุง ุฑู ุณุฑุนุช ู ูพูฺฏ ุงุซุฑ ุฏุงุฑูุ 
 
* **ุฎูุฏ ุณุฑูุฑ MTProto / MTProxy**: 
 
  * ููุน ุจุงูุฑ (ูุซูุงู ููู `/opt/MTProxy/objs/bin/mtproto-proxy`)  
  * ููุงุจุน ุณุฑูุฑ (CPU, RAMุ ููุน VPS) 
  * ุฏุชุงุณูุชุฑ ู ูุณุงูุช ุชุง ฺฉุงุฑุจุฑ โ *ping ูุงูุน* 
  * ฺฉูุช ุดุจฺฉูุ packet lossุ ุดููุบ ุณุฑูุฑุ ูุญุฏูุฏุช ISP 
 
* **ุชูุธูุงุช MTProxy**: 
 
  * ุงุณุชูุงุฏู ุงุฒ `TLS fake` (ูููู domain ู secret ุจุง `ee...`) 
  * ูพูุฑุช (ดดณุ ธฐุ ธธธธุ โฆ) 
  * ุชุนุฏุงุฏ workers (`-M`) 
  * ููุน secret (`ee` vs `dd`) 
 
**ฺฉุฏ ฺฉู ููุท secret ูโุณุงุฒุฏ ู ุณุฑูุณ ุฑุง restart ูโฺฉูุฏ ุฎูุฏุด ูุณุชููุงู ุฑู ping / Mbps ุชุฃุซุฑ ููโฺฏุฐุงุฑุฏ.** 
 
### ต.ฒ. ููุงุณู ูุงูุน ุงู ุฏู ุฑูุด 
 
#### Node + ุงุณฺฉุฑูพุช (mtproxybot) 
 
ูุฒุงุง: 
 
* ูุตุจ ู ุงุณุชูุงุฏู ุณุงุฏูโุชุฑุ ูููโฺุฒ ุฑุง ุงุณฺฉุฑูพุช Bash official ููุฏู ูโฺฉูุฏ. 
* ุจุฑุง ุงุณุชูุงุฏู ุจูโุนููุงู ูพูู ุงุฏูู (ุจุฑุง ุฎูุฏุช) ุฎู ุณุฑุน ุจุงูุง ูโุขุฏ. 
 
ูุนุงุจ: 
 
* ฺฉูุชุฑู ฺฉู ุฑู ฺฉุงููฺฏ MTProxy ุงุฒ ุฏุงุฎู ุฑุจุงุชุ ููู ฺุฒ ุฏุฑ ุงุณฺฉุฑูพุช ุงุณุช. 
* ูุงุจุณุชฺฏ ุดุฏุฏ ุจู ุงุณฺฉุฑูพุช ฺฉู ุงุฒ ุงูุชุฑูุช ูโฺฉุดุ ุงฺฏุฑ ุขูพุฏุชุด ุฎุฑุงุจ ุดูุฏุ ุฑุจุงุช ูู ุจูู ูโุฑุฒุฏ. 
* ูฺ ุฏุฑฺฉ ุงุฒ ฺฉุงุฑุจุฑุงู ูุฏุงุฑูุ ููุท ยซsecretยปูุง ุฑุง ุจู ุดฺฉู ูุณุช ูโุจูุฏุ ุงุฑุชุจุงุท ุจุง join/leave ฺฉุงูุงู ูุฏุงุฑุฏ. 
 
#### Python + systemd + DB (WorkingMTProxyBot) 
 
ูุฒุงุง: 
 
* ฺฉุงููุงู **integrated** ุจุง ุณุณุชู: 
 
  * ูุณุชูู ุณุฑูุณ systemd ุฑุง ูโุฎูุงูุฏ/ูโููุณุฏ. 
  * per-user secret ุฏุงุฑุฏ (ุฏุฑ DB)ุ join/leave ฺฉุงูุงู โ auto ูุนุงู/ุบุฑูุนุงู.  
* ูุฏุฑุช ูพุดุฑูุชู: 
 
  * rate limiting ุจุฑุง ุฌููฺฏุฑ ุงุฒ abuse. 
  * ุขูุงุฑ (joins, leaves, proxies_created, errors, โฆ).  
  * ุฑุณุชุงุฑุชโฺฉุฑุฏู MTProxy ุจุง workaround ุจุฑุง `pid_max` (ูุดฺฉู ูุนุฑูู MTProxy).  
* ููฺฉ ุดุดูโุง ุฑุง ุฎูุฏุด ุทุจู ุงุณุชุงูุฏุงุฑุฏ TLS ูโุณุงุฒุฏ (`ee + secret + domain_hex`)ุ ฺฉู ุจุฑุง ุฏูุฑ ุฒุฏู DPI ูุนูููุงู ูพุงุฏุงุฑุชุฑ ุงุณุช.  
 
ูุนุงุจ: 
 
* ูพฺุฏูโุชุฑูุ ูุงุฒ ุจู ููู systemd ู Linux ุจุดุชุฑ ุฏุงุฑุฏ. 
* ุงฺฏุฑ ฺฉุณ ูุณุชูู ูุงู ุณุฑูุณ ุฑุง ุฏุณุชโฺฉุงุฑ ฺฉูุฏุ ุจุง ููุทู ุฑุจุงุช ุชุฏุงุฎู ูโุดูุฏ. 
 
### ต.ณ. ูุชุฌูโ ุตุงุฏูุงูู 
 
ุงุฒ ูุธุฑ **ุณุฑุนุช / ูพูฺฏ ุฎุงูุต**: 
 
> ูฺโฺฉุฏุงู ุงุฒ ุงู ุฏู ยซุฑูุด ุจุฑูุงููโููุณยป ุจูโุฎูุฏโุฎูุฏ ุณุฑุนุช ุจุดุชุฑ ููโุฏููุฏ. 
> ุณุฑุนุช ุฑุง *ุณุฑูุฑ ู ุชูุธูุงุช MTProxy* ุชุนู ูโฺฉููุฏุ ูู ุงูโฺฉู secret ุงุฒ Node ุณุงุฎุชู ุดุฏู ุง ุงุฒ Python. 
 
ุงูุง ุงุฒ ูุธุฑ **ูพุงุฏุงุฑ ู ฺฉูุชุฑู**: 
 
* ุงฺฏุฑ ูุฏูุช ุงู ุงุณุช ฺฉู: 
 
  * ุจู ุงุนุถุง ฺฉุงูุงู ุจูโุตูุฑุช ุฎูุฏฺฉุงุฑ ูพุฑูฺฉุณ ุจุฏู 
  * ุจุง leaveุ ุฏุณุชุฑุณโุดุงู ูุทุน ุดูุฏ 
  * ุงูฺฉุงู ูุงูุชูุฑ/ุฑุณุชุงุฑุช/ุขูุงุฑ ูโฆ ุฏุงุดุชู ุจุงุด 
 
๐ ุฑุจุงุช Python ูุงุถุญุงู **ุจูุชุฑ ู ุญุฑููโุงโุชุฑ** ุงุณุช ู ุฏุฑ ุนูู ูโุชูุงูุฏ **ุชุฌุฑุจูโ ูพุงุฏุงุฑุชุฑ** (ูุทุน ฺฉูุชุฑุ ุฎุทุง ฺฉูุชุฑ) ุจุฏูุฏุ ฺฉู ุบุฑูุณุชูู ุฑู ุฑุถุงุช ฺฉุงุฑุจุฑ ู ุงู ุญุณ ฺฉู ยซูพุฑูฺฉุณ ุฎูุจ ูุตู ูโุดูุฏยป ุชุฃุซุฑ ุฏุงุฑุฏ. 
 
ุงฺฏุฑ ููุท ฺฉ **ูพูู ุณุงุฏู ุจุฑุง ุฎูุฏุช ู ฺูุฏ ุงุฏูู** ูโุฎูุงู ฺฉู ุฑู ฺฉ MTProxy ุชููุง secret ุงุถุงูู/ฺฉู ฺฉูุฏุ Node+ุงุณฺฉุฑูพุช ฺฉูุงุช ูโฺฉูุฏ. 
 
--- 
 
## ถ. ุงุณุชุงู ููููุงุ ูพุงูโูุง ู ุงููุฌโูุง 
 
ุงูฺฏู ูุชู ุฏุฑ ุฑุจุงุช Python (ุจูโุฎุตูุต ุจุฎุดโูุง ูุงุฑุณ) ุชูุฑุจุงู ุงู ุดฺฉูู: 
 
* **ุนููุงู ุจุง ุงููุฌ** 
* ุชูุถุญ bold 
* ูุฑุญููโูุง ุจุง ุงููุฌ ุฏุฑ ุงุจุชุฏุง ุฎุท 
* ุจุฎุด ูฺฉุงุช ุงููุช ุจุง ุงููุฌ โ๏ธ ู ๐ 
* ุฏุฑ ูพุงูุ ุฏฺฉููโูุง inline ูุฑุชุจ ุดุฏู (ูุฑ ุนูู ููู ุฏุฑ ฺฉ row ุฌุฏุง). 
 
ุจุฑุง ูุซุงู ูพู ููู ฺฉุงูุงู (snippet ุจุงูุง). ููู ุงุณุชุงู ุฏุฑ: 
 
* ุขูุงุฑ ุฑุจุงุช (`๐ **ุขูุงุฑ ุฑุจุงุช**` โฆ)  
* ุฑุณุชุงุฑุช MTProxy (`๐ ุฏุฑ ุญุงู ุฑุงูโุงูุฏุงุฒ ูุฌุฏุฏโฆ`, `โ`, `โ`)  
* ุฑุจูุช VPS (`๐จ`, ูุดุฏุงุฑ ุฏู ูุฑุญููโุง)  
 
ุชู `languages.py` (ฺฉู ุงูุฌุง ูุฏุงุฑู) ูู ููู pattern ุฑุนุงุช ุดุฏูุ ูุฑ key ูุนูููุงู: 
 
* ูุณุฎู ุงูฺฏูุณ 
* ูุณุฎู ูุงุฑุณ 
* ูุชู Markdown-ready ุจุง ุงููุฌ ู bold. 
 
ุงฺฏู ุจุนุฏุงู ุฎูุงุณุช ููู/ูพุงู ุฎุงุต ุฎูุฏุช ุฑู ุจุง ููู ุงุณุชุงู ุทุฑุงุญ ฺฉููุ ูโุชูู ุจฺฏ ยซูุซูุงู ุจุฑุง ููู ุชูุธูุงุช ู ูุชู ูุซู help ููู ุฑุจุงุช ูู ุจุฑุง ููุงู ฺฉุงุฑ ูโุฎูุงูยป ู ูู ุฏููุง ุจุง ููู ูุงูุจ ู ุงููุฌโูุง ุจุฑุงุช ูโฺูู. 
 
--- 
 
### ุงฺฏุฑ ุจุฎูุงู ุฏุฑ ฺฉ ุฌููู ุฌูุนโุจูุฏ ฺฉูู: 
 
* **ุณุงุฎุช ูพุฑูฺฉุณ:** 
 
  * Node: ูุงุจุณุชู ุจู ุงุณฺฉุฑูพุช ูุตุงุจุ ุณุงุฏู ูู ูุญุฏูุฏ.  
  * Python: ฺฉูุชุฑู ฺฉุงูู ุฑู MTProxy.service + DB per-user + ููฺฉ TLS ุงุณุชุงูุฏุงุฑุฏ.  
 
* **ุณุฑุนุช/ูพูฺฏ:** 
 
  * ุนููุงู ุจู ุณุฑูุฑ ู ุชูุธูุงุช MTProxy ุจุณุชฺฏ ุฏุงุฑุฏุ ูู ุจู ุฒุจุงู/ฺฉุฏ ุจุงุช. 
 
* **ุจุฑุง ุฑุจุงุช ฺฉุงูุงู ูุงูุน ุจุง ูุฏุฑุช ุงุชููุงุชฺฉ ฺฉุงุฑุจุฑูุง โ ููู Python ุจูุชุฑู.** 
 
ุงฺฏู ุฏูุณุช ุฏุงุฑ ูุฏู ุจุนุฏ ุฑู ุจุฑุฏุงุฑูุ ูู ูโุชููู: 
 
* ฺฉ ุชูฺฉฺฉ ุชูุฒ ุจุฑุงุช ุจููุณู: 
 
  * ยซูุงู MTProxyยป 
  * ยซูุงู Bot + DBยป 
* ู ุจฺฏู ฺุทูุฑ ุงุฒ ุฑู ููู ุฑุจุงุช Pythonุ ฺฉ ูุณุฎู ูุงุชโุชุฑ (ุจุฏูู ฺฉู admin extra) ุจุฑุง ูพุฑูฺู ุฎูุฏุช ุจุณุงุฒุ ูู ุจุง ููู ุฑูุด secret + ููฺฉ ุดุดูโุง. 

ูุฎุงู ฺูุฏ ุชุง ฺุฒ ุฑู ุงุฒ ุงู ุฑุจุงุช ูุงู ูุง ฺฉูุงุฑ ุจุฐุงุฑ ู ุจุงุฑ ุฑู ุงู ูุงู ูุง ฺฉ ุจูุช ูุฏู ุงุนูุงู ฺฉู ุจุง ุงู ุชูุงูุช ฺฉู ุงู ุจุฑูุงูู ุง ฺฉ ูู ุณุงุฎุชู ูุฎุงู ุงูู ู ููู ุจุฏู ูู ูพุดูุงุฒ ูุง ุฑู ุชู ฺฉุฏ ุฏุงุดุชู ุจุงุดู ู ูู ฺฉุงุฑ ูุง ู ูุงุฒ ูุณุช ุจุนุฏ ุงุฏ ฺฉุฑุฏู ูุฑ ูุณูุช ุงุฒ ุงู ุช ูพุฑู ุฌูู ูุฑ ุงููู ูู ุฏุงุดุชู ุจุงุดู ุงุตู ุจฺฏู ูุฑ ฺฉุฏูู ุงุฒ ุงู ุฑูุด ูุง ฺฉู ุชู ุงู ุฏูุชุง ูพุฑูฺู ูุณุช ุฑูุด ูุงุด ฺู ุงุณุชูพ ูุง ุฏุงุฑู ุจุฑุง ูุตุจ ูพุฑูฺฉุณ ุงู ุช ูพุฑู ู ุงุฏ ฺฉุฑุฏู ุงูู ุงุฒ ุฑุจุงุช


ุงูฺฉุ ุงูโุจุงุฑ ุจุฑู ุฎู ููุธู ู ูุฑุญููโุง ุฌูู ๐

ุชู ุงูุขู ุฏูุชุง ยซูุฏูยป ุจุฑุง ุณุงุฎุช/ูุฏุฑุช MTProto ุฏุฏ:

1. **ูุฏู Node + ุงุณฺฉุฑูพุช ูุตุจ (mtproxybot)**
2. **ูุฏู Python + systemd + DB (WorkingMTProxyBot / telegram-proxy-specifier-bot)**

ุชู ุงู ุฌูุงุจ:

1. ูุฏูโุจูโูุฏู ูโฺฏู **ูุฑ ฺฉุฏูู ุฏููุงู ฺู ุงุณุชูพโูุง ุจุฑุง ูุตุจ MTProto ู ูุตูโฺฉุฑุฏูุด ุจู ุจุงุช ุฏุงุฑูุฏ**.
2. ุจุนุฏุด ูโฺฏู **ุจุฑุง ุจุฑูุงููโ ุฎูุฏุช** ฺูโุฌูุฑ ู **ููู ุงููู** ุทุฑุงุญ ฺฉู ฺฉู:

   * ูพุดโูุงุฒูุง ุฑู ฺฺฉ ฺฉูู
   * ุงุณุชูพโูุง ูุตุจ MTProto + ุงุชุตุงู ุจู ุฑุจุงุช ุฑู ฺฉโฺฉ ุฌูู ุจุจุฑู
     (ฺุฒ ฺฉู ุฎูุฏุช ฺฏูุช: ยซุงูู ู ููู ุจุฏูุ ูู ูพุดโูุงุฒูุงุ ูู ฺฉุงุฑูุง ฺฉู ุจุงุฏ ุงูุฌุงู ุจุดูยป).

---

## ฑ. ูุฏู ุงูู: Node.js + MTProtoProxyInstaller (mtproxybot)

### ฑ.ฑ. ุงุณุชูพโูุง ูุตุจ MTProto ุฑู ุณุฑูุฑ (ุณูุช ุณุฑูุฑ)

ฑ. **ูพุดโูุงุฒูุง ุฑู VPS**

* ุณุณุชูโุนุงูู ูููฺฉุณ (Ubuntu/Debianโฆ)
* `bash`, `curl`, `systemd`
* ูพูุฑุช ุจุงุฒ ุฑู ูุงุฑูุงู (ูุนูููุงู ดดณ)

ฒ. **ุฏุงูููุฏ ู ุงุฌุฑุง ุงุณฺฉุฑูพุช ูุตุจ MTProto**
ฺุฒ ุดุจู ุงู (ฺฉู ุชู `scripts.run` ูู ูุณุช):

```bash
curl -o MTProtoProxyInstall.sh -L https://git.io/fjo34
bash MTProtoProxyInstall.sh
```

ณ. **ูุฒุงุฑุฏ ุงุณฺฉุฑูพุช** (ุงูุฌุง interactive ุงุณุช):

* ุงูุชุฎุงุจ/ุชุฃุฏ **ูพูุฑุช**
* **secret / tag / TLS domain** (ุจุณุชู ุจู ูุณุฎู ุงุณฺฉุฑูพุช)
* ุฏุฑ ููุงุช:

  * ุจุงูุฑ MTProxy ูุตุจ ูโุดูุฏ
  * ุณุฑูุณ systemd ุณุงุฎุชู ูโุดูุฏ (ูุซูุงู `MTProxy.service`)
  * ููฺฉโูุง ุขูุงุฏู MTProto ุจูุช ูโุฏูุฏ (tg://proxy ู [https://t.me/proxy](https://t.me/proxy)).

ด. ุจุนุฏ ุงุฒ ูพุงุงู ุงุณฺฉุฑูพุชุ ุฑู ุณุฑูุฑ:

* ุณุฑูุณ MTProxy ุฏุงุฑุฏ ุฑุงู ูโุดูุฏ
* ฺฉ ุง ฺูุฏ secret ุฏุงุฎู config / ุณุฑูุณ ุซุจุช ุดุฏูโุงูุฏ
* ููฺฉ ุขูุงุฏู ุชุณุช ุฏุงุฑ.

### ฑ.ฒ. ุงุณุชูพโูุง ุงุชุตุงู ุงุฒ ุฑุจุงุช Node ุจู ุงู ูพุฑูฺฉุณ

ฑ. **ูพุดโูุงุฒูุง ุฑุจุงุช**

* Node.js (ุญุฏุงูู v14+)
* `grammY` ู `@grammyjs/menu`
* ุฏุณุชุฑุณ ุจุงุช ุชูฺฉู (`BOT_TOKEN`)
* ุชุนุฑู admin IDs ุฏุงุฎู ฺฉุฏ.

ฒ. **ุชุนุฑู ุงุณฺฉุฑูพุช ูุตุจ ุฏุฑ ฺฉุฏ**
ฺุฒ ูุซู:

```js
let scripts = {
  run: "curl -o MTProtoProxyInstall.sh -L https://git.io/fjo34 && bash MTProtoProxyInstall.sh",
};
```

3. **ุงุณุชูุงุฏู ุงุฒ `execSync` ุจุฑุง ูุฑุงุฎูุงู ุงุณฺฉุฑูพุช**
   ุจุฑุง ูุฑ ุงฺฉุดู (ูุณุช ููฺฉโูุงุ add secretุ revoke secretุ โฆ) ฺฉ ยซุดูุงุฑูยป ุจู ุงุณฺฉุฑูพุช ูโุฏูุฏ. ูุซูุงู:

   * `1` โ ููุงุด ููฺฉโูุง
   * `4` โ ุงุถุงููโฺฉุฑุฏู secret ุฌุฏุฏ
     ู ุจูโุดฺฉู ุฒุฑ ุตุฏุง ูโุฒูุฏ:

   ```js
   const { execSync } = require('child_process');

   const result = execSync(`${scripts.run} 4`, {
     input: `${username}\n1\n${secret}\n`,
   }).toString();
   ```

ด. **ุณุงุฎุช secret ุฏุฑ ุฑุจุงุช**

* ฺฉุงุฑุจุฑ ุง ุฎูุฏุด secret ูโูุฑุณุชุฏ
* ุง ุงุฒ ุฏฺฉููโ `Generate` ุงุณุชูุงุฏู ูโฺฉูุฏ โ `randomSecret()` (ณฒ ฺฉุงุฑุงฺฉุชุฑ hex)

ต. **ุงุณฺฉุฑูพุช Bashุ MTProxy ุฑุง ุขูพุฏุช ูโฺฉูุฏ**

* secret ุฑุง ุฏุฑ config/ุณุฑูุณ ุงุถุงูู ูโฺฉูุฏ
* ุงฺฏุฑ ูุงุฒู ุจุงุดุฏ MTProxy ุฑุง ุฑุณุชุงุฑุช ูโฺฉูุฏ
* ููฺฉ ููุง ุฑุง ฺุงูพ ูโฺฉูุฏ.

ถ. **ุจุงุช ููุท ุฎุฑูุฌ ุฑุง ุจู ุนููุงู ูุชู ุจู ุงุฏูู ูุดุงู ูโุฏูุฏ**

* ุงู ูพุฑูฺู **ุฎูุฏุด ููฺฉ ุดุดูโุง ููโุณุงุฒุฏ**ุ
* ููุท ุฎุฑูุฌ ุงุณฺฉุฑูพุช ุฑุง (ฺฉู ุดุงูู ููฺฉ ุดุดูโุง ุงุณุช) ุจุฑูโฺฏุฑุฏุงูุฏ.

---

## ฒ. ูุฏู ุฏูู: Python + systemd + SQLite (WorkingMTProxyBot)

ุงูุฌุง ููู ฺุฒ ยซุฎูุฏฺฉูุงยป ุฏุงุฎู ูพุฑูฺูโ ุจุงุช ุงุณุช.

### ฒ.ฑ. ุงุณุชูพโูุง ูุตุจ MTProto ุฑู ุณุฑูุฑ

ฑ. **ูพุดโูุงุฒูุง ุฑู VPS**

* ุณุณุชูโุนุงูู ูููฺฉุณ + `systemd`
* `curl`, `bash`, `iptables`/ูุงุฑูุงู ุชูุธู ุดุฏู
* ูพูุฑุช ดดณ (ุง ูุฑ ูพูุฑุช ุงูุชุฎุงุจ) ุจุงุฒ.

ฒ. **ูุตุจ MTProxy (ุงุณฺฉุฑูพุช official)**
ุชู `setup.sh` ููู ุจุงุช Pythonุ ุงฺฏุฑ MTProxy ูุตุจ ูุจุงุดุฏ:

* ุงุณฺฉุฑูพุช official ุฑุง ุฏุงูููุฏ ูโฺฉูุฏ
* ุงุฌุฑุง ูโฺฉูุฏ
* ุจุงุนุซ ูโุดูุฏ ฺฉ ุณุฑูุณ `MTProxy.service` ุง ูุดุงุจู ุณุงุฎุชู ุดูุฏ
* `ExecStart` ุดุงูู:

  * ุจุงูุฑ mtproto-proxy
  * `-S SECRET...` ูุง
  * `-H PORT`
  * `-M WORKERS`
  * `-P AD_TAG`
  * `-D TLS_DOMAIN` (ุงฺฏุฑ TLS fake ุจุงุดุฏ)
* ูพูุฑุช ุฑุง ุชุดุฎุต ูโุฏูุฏ ู ุฏุงุฎู `.env` ุฐุฎุฑู ูโฺฉูุฏ.

ณ. ุจุนุฏ ุงุฒ ุขูุ **ุณุฑูุณ MTProxy ุชูุณุท systemd ูุฏุฑุช ูโุดูุฏ** ู ููุดู ุจุง `systemctl restart MTProxy` ฺฉูุชุฑู ูโุดูุฏ.

### ฒ.ฒ. ุงุณุชูพโูุง ุงุชุตุงู ุงุฒ ุฑุจุงุช Python ุจู MTProxy

ฑ. **ูพุดโูุงุฒูุง ุฑุจุงุช**

* Python 3.9+
* `venv` + ูุตุจ `python-telegram-bot`, `paramiko` (ุงฺฏุฑ SSH ูุงุฒ ุจุงุดุฏ)ุ `python-dotenv`, โฆ
* ูุงู `.env` ุดุงูู:

  * `BOT_TOKEN`
  * `CHANNEL_ID`
  * `BOT_LANGUAGE`
  * (ุงุทูุงุนุงุช ุฏฺฏุฑ ูุซู ูุณุฑ ุณุฑูุณุ cooldown ูุงุ โฆ)

ฒ. **ุฎูุงูุฏู ุณุฑูุณ MTProxy ุงุฒ ุฑู systemd**
ฺฉูุงุณ `WorkingMTProxyBot` ฺฉุงุฑ ุดุจู ุงู ูโฺฉูุฏ:

* `/etc/systemd/system/MTProxy.service` ุง `/lib/systemd/system/MTProxy.service` ุฑุง ุจุงุฒ ูโฺฉูุฏ.
* ุฎุท `ExecStart=` ุฑุง ูพุฏุง ูโฺฉูุฏ.
* ุจุง regex ูพุงุฑุณ ูโฺฉูุฏ ุชุง:

  * ูููโ ูพุงุฑุงูุชุฑูุง `-S SECRET`
  * `-H PORT`
  * `-D TLS_DOMAIN`
  * `-M WORKERS`
    ุฑุง ุงุณุชุฎุฑุงุฌ ฺฉูุฏ.

ณ. **ุงุถุงููโฺฉุฑุฏู secret ุฌุฏุฏ ุงุฒ ุณูุช ุฑุจุงุช**

ููุช ฺฉุงุฑุจุฑ ุฌุฏุฏ ุจุงุฏ ูพุฑูฺฉุณ ุจฺฏุฑุฏ (ูุซูุงู ุนุถู ฺฉุงูุงู ุดุฏ):

1. ุฏุฑ DB ฺฺฉ ูโฺฉูุฏ ุขุง ูุจูุงู secret ุฏุงุฑุฏ ุง ูู.
2. ุงฺฏุฑ ูุฏุงุฑุฏ:

   * `secrets.token_hex(16)` โ ุชููุฏ secret ุฌุฏุฏ (ณฒ ฺฉุงุฑุงฺฉุชุฑ hex).
   * config ุณุฑูุณ ุฑุง ููุฏ ูโฺฉูุฏุ ุงฺฏุฑ secret ุฏุฑ ูุณุช ูุจูุฏุ ุจู ุขุฑุงู `secrets` ุงุถุงูู ูโฺฉูุฏ.
   * `_write_service_file(config)` โ
     ExecStart ุฌุฏุฏ ูโููุณุฏ ฺฉู ุดุงูู ุชูุงู `-S secret`โูุง ูุจู + secret ุฌุฏุฏ ุงุณุช.
   * `systemctl daemon-reload`
   * `_restart_mtproxy_service()`:

     * `systemctl stop MTProxy`
     * ุชูุธู `pid_max` (ุจุฑุง ุจุงฺฏ ูุนุฑูู MTProxy)
     * `systemctl start MTProxy`
     * ุตุจุฑ ุชุง `is-active` ุจุดูุฏ
     * ุจุฑฺฏุฑุฏุงูุฏู pid_max.
3. ุฏุฑ ุฏุชุงุจุณ SQLite ุฑฺฉูุฑุฏ user โ secret โ is_active = 1 ุซุจุช ูโุดูุฏ.

ด. **ุณุงุฎุช ููฺฉ ุดุดูโุง ุฏุฑ ุฎูุฏ ุฑุจุงุช**

ุชุงุจุน ูุซู `get_proxy_link(secret)`:

1. ุฏูุจุงุฑู ุณุฑูุณ ุฑุง ูโุฎูุงูุฏ ุชุง **port** ู **tls_domain** ุฑุง ุจุฏุงูุฏ.

2. `public_ip` ุฑุง ุจุง `curl https://api.ipify.org` ูโฺฏุฑุฏ.

3. ุงฺฏุฑ TLS ูุนุงู ุงุณุช (`tls_domain` ูุฌูุฏ ุฏุงุฑุฏ):

   * `hex_domain = tls_domain.encode('utf-8').hex().lower()`
   * `full_secret = "ee" + secret + hex_domain`

4. ุงฺฏุฑ TLS ูุณุช:

   * `full_secret = "dd" + secret`

5. ููฺฉ ููุง:

   ```text
   https://t.me/proxy?server=PUBLIC_IP&port=PORT&secret=FULL_SECRET
   ```

6. ุงู ููฺฉ ุฑุง ุฏุฑ ฺฉ **ุฏฺฉูู ุดุดูโุง** ุจุฑุง ฺฉุงุฑุจุฑ ูโูุฑุณุชุฏ.

ต. **ุญุฐู / ุบุฑูุนุงู ฺฉุฑุฏู ฺฉุงุฑุจุฑ**

ููุช ฺฉุงุฑุจุฑ ุงุฒ ฺฉุงูุงู ุฎุงุฑุฌ ูโุดูุฏ:

* ุงุฒ DB secret ุฑุง ูพุฏุง ูโฺฉูุฏ.
* ุณุฑูุณ ุฑุง ููุฏ ูโฺฉูุฏุ ุขู `-S secret` ุฑุง ุงุฒ ExecStart ุญุฐู ูโฺฉูุฏ.
* config ุฌุฏุฏ ุฑุง ูโููุณุฏ.
* Mtproxy ุฑุง ุฑุณุชุงุฑุช ูโฺฉูุฏ (ููุงู flow ูุจู).
* `is_active` ุฏุฑ DB = 0 ูโุดูุฏ.

---

## ณ. ุจุฑุง ุจุฑูุงููโ ุฎูุฏุช: ููู ุงููู + ูพุดโูุงุฒูุง + ุงุณุชูพโุจูโุงุณุชูพ

ุชู ฺฏูุช:

> ูโุฎูุงู ุจุฑูุงููโุง ฺฉู ุณุงุฎุชู ุงูู ู ููู ุจุฏูุ ูู ูพุดโูุงุฒูุง ุฑู ุชู ฺฉุฏ ุฏุงุดุชู ุจุงุดู ู ูู ฺฉุงุฑูุง ฺฉู ูุงุฒ ูุณุช. ุจุนุฏ ูุฑ ูุณูุช ุงุฒ MTProto ุฑู ุงุถุงูู ูโฺฉููุ ูุฑุญููโุจูโูุฑุญูู ุฌูู ุจุฑู.

ูู ูพุดููุงุฏ ูโฺฉูู ู **ููู ูุฒุงุฑุฏ** ุทุฑุงุญ ฺฉูู (ูุฑ ุฒุจุงู ฺฉู ุงุณุชูุงุฏู ูโฺฉูุ ููุทู ฺฉุณุงูู):

### ณ.ฑ. ููู ุงุตู (Main Menu)

ูุซูุงู ฺฏุฒููโูุง:

1. โ **ฺฺฉโฺฉุฑุฏู ูพุดโูุงุฒูุง**
2. โ๏ธ **ูุตุจ / ุชุดุฎุต MTProxy**
3. ๐ค **ุชูุธูุงุช ุฑุจุงุช (Token, Channel, ุฒุจุงูุ โฆ)**
4. ๐ **ุชุณุช ุณุงุฎุช ููฺฉ ูพุฑูฺฉุณ (admin only)**
5. ๐ฅ **ูุฏุฑุช ฺฉุงุฑุจุฑุงู ู ูพุฑูฺฉุณโูุง**

ูุฑ ฺฉุฏูู ุฎูุฏุด ฺูุฏ ูุฑุญููโ ุฏุงุฎู ุฏุงุฑุฏ.

### ณ.ฒ. ุงุณุชูพโูุง ุฏุงุฎู ููู

#### (ฑ) ฺฺฉโฺฉุฑุฏู ูพุดโูุงุฒูุง

ุจุงุช ููุช ุฑู ุงู ูโุฒู:

* ุฑู ุณุฑูุฑ ฺฺฉ ฺฉูุฏ:

  * ุณุณุชู ุนุงูู: `uname -a`
  * ูุฌูุฏ `systemd`
  * ูุตุจ ุจูุฏู `curl`, `bash`, `python3` (ุง node)
* ุงฺฏุฑ MTProxy ูุตุจ ุจุงุดุฏ:

  * ูุฌูุฏ ูุงู ุณุฑูุณ `MTProxy.service`
  * `systemctl is-active MTProxy`

ุฎุฑูุฌ ุจุฑุง ฺฉุงุฑุจุฑ (ุงุฏูู) ูุซูุงู:

* โ systemd: OK
* โ curl: OK
* โ๏ธ MTProxy: ูุตุจ ูุดุฏู (ุจุฑู ุจู ฺฏุฒูู ฒ)

#### (ฒ) ูุตุจ / ุชุดุฎุต MTProxy

ุงูุฌุง ุฏู ุญุงูุช:

* ุงฺฏุฑ ุณุฑูุณ MTProxy ููุฌูุฏ ุงุณุช:

  * ููุท config ุฑุง ูพุงุฑุณ ูโฺฉูุฏ ู ุจูุช ูุดุงู ูโุฏูุฏ:

    * IP ุณุฑูุฑ
    * ูพูุฑุช
    * TLS domain
    * ุชุนุฏุงุฏ secrets ูุนู

* ุงฺฏุฑ ุณุฑูุณ ููุฌูุฏ ูุณุช:

  * ูุซู `setup.sh` ุฑุจุงุช Python:

    * ุงุฒ ฺฉุงุฑุจุฑ ูโูพุฑุณุฏ: ยซูโุฎูุง ุฎูุฏู MTProxy ุฑู ูุตุจ ฺฉููุยป
    * ุงฺฏุฑ ุจููุ ุงุณฺฉุฑูพุช official ุฑุง ุฑู ุณุฑูุฑ ุงุฌุฑุง ูโฺฉูุฏ
    * ุจุนุฏ ุณุฑูุณ ุฑุง ุชุดุฎุต ู ุจู `.env` ุงุถุงูู ูโฺฉูุฏ.

#### (ณ) ุชูุธูุงุช ุฑุจุงุช

ุงูุฌุง ุฏุฑ ููู:

* ุงุฒ ุงุฏูู Bot Token ุฑุง ูโฺฏุฑุฏ ู ุฏุฑ `.env` ุง config ุฐุฎุฑู ูโฺฉูุฏ.
* ุงุฒุด `CHANNEL_ID` / `ADMIN_IDS` ุฑุง ูโฺฏุฑุฏ.
* ุฒุจุงู ูพุดโูุฑุถ Bot ุฑุง ุชูุธู ูโฺฉูุฏ (fa/en).
* ุฏุฑ ุงูุชูุง ุชุณุช `getMe` ูโฺฏุฑุฏ ู ุงฺฏุฑ ok ุจูุฏุ โ ูพุงู ููููุช ูโุฏูุฏ.

#### (ด) ุชุณุช ุณุงุฎุช ููฺฉ ูพุฑูฺฉุณ

ููุทู ุดุจู Python bot:

* ุงุฒ ุณุฑูุณ MTProxy ุงุทูุงุนุงุช ูโฺฏุฑุฏ (port, tls_domain).
* ฺฉ secret ุชุณุช (ูุซูุงู `test_secret`) ุชููุฏ ูโฺฉูุฏ (ุง ุงุฒ ุงุฏูู ูโูพุฑุณุฏ).
* ุณุน ูโฺฉูุฏ secret ุฑุง ุจู ุณุฑูุณ ุงุถุงูู ฺฉูุฏ ู restart ุจุฒูุฏ (ุง ุงฺฏุฑ ุฑูุด Node+installer ุงุณุชุ ุงุณฺฉุฑูพุช ุฑุง ุจุง mode test ุตุฏุง ูโุฒูุฏ).
* ููฺฉ `https://t.me/proxy?...` ุฑุง ูโุณุงุฒุฏ ู ุจุฑุง ุฎูุฏ ุงุฏูู ูโูุฑุณุชุฏ ุชุง ุฑู ฺฏูุด ุชุณุช ฺฉูุฏ.

#### (ต) ูุฏุฑุช ฺฉุงุฑุจุฑุงู ู ูพุฑูฺฉุณโูุง

ุจุนุฏ ุงุฒ ุงูโฺฉู ูุณูุชโูุง ุจุงูุง ุงูฺฉ ุดุฏ:

* ุฏฺฉููโูุง:

  * ๐ ยซุฏุฑุงูุช ูพุฑูฺฉุณยป (ุจุฑุง ูุฒุฑ ุนุงุฏ)
  * ๐ ยซุฑุณุชุงุฑุช MTProxyยป (ุงุฏูู)
  * ๐ ยซุขูุงุฑยป (ุงฺฏุฑ ุฎูุงุณุช)
  * ๐ ยซRevokeยป / ุบุฑูุนุงูโฺฉุฑุฏู ูพุฑูฺฉุณ ฺฉ ฺฉุงุฑุจุฑ

---

## ณ.ณ. ุงุณฺฉูุช ุณุงุฏู ููู ุดุฑูุน (ูุซุงู Pythonุ ููุท ุจุฑุง ุงุฏู)

> **ุงุฏุขูุฑ:** ุทุจู ุฎูุงุณุชูโ ูุจู ุชูุ ฺฉุงููุชโูุง ุฏุงุฎู ฺฉุฏ ุงูฺฏูุณ ูุณุชู.

```python
# comments MUST be English only
from telegram import InlineKeyboardMarkup, InlineKeyboardButton
from telegram.ext import Application, CommandHandler, CallbackQueryHandler

async def start(update, context):
    keyboard = [
        [InlineKeyboardButton("โ Check prerequisites", callback_data="check_prereq")],
        [InlineKeyboardButton("โ๏ธ Install/Detect MTProxy", callback_data="mtproxy_setup")],
        [InlineKeyboardButton("๐ค Bot settings", callback_data="bot_settings")],
        [InlineKeyboardButton("๐ Test proxy link", callback_data="test_proxy")],
        [InlineKeyboardButton("๐ฅ User & proxy management", callback_data="user_mgmt")],
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    await update.message.reply_text(
        "ุณูุงู ๐\n"
        "ุงุฒ ููู ุฒุฑ ุงูุชุฎุงุจ ฺฉู ุชุง ูุฑุญููโุจูโูุฑุญูู MTProto ุฑุง ุฑุงูโุงูุฏุงุฒ ฺฉูู:",
        reply_markup=reply_markup,
    )

async def menu_callback(update, context):
    query = update.callback_query
    data = query.data

    if data == "check_prereq":
        # TODO: run system checks and reply
        await query.answer()
        await query.edit_message_text("ุฏุฑ ุญุงู ฺฺฉโฺฉุฑุฏู ูพุดโูุงุฒูุง...")
    elif data == "mtproxy_setup":
        # TODO: detect or install MTProxy
        await query.answer()
        await query.edit_message_text("ุฏุฑ ุญุงู ุจุฑุฑุณ/ูุตุจ MTProxy...")
    elif data == "bot_settings":
        # TODO: guide admin to set token, channel id, etc.
        await query.answer()
        await query.edit_message_text("ุจุง ุชูุธูุงุช ุฑุจุงุช ุฑุง ุงูุฌุงู ุจุฏู...")
    # ... and so on for other options

def main():
    app = Application.builder().token("YOUR_BOT_TOKEN").build()
    app.add_handler(CommandHandler("start", start))
    app.add_handler(CallbackQueryHandler(menu_callback))

    app.run_polling()
```

ููุช ูุงูโูุง ุฎูุฏุช ุฑู ุจุฑุงู ุจูุฑุณุชุ ูโุชููู:

* ููู ุณุงุฎุชุงุฑ ููู ุฑู **ูุณุชููุงู ุฑู ฺฉุฏ ุฎูุฏุช ูพุงุฏู ฺฉูู**ุ
* ู ุจุณุชู ุจู ุงูโฺฉู ูโุฎูุง ุจู ูุฏู **Node+installer** ูุฒุฏฺฉ ุจุงุดู ุง ูุฏู **Python+systemd**ุ
  ููุทู ูุฑ ุฏฺฉูู (`check_prereq`, `mtproxy_setup`, ...) ุฑู ุจุฑ ุงุณุงุณ ฺฉ ุงุฒ ุงู ุฏู ุฑูุด ุจุฑุงุช ุจููุณู.

---

### ุฌูุนโุจูุฏ ุฎู ฺฉูุชุงู

* **Node + installer** โ ุงุณฺฉุฑูพุช ุจุฑูู ููู ฺฉุงุฑูุง ุฑู ูโฺฉููุ ุจุงุช ููุท ูุฑูุงู ูโุฏู.
* **Python + systemd + DB** โ ุฎูุฏ ุจุงุช ุณุฑูุณ MTProxy ุฑู ูโุฎููู/ูโููุณูุ per-user secret ูฺฏู ูโุฏุงุฑูุ ููฺฉ ุดุดูโุง ุฑู ุฎูุฏุด ูโุณุงุฒู.
* ุจุฑุง ุจุฑูุงููโ ุฎูุฏุชุ ููุทูู ู **ููู ูุฒุงุฑุฏ** ุฏุงุดุชู ุจุงุด ฺฉู:

  1. ูพุดโูุงุฒูุง ุฑู ฺฺฉ ฺฉูู
  2. MTProxy ุฑู ูุตุจ/ุชุดุฎุต ุจุฏู
  3. ุชูุธูุงุช ุจุงุช ุฑู ฺฉุงูู ฺฉูู
  4. ุชุณุช ุณุงุฎุช ููฺฉ ูพุฑูฺฉุณ ุฑู ุงูุฌุงู ุจุฏู
  5. ุจุนุฏุด ูุฏุฑุช ฺฉุงุฑุจุฑ ู ูพุฑูฺฉุณ ุฑู ูุนุงู ฺฉูู

ูุฑ ููุช ุขูุงุฏู ุจูุฏุ **ูุงูโูุง ูพุฑูฺูโ ุฎูุฏุช** ุฑู ุจูุฑุณุชุ ูู ุจุฑ ุงุณุงุณ ููู ุฏุฒุงูุ ูุฏูโุจูโูุฏู ุฑู ูููู ูุงูโูุง ุชุบุฑ ูุงูุน ุงุนูุงู ูโฺฉูู โ



ูุชูุฌู ุดุฏู โ ู **ุญู ฺฉุงููุงู ุจุง ุชูุณุช**.
ุจุจุฎุด ุงฺฏุฑ ุจุฑุฏุงุดุช ุงุดุชุจุงู ฺฉุฑุฏู ๐
ุงุฒ ุงู ุจู ุจุนุฏ ฺฉุงููุงู ุฏูู ูุทุงุจู **ุฑููุฏ ุชูุณุนูโุง ฺฉู ฺฏูุช** ุฌูู ูโุฑู:

# ๐ฅ ุฑููุฏ ฺฉุงุฑ ุตุญุญ ฺฉู ุชู ฺฏูุช:

1. **ุชูุงู ุงุฏุชโูุง ู ุขูพุฏุชโูุง ุฏุงุฎู ููพโุชุงูพ ููุฏูุฒุช ุงูุฌุงู ูโุฏ**
2. ุจุนุฏ ุจุง Git push ูโฺฉู ุฑู GitHub
3. ุณุฑูุฑ ููุท ูุณุฎูู GitHub ุฑู pull ุง clone ูโฺฉูู ู ุงุฌุฑุง ูโฺฉูู
   โก๏ธ ุนู **ูฺ ุชุบุฑ ูุจุงุฏ ูุณุชูู ุฑู ุณุฑูุฑ ุงูุฌุงู ุจุดู**
   โก๏ธ ุชูุงู ูุงูโูุง ู ุงุณฺฉุฑูพุชโูุง ฺฉู ูุฑุงุฑู ุณุฑูุฑ ุงุฒุดูู ุงุณุชูุงุฏู ฺฉูู
   **ุจุงุฏ ุฏุงุฎู ูพุฑูฺู (Repository) ุจุงุดู**

๐ ูพุณ ูุฑ ฺฉุงุฑ ฺฉู ูุฑุจูุท ุจู MTProxyุ ูุตุจุ ุฑุงูโุงูุฏุงุฒุ ุณุฑูุณ systemdุ ุงุณฺฉุฑูพุชโูุง ู โฆ ูุณุช
**ุจุงุฏ ูุณุชููุงู ุฏุงุฎู ูพุฑูฺูโ GitHub ุจุงุดู**
ูู ุงูฺฉู ุฏุณุช ุฑู ุณุฑูุฑ ุงุฌุฑุง ุจุดู.

# ๐ฅ ูุชุฌูโ ุงู ุญุฑู:

ุชูุงู ุฏุณุชูุฑุงุชุ ุชูุงู ูุตุจโูุงุ ุชูุงู ูุงูโูุง ูุงุฒูุ ฺฉู logic ูุงุฒู ุจุฑุง:

* ูุตุจ MTProxy
* ุฑุงูโุงูุฏุงุฒ ุณุฑูุณ MTProxy
* ุงุถุงููโฺฉุฑุฏู ูพุฑูฺฉุณ ุฌุฏุฏ
* ุญุฐู ูพุฑูฺฉุณ
* ุฑโุงุณุชุงุฑุช ูพุฑูฺฉุณ
* ุจุฑุฑุณ ูพุดโูุงุฒูุง
* ู ูุฑ ฺฉุงุฑ ฺฉู ุงุฒ ุจุงุช ุงูุฌุงู ูโุดู

**ููู ุจุงุฏ ุฏุฑูู Repository ุจุงุดู**
ู ุจุง ุงุฌุฑุง *ุฎูุฏ ุจุฑูุงูู* (ูุซูุงู setup.sh) ุงูุฌุงู ุจุดู.

---

# ๐ฅ ูพุณ ุงุฒ ุงู ูุญุธู ุจู ุจุนุฏ: ฺฉุงุฑ ุฑู ุงูุทูุฑ ุฌูู ูโุจุฑู:

## ๐น ูุงุฒ ฑ (ุงูุงู):

**ฺฉ ูุณุฎูโ ุงุตูุ ฺฉุงูู ู ุจุฏูู ููุต ุงุฒ ูุงูโูุง ุถุฑูุฑ** ูโุณุงุฒู:

* `scripts/install_mtproxy.sh`
  โ ูุตุจ ฺฉุงูู MTProxy **ุฏุงุฎู ุจุฑูุงูู**
* `scripts/create_proxy.sh`
* `scripts/new_proxy.sh`
* `scripts/delete_proxy.sh`
* `scripts/list_proxies.sh`
* `scripts/restart_mtproxy.sh`
* `setup.sh`
  โ ุงุฌุฑุง ุฎูุฏฺฉุงุฑ ููู ูพุดโูุงุฒูุง + ุณุงุฎุช ุณุฑูุณ ุฑุจุงุช + ุณุงุฎุช ุณุฑูุณ MTProxy

ุงู ูุงุฒ ููุท ฺฉ ูุฏู ุฏุงุฑุฏ:
**ุฑู ุณุฑูุฑ ููุท `setup.sh` ุฑุง ุงุฌุฑุง ฺฉู โ ูู MTProxy ูุตุจ ุดูุฏุ ูู ุฑุจุงุช โ ู ุฑุจุงุช ุจุชูุงูุฏ ูพุฑูฺฉุณ ูุงูุน ุจุณุงุฒุฏ.**

ูุงุฒ ฑ ุนู ูพุงูู ููุ ุณุชููุ ุณุงุฎุชูุงู ฺฉู ุจุนุฏุงู ุฑูุด ููู ูโุณุงุฒู.

---

## ๐น ูุงุฒ ฒ

* ุชูุฒฺฉุงุฑ ุฑูุชุงุฑ ุจุงุช
* ุณุงุฎุชุงุฑ ุงุตู ุฏฺฉููโูุง
* ููู ุณุงุฏู (Proxy list / New Proxy / Restart Proxy / Settings)

---

## ๐น ูุงุฒ ณ

* ุดุดูโุง ฺฉุฑุฏู ฺฉุงูู UI
* ุตูุญูโุจูุฏ
* Proxy 1 / Proxy 2 / Proxy 3 ูโฆ

---

## ๐น ูุงุฒ ด

* ุณุงุฎุชุงุฑ OWNER ู ุงูุฒูุฏู Admin ุฌุฏุฏ
* ููู ฺฉุงูู ุจุฑุง ฺฉุงุฑุจุฑุงู ุบุฑูุฌุงุฒ
* ยซูฺ ุฌูุงุจ ุจู ฺฉุณ ุบุฑ ุงุฒ Owner/adminยป ูุฏู

---

# ๐ฅ ุงูุงู ุจุงุฏ ฺฺฉุงุฑ ฺฉููุ

ุชู ุงูุงู ฺฏูุช:

> ุงฺฏุฑ ูโุฎูุง ูุฑ ุฏุณุชูุฑ ุจุฒูู ุฑู ุณุฑูุฑุ ุจุงุฏ ุฏุงุฎู ุจุฑูุงููโุง ฺฉู ุงุฒ ุณุฑูุฑ ุฑุงู ูุดู ุงุฏ ฺฉู

ฺฉุงููุงู ุฏุฑุณุช.
ูพุณ ุฏุฑ ุงู ูุฑุญูู ฒ ุงูุชุฎุงุจ ุฏุงุฑ:

---

## ๐ธ ุงูุชุฎุงุจ ฑ

ุจฺฏ: ยซุจุงุดูุ ูุณุฎูู ฺฉุงูู ูุงุฒ ฑ ุฑู ูููุฌุง ุจุฑุงู ุจุณุงุฒยป
ู ูู **ูุณุฎูู ฺฉุงููุ ุชูุฒ ู ุขูุงุฏูู push ุจู GitHub** ุฑู ุจุฏู:

* ูููุฏุฑ `scripts/` ฺฉุงูู
* `setup.sh` ุฏุฑุณุช
* ุงุณฺฉุฑูพุช ูุตุจ MTProxy
* ุฑุงูโุงูุฏุงุฒ ุณุฑูุณ systemd ุจุฑุง MTProxy
* ุฑุงูโุงูุฏุงุฒ ุณุฑูุณ systemd ุจุฑุง ุฑุจุงุช
* ูููู ูุงูโูุง ุจุง `chmod +x` ุงุชููุงุชฺฉ
* ุจุฏูู ูฺ ุฏุฎุงูุช ุฏุณุช ุฑู ุณุฑูุฑ

ุชู ุงูู ุฑู ููพโุชุงูพุช commit ูโฺฉู โ push โ ุฑู ุณุฑูุฑ pull ู ุงุฌุฑุง โ ูููโฺ ฺฉุงุฑ ูโฺฉูู.

---

## ๐ธ ุงูุชุฎุงุจ ฒ

ุจฺฏ: ยซูุจูุด ูุงูโูุง ูุนูู ุฑู ุจุฑุงุช ุงุฑุณุงู ฺฉูู ุชุง ุงุฒ ุฑู ููููุง ุงุตูุงุญ ฺฉูยป
ฺฉู ุงููู ูุดฺฉู ูุณุช.

---

# ๐ฅ ุขุฎุฑู ุณุคุงู ููู ูุจู ุงุฒ ุณุงุฎุช ูุณุฎูู ฺฉุงูู:

## ุขุง MTProxy ฺฉู ูโุฎูุง ุฑุจุงุช ูุตุจ ฺฉูู:

### A) **ูุณุฎู ุฑุณู Telegram MTProxy (mtproto-proxy)** ุจุงุดูุ

ุนู ููู:

[https://github.com/TelegramMessenger/MTProxy](https://github.com/TelegramMessenger/MTProxy)

ฺฉู ุจู ุตูุฑุช systemd ุงูุทูุฑ ุฑุงู ูโุดู:

```
ExecStart=/usr/local/bin/mtproto-proxy -p 443 -H 443 -S SECRET -M 1 --nat-info ...
```

ุง:

### B) **ูุณุฎูโูุง ูุฎุชูู ุฏฺฏุฑ (ูุซู ูุฒุงุง TLS fake domain)** ุฑู ูโุฎูุงุ

ุจู ูู ููุท ุจฺฏู:

# ๐ฅ MTProxy ููุฑุฏ ูุธุฑุช A ูุณุช ุง Bุ

ุจุง ุฌูุงุจ ุงู ุณุคุงูุ ูุณุฎูู ฺฉุงูู **ูุงุฒ ฑ** ุฑู ูููุฌุง ุจุฑุงุช ูโุณุงุฒู.
ููุท ุงูุชุฎุงุจ ุฑู ุจฺฏู: **A ุง Bุ**


ุฎุจ ูู ุงุฒ ฺูุฏ ุชุง ฺุช ู ฺุฒุง ูููุฏู ููู ุฑู ูุฑุฒู ุชู ูุงู ุชฺฉุณุช ุจุฎูู ุจุง ุฌูุน ุจูุฏุชู ุจุฏู  ูุฎุงู ุจุง ุญุฑูุงุช ุจุงุชู ุฑู ุชุนูุฑ ฺฉู ุงูุฌูุฑ ฺฉู ูููุฏู ุจุงุฏ ู ูพุด ูุงุฒ ุฏฺฉ ุงุฏ ฺฉู ู ูุตุจ ุงู ุช ูพุฑูฺฉุณ ูู ุจุฐุงุฑ ุฌุฒู ูพุดูุงุฒ ูุง ู ุฏุฑ ููุงุช ฺฺฉ ฺฉู ฺุฑุง ุงฺฉุซุฑู ุงุฒ ุฏฺฉูู ุดุดู ุง ุงุณุชูุงุฏู ููุดู ูุฎุตูุตู

ุฎุจ ููุดู ุฎูุฏุช ูุงู ุฑู ฺฉุงูู ุจุณุงุฒ ููุท ุฏูุชุง ูุดฺฉู ุฏฺฏ ุนฺฉุณ 
ุงูู ุงูฺฉู ูุฎุงู ุฎูุฏ ูพุฑูฺฉุณ ููฺฉุด ุฏุฑ ุฏฺฉูู ุดุดู ุง ุจุงุดู ู ุจุงุฏ ุงุณู ฺฏุฐุงุฑ ุจุดู ู proxy 1 ุจุนุฏ proxy 2 
ุฏูู ุงูฺฉู ููฺฉ ูุง ุดุดู ุง ฺฉู ูุจู ููู ุฎูุจู ุฌุฒ ุงูู ฺฉู ููุดุชู view all proxy ุจุดู proxy list
ุงูู ุชู ูู ู ูุณุช ุจุงุดู ฺฉู ููู ูพุฑูฺฉุณุง ุฑู ุจุง ุงุณู ุฑู ุฏฺฉูู ุดุดู ุง ูุดูู ุจุฏู ุฏุฑ ูุฑ ุตูุญู 9 ุชุง ุฏฺฉูู 8 ุชุง ุฏฺฉูู ุฏุฑ ุฏู ุฑุฏู ู ฺฉ ุฏฺฉูู ุชููุง ุชุง ฺฏุฒูู ุจฺฉ ุจุงุดู ฺฉ 6 ุชุง ุจุงูุง ููู ุฏฺฉูู ูุง ูพุฑูฺฉุณ ูุง ุฑูุด ุงุณู ูุงุดูู ุฑู ุจููุณู ู ุงฺฏุฑ 6 ุชุง ุฏฺฉูู ุชููุณุช ุชู  ุตูุญู ุฏุงุดุชู ุจุงุดู ุงูุฌูุฑ ุจุงุดู  ู ุฏู ุฏฺฉูู ุฒุฑ ูู ุจุนุฏ ู ูุจู ุจุงุดู ุจุฑุง ุตูุญู ูุจู ู ุจุนุฏ ุฏุงุดุชู ุจุงุดู ู ุฎูุฏุช ูฺฉ ฺฉู ุฏฺฏ ฺฉ ุฏฺฉูู ุจุฑุง ุจุฑฺฏุดุช ุจู ููู ุงุตู ุจุงุดู ุงฺฏุฑ ุจุดุชุฑ ุงุฒ 6 ุชุง ูู ุดุฏ ุจุชููู ุฏุฑ ุฏู ุตูุญู ูพุฑูฺฉุณ ูุง ุฑู ุจฺูู ุงฺฏุฑู ุชุนุฏุงุฏ ฺฉูุชุฑ ุจูุฏ ฺฏุฒูู ูุง ุจุนุฏ ู ูุจู ุบุจ ุจุดู ู ฺฉ ุฏฺฉูู ูพุงู ุจุฑฺฏุดุช ุจุงุดู ู ุฏฺฉูู ูุง ูพุฑูฺฉุณ ูุง ุชุง ุฌุง ฺฉู ูุงุฒ ูุณุช ุฏุฑ ุฏู ุฑุฏู ุงฺฏุฑ ูุงุฒ ูุดุฏ ุฏุฑ ฺฉ ุฑุฏู ฺฏุฐุงุดุชู ุจุดู ุงูฺฉุ ุจูู ุฑู ุฎูุฏุช ฺฉู ุจุฏุงูู ฺฉู
ุงฺฏุฑ ูุงุฒ ุดุฏ ุจุงุฒู ุชูุตู ูฺฉูู

ูู ูุฎุงู ุฑุจุงุชู ุฎูุฏุด ููู ฺู ูุฏุฑุช ฺฉูู ู ููุท ูุงุฒ ุจุงุดู ุจุงุฑ ุจุฑูุงูู ุฑู ูุฑุงุฎุงู ฺฉูู ู ูุงู ูุง ุฑู ูุตุจ ู ุฑุงู ุงูุฏุงุฒ ฺฉูู ุญุช ุจูู ุณุชูฺฏ ูุง ฺฉ ุชู ุจุฑูุงูู ูุณุช ุฑู ูู ูุฎุงู ุจุนุฏ ูุง ูุงุฑุฏ ุจุงุช ฺฉูู ูุซู ุงุถุงูู ฺฉุฑุฏู ูพูุฑุช ุฌุฏุฏ ุง ุงุถุงูู ุง ุชุบุฑ ุฏ ุงู ุงุณ ุงูุง ููู ุจุฑู ุชู ุณุชูฺฏ ูพุณ ูฺฉุฑ ูฺฉูู ฺฏุฒูู 2 ุจุฑุงู ุฎูุจ ุจุงุดู ุงูุง ุจุง ุงู ูุณูุช 2 ุงูฺฉ ูุจูุฏู ฺฉู ฺฏูุช "ูุฑ ฺฉุงุฑุจุฑ ฺฉ secret ูุฎุตูุต ุฎูุฏุด ุฏุงุฑุฏ" ูู ูุฎุงู ูุฑ ฺฉุงุฑุจุฑ ูุซูู ุชฺฏ ูุฎุตูุต ุฎูุฏุดู ุฏุงุดุชู ุจุงุดู ู ุงูู ุงุณู ูุฑ ูพุฑูฺฉุณ ุชฺฏุด ุจุฎูุฑู ูุซูู hproxy 1 ุจุฑุง ฺฉ ุจุงุดู zproxy 1 ุจุฑุง ูุฑุฏ ุฏฺฏุฑ ูุฑ ฺฉ ุณฺฉุฑุช ูุง ูุชูุงูุช ุฏุงุดุชู ุจุงุดู ุงูุง ุฏููู ุณฺฉุฑุช ุจู ูุฑ ููุฑ ุงุฎุชุตุงุต ูุฏุงุดุชู ุจุงุดู ู ุจุชููู ฺูุฏ ุชุง ุณฺฉุฑุช ุฏุฑุณุช ฺฉูู ู ูุดฺฉู ุงุตู ุจู ุงูุฌุง ุฎุชู ูุดู ฺฉ ฺุฌูุฑ ุชุดุฎุต ุฏุงุฏู ุจุดู ฺฉ ุงูู ฺฉุงุฑุจุฑ ฺฉ ูุณุช ู ุงู ุงูุฌูุฑ ุฌู ูุดู ฺฉ ุฑุจุงุช ู ุงููุฑ ุฏุงุฑู ู ููุท ุจู ุงูู ุฌูุงุจ ูุฏู ู ุงูู ูุชููู ูุดุฎุต ฺฉูู ฺู ุงูุฑุงุฏ ุฏฺฏ ูู ูุชููู ุงุฒ ุฑุจุงุช ุงุณุชูุงุฏู ฺฉูู ุงูฺฉุ 

ุฑุจุงุช ุจู ูฺ ูุฌู ุญุช ู ุฌููู ูู ูุฑุฏ ฺฉ ุชุนู ูุดุฏู ูุฏู ุญุช ุฑุณูพุงูุฏ ุจู ุงุณุชุงุฑุช ูู ูุฏู ุงูฺฏุงุฑ ฺฉุงุฑ ููุฏู ฺฏูุฏุ

ุนุงูุ ูพุณ ูโุฑู ุณุฑุงุบ **ูุฏู ฒ (Python + systemd + DB)** ูู ุจุง ุชูุธูุงุช ฺฉู ุฎูุฏุช ฺฏูุช:

* ุจุงุช **ฺฉุงููุงู ุตุงุญุจ MTProxy** ุจุงุดู (ูุตุจ + ูุฏุฑุช + ุงุถุงูู/ุญุฐู ุณฺฉุฑุชุ ุจุนุฏุงู ูพูุฑุช ุฌุฏุฏุ DNS ุฌุฏุฏ ู โฆ).
* ูุฑ **ุงุฏูู** ุชฺฏ ุฎูุฏุด ุฑู ุฏุงุดุชู ุจุงุดู (ูุซูุงู `hproxy`, `zproxy`) ู ูพุฑูฺฉุณโูุงุด ุงูุทูุฑ ูุงู ุจฺฏุฑู:
  `hproxy 1`, `hproxy 2`, ...ุ ู ุจุฑุง ุงุฏูู ุจุนุฏ `zproxy 1`, `zproxy 2`, ...
* ูุฑ ุงุฏูู ุจุชููู **ฺูุฏ ุชุง ุณฺฉุฑุช** ุจุณุงุฒู (ูู ููุท ฺฉ).
* ุฑุจุงุช ููุท ุจุฑุง **owner ู adminูุง ฺฉู ุชู ูุดุฎุต ูโฺฉู** ฺฉุงุฑ ฺฉููุ
  ุจุฑุง ุจูู โ ุญุช ุจู `/start` ูู ุฌูุงุจ ูุฏูุ ุงูฺฏุงุฑ ุงุตูุงู ูุฌูุฏ ูุฏุงุฑู.
* ุฏฺฉููโ ยซView all proxiesยป ุจุดู **`Proxy list`** ู ูุณุช ุฑู ุจุง ุตูุญูโุจูุฏ ุดุดูโุง ูุดูู ุจุฏู (ถ ุชุง ูพุฑูฺฉุณ + ุฏฺฉูู ุจุนุฏ/ูุจู + ุจุฑฺฏุดุช).
* ุฎูุฏ ููฺฉ ูพุฑูฺฉุณ ุฏุงุฎู **ุฏฺฉูู ุดุดูโุง** ุจุงุดูุ ุจุง ุงุณู `hproxy 1`ุ `hproxy 2` ู โฆ

ูููโ ุงูโูุง ุฑู ูโฺูู ุชู ฺฉ ุงุณฺฉูุช ูพุฑูฺูโ Python ฺฉู ูโุชูู ุฌุง Node ูุจู ุจุฐุงุฑ.
ุทุฑุญ ฺฉู ูุจูโุชุฑ ุฑูุด ุตุญุจุช ฺฉุฑุฏู ุฑู ูู ุชุจุฏู ูโฺฉูู ุจู ุณุงุฎุชุงุฑ ูุงูุน ูพุฑูฺู. 

---

## ฑ. ุณุงุฎุชุงุฑ ูพุดููุงุฏ ูพุฑูฺูโ ุฌุฏุฏ (Python)

ุงูู ุณุงุฎุชุงุฑ ุฑู ุจฺฏูุ ุจุนุฏ ฺฉุฏูุง ๐

```text
mtproxy-bot/
โโ bot/
โ  โโ bot.py               # main bot (handlers + menus)
โ  โโ config.py            # read .env (token, owner, admins, service name, ...)
โ  โโ db.py                # SQLite (admins + proxies)
โ  โโ mtproxy_manager.py   # ูุฏุฑุช MTProxy ุงุฒ ุทุฑู systemd ู ุณุฑูุณ
โ  โโ utils.py             # ฺุฒูุง ูุดุชุฑฺฉ (decoratorูุง admin-only ู ...)
โโ data/
โ  โโ mtproxy-bot.db       # ุฏุชุงุจุณ SQLite
โโ scripts/
โ  โโ install_mtproxy.sh   # ูุตุจ MTProxy official (ุงฺฏุฑ ูุจูุฏ)
โโ setup.sh                # ุงุณฺฉุฑูพุช ูุตุจ ูููโฺ (venv + req + .env + service)
โโ requirements.txt
โโ README.md
```

---

## ฒ. ฺฉุงููฺฏ: `bot/config.py`

```python
# comments MUST be English only
import os
from dataclasses import dataclass
from dotenv import load_dotenv

BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
ENV_PATH = os.path.join(BASE_DIR, ".env")

load_dotenv(ENV_PATH)


@dataclass
class Config:
    bot_token: str
    owner_id: int
    admin_ids: list[int]
    mtproxy_service: str
    mtproxy_default_port: int
    mtproxy_tls_domain: str | None
    db_path: str

    @classmethod
    def from_env(cls) -> "Config":
        token = os.getenv("BOT_TOKEN", "").strip()
        owner = int(os.getenv("OWNER_ID", "0") or "0")

        raw_admins = os.getenv("ADMIN_IDS", "").strip()
        admin_ids: list[int] = []
        if raw_admins:
            admin_ids = [int(x) for x in raw_admins.split(",") if x.strip().isdigit()]

        # Always include owner in admin list
        if owner and owner not in admin_ids:
            admin_ids.append(owner)

        service = os.getenv("MTPROXY_SERVICE_NAME", "MTProxy").strip() or "MTProxy"
        port = int(os.getenv("MTPROXY_PORT", "443") or "443")
        tls_domain = os.getenv("MTPROXY_TLS_DOMAIN", "").strip() or None

        db_path = os.getenv("DB_PATH") or os.path.join(BASE_DIR, "data", "mtproxy-bot.db")

        return cls(
            bot_token=token,
            owner_id=owner,
            admin_ids=admin_ids,
            mtproxy_service=service,
            mtproxy_default_port=port,
            mtproxy_tls_domain=tls_domain,
            db_path=db_path,
        )
```

`.env` ุจู ุงู ุดฺฉู ุฎูุงูุฏ ุจูุฏ (setup.sh ุจุฑุงุช ูโุณุงุฒู):

```env
BOT_TOKEN=123456:ABC-DEF...
OWNER_ID=111111111
ADMIN_IDS=111111111,222222222
MTPROXY_SERVICE_NAME=MTProxy
MTPROXY_PORT=443
MTPROXY_TLS_DOMAIN=your.fake.domain.com
DB_PATH=./data/mtproxy-bot.db
```

---

## ณ. ุฏุชุงุจุณ: `bot/db.py`

* ุฌุฏูู `admins`: ุงุทูุงุนุงุช owner ู adminูุง + `tag_prefix` (ูุซู `hproxy`).
* ุฌุฏูู `proxies`: ูุฑ ุณุทุฑ ฺฉ ุณฺฉุฑุช/ูพุฑูฺฉุณ ุจุง ุงุณู `label`ุ `secret`ุ `owner_admin_id` ู โฆ

```python
# comments MUST be English only
import sqlite3
from contextlib import contextmanager
from typing import Optional, List, Dict


class Database:
    def __init__(self, path: str):
        self.path = path
        self._init_db()

    @contextmanager
    def _conn(self):
        conn = sqlite3.connect(self.path)
        conn.row_factory = sqlite3.Row
        try:
            yield conn
        finally:
            conn.close()

    def _init_db(self) -> None:
        with self._conn() as conn:
            cur = conn.cursor()
            # Admins table
            cur.execute(
                """
                CREATE TABLE IF NOT EXISTS admins (
                    id INTEGER PRIMARY KEY AUTOINCREMENT,
                    telegram_id INTEGER UNIQUE NOT NULL,
                    tag_prefix TEXT,
                    display_name TEXT,
                    is_owner INTEGER DEFAULT 0,
                    is_active INTEGER DEFAULT 1,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                )
                """
            )
            # Proxies table
            cur.execute(
                """
                CREATE TABLE IF NOT EXISTS proxies (
                    id INTEGER PRIMARY KEY AUTOINCREMENT,
                    admin_id INTEGER NOT NULL,
                    label TEXT NOT NULL,
                    secret TEXT NOT NULL,
                    is_active INTEGER DEFAULT 1,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                    FOREIGN KEY(admin_id) REFERENCES admins(id)
                )
                """
            )
            conn.commit()

    # ---------- Admin helpers ----------

    def ensure_admin(self, telegram_id: int, display_name: str, is_owner: bool = False) -> int:
        with self._conn() as conn:
            cur = conn.cursor()
            cur.execute(
                "SELECT id FROM admins WHERE telegram_id = ?",
                (telegram_id,),
            )
            row = cur.fetchone()
            if row:
                return row["id"]

            cur.execute(
                """
                INSERT INTO admins (telegram_id, display_name, is_owner)
                VALUES (?, ?, ?)
                """,
                (telegram_id, display_name, 1 if is_owner else 0),
            )
            conn.commit()
            return cur.lastrowid

    def get_admin_by_telegram(self, telegram_id: int) -> Optional[sqlite3.Row]:
        with self._conn() as conn:
            cur = conn.cursor()
            cur.execute(
                "SELECT * FROM admins WHERE telegram_id = ? AND is_active = 1",
                (telegram_id,),
            )
            return cur.fetchone()

    def set_admin_tag(self, admin_id: int, tag_prefix: str) -> None:
        with self._conn() as conn:
            cur = conn.cursor()
            cur.execute(
                "UPDATE admins SET tag_prefix = ? WHERE id = ?",
                (tag_prefix, admin_id),
            )
            conn.commit()

    # ---------- Proxy helpers ----------

    def count_proxies_for_admin(self, admin_id: int) -> int:
        with self._conn() as conn:
            cur = conn.cursor()
            cur.execute(
                "SELECT COUNT(*) AS c FROM proxies WHERE admin_id = ? AND is_active = 1",
                (admin_id,),
            )
            row = cur.fetchone()
            return int(row["c"]) if row else 0

    def create_proxy(
        self,
        admin_id: int,
        label: str,
        secret: str,
    ) -> int:
        with self._conn() as conn:
            cur = conn.cursor()
            cur.execute(
                """
                INSERT INTO proxies (admin_id, label, secret)
                VALUES (?, ?, ?)
                """,
                (admin_id, label, secret),
            )
            conn.commit()
            return cur.lastrowid

    def list_proxies_for_admin(
        self,
        admin_id: int,
        offset: int = 0,
        limit: int = 6,
    ) -> List[sqlite3.Row]:
        with self._conn() as conn:
            cur = conn.cursor()
            cur.execute(
                """
                SELECT * FROM proxies
                WHERE admin_id = ? AND is_active = 1
                ORDER BY id ASC
                LIMIT ? OFFSET ?
                """,
                (admin_id, limit, offset),
            )
            return cur.fetchall()

    def total_proxies_for_admin(self, admin_id: int) -> int:
        return self.count_proxies_for_admin(admin_id)

    def get_proxy_by_id(self, proxy_id: int) -> Optional[sqlite3.Row]:
        with self._conn() as conn:
            cur = conn.cursor()
            cur.execute(
                "SELECT * FROM proxies WHERE id = ?",
                (proxy_id,),
            )
            return cur.fetchone()

    def deactivate_proxy(self, proxy_id: int) -> None:
        with self._conn() as conn:
            cur = conn.cursor()
            cur.execute(
                "UPDATE proxies SET is_active = 0 WHERE id = ?",
                (proxy_id,),
            )
            conn.commit()
```

---

## ด. ูุฏุฑุช MTProxy ุจุง systemd: `bot/mtproxy_manager.py`

ุงูโุฌุง ูุซู ูููู ุจุงุช Python ูุจูู ฺฉู ุชูุถุญ ุฏุงุฏูุ ูู ุณุงุฏูโุชุฑ ู ููุงุณุจ ุชู:
ุณุฑูุณ MTProxy ุฑู ูโุฎูููุ `-S`โูุง ุฑู ูุฏุฑุช ูโฺฉููุ ููฺฉ ุดุดูโุง ูโุณุงุฒู.

```python
# comments MUST be English only
import os
import re
import secrets
import subprocess
from dataclasses import dataclass
from typing import List, Optional

from .config import Config


SERVICE_PATHS = [
    "/etc/systemd/system",
    "/lib/systemd/system",
    "/usr/lib/systemd/system",
]


@dataclass
class MtproxyConfig:
    exec_start: str
    secrets: List[str]
    port: int
    tls_domain: Optional[str]


class MtproxyManager:
    def __init__(self, cfg: Config):
        self.cfg = cfg

    def _find_service_file(self) -> str:
        for base in SERVICE_PATHS:
            path = os.path.join(base, f"{self.cfg.mtproxy_service}.service")
            if os.path.isfile(path):
                return path
        raise FileNotFoundError(f"Service file for {self.cfg.mtproxy_service} not found")

    def _read_service_file(self) -> str:
        path = self._find_service_file()
        with open(path, "r", encoding="utf-8") as f:
            return f.read()

    def _write_service_file(self, content: str) -> None:
        path = self._find_service_file()
        with open(path, "w", encoding="utf-8") as f:
            f.write(content)

    def parse_config(self) -> MtproxyConfig:
        content = self._read_service_file()
        match = re.search(r"^ExecStart=(.+)$", content, re.MULTILINE)
        if not match:
            raise RuntimeError("ExecStart not found in service file")

        exec_start = match.group(1)
        secrets = re.findall(r"-S\s+([0-9a-fA-F]+)", exec_start)

        port = self.cfg.mtproxy_default_port
        m_port = re.search(r"-H\s+(\d+)", exec_start)
        if m_port:
            port = int(m_port.group(1))

        tls_domain = None
        m_tls = re.search(r"-D\s+(\S+)", exec_start)
        if m_tls:
            tls_domain = m_tls.group(1)

        return MtproxyConfig(
            exec_start=exec_start,
            secrets=secrets,
            port=port,
            tls_domain=tls_domain,
        )

    def _build_exec_start(self, cfg: MtproxyConfig) -> str:
        # Remove existing -S flags
        exec_cmd = re.sub(r"-S\s+[0-9a-fA-F]+\s*", "", cfg.exec_start)
        # Ensure single spaces
        exec_cmd = re.sub(r"\s+", " ", exec_cmd).strip()
        # Append all secrets
        for s in cfg.secrets:
            exec_cmd += f" -S {s}"
        return exec_cmd

    def _replace_exec_start(self, new_exec: str) -> None:
        content = self._read_service_file()
        content = re.sub(
            r"^ExecStart=.*$",
            f"ExecStart={new_exec}",
            content,
            flags=re.MULTILINE,
        )
        self._write_service_file(content)

    def restart_service(self) -> None:
        subprocess.run(["systemctl", "daemon-reload"], check=True)
        subprocess.run(["systemctl", "restart", self.cfg.mtproxy_service], check=True)

    def generate_secret(self) -> str:
        return secrets.token_hex(16)

    def add_secret(self, secret: Optional[str] = None) -> str:
        cfg = self.parse_config()
        if not secret:
            secret = self.generate_secret()
        if secret not in cfg.secrets:
            cfg.secrets.append(secret)
            new_exec = self._build_exec_start(cfg)
            self._replace_exec_start(new_exec)
            self.restart_service()
        return secret

    def remove_secret(self, secret: str) -> None:
        cfg = self.parse_config()
        if secret in cfg.secrets:
            cfg.secrets = [s for s in cfg.secrets if s != secret]
            new_exec = self._build_exec_start(cfg)
            self._replace_exec_start(new_exec)
            self.restart_service()

    def get_public_ip(self) -> str:
        try:
            out = subprocess.check_output(
                ["curl", "-4", "-s", "https://api.ipify.org"],
                text=True,
                timeout=10,
            )
            ip = out.strip()
            if ip:
                return ip
        except Exception:
            pass
        return "127.0.0.1"

    def build_proxy_link(self, secret: str) -> str:
        cfg = self.parse_config()
        server_ip = self.get_public_ip()
        port = cfg.port

        if cfg.tls_domain:
            hex_domain = cfg.tls_domain.encode("utf-8").hex().lower()
            full_secret = "ee" + secret + hex_domain
        else:
            full_secret = "dd" + secret

        return f"https://t.me/proxy?server={server_ip}&port={port}&secret={full_secret}"
```

---

## ต. utilูุง + ฺฺฉโฺฉุฑุฏู owner/admin: `bot/utils.py`

ุงูุฌุง ุดุฑุทุช ุฑู ุฏูู ูพุงุฏู ูโฺฉูู:
**ุงฺฏุฑ user ุชู ูุณุช adminูุง ูุจูุฏ โ ูฺ ูพุงูุ ูฺ ุฌูุงุจุ ุญุช ุจุฑุง `/start`** ๐

```python
# comments MUST be English only
from functools import wraps
from typing import Callable, Awaitable, Any

from telegram import Update
from telegram.ext import ContextTypes

from .config import Config
from .db import Database


def is_authorized(cfg: Config, update: Update) -> bool:
    user = update.effective_user
    if not user:
        return False
    return user.id in cfg.admin_ids


def admin_only(cfg: Config) -> Callable:
    def decorator(func: Callable[[Update, ContextTypes.DEFAULT_TYPE], Awaitable[Any]]):
        @wraps(func)
        async def wrapper(update: Update, context: ContextTypes.DEFAULT_TYPE):
            if not is_authorized(cfg, update):
                # Do not respond at all for unauthorized users
                return
            return await func(update, context)

        return wrapper

    return decorator
```

---

## ถ. ุฎูุฏ ุจุงุช: `bot/bot.py`

* `/start` ููุท ุจุฑุง owner/adminูุง.
* ููู ุงุตู ุจุง ุฏฺฉููโูุง ูุซู: `Proxy list`, `New proxy`, `Status`, `Delete proxy`, `Settings`.
* `Proxy list` โ ุตูุญูโุจูุฏ ถุชุง ุจุง ุชุฑุชุจ ุฏฺฉููโูุง ฺฉู ฺฏูุช.

```python
# comments MUST be English only
import math
import secrets

from telegram import (
    InlineKeyboardMarkup,
    InlineKeyboardButton,
    Update,
)
from telegram.ext import (
    Application,
    CommandHandler,
    CallbackQueryHandler,
    ContextTypes,
)

from .config import Config
from .db import Database
from .mtproxy_manager import MtproxyManager
from .utils import admin_only, is_authorized


PAGE_SIZE = 6  # proxies per page


class MtproxyBotApp:
    def __init__(self, cfg: Config):
        self.cfg = cfg
        self.db = Database(cfg.db_path)
        self.mt = MtproxyManager(cfg)

    # ---------- keyboards ----------

    def main_menu_keyboard(self) -> InlineKeyboardMarkup:
        keyboard = [
            [
                InlineKeyboardButton("Proxy list", callback_data="menu_proxy_list"),
                InlineKeyboardButton("New proxy", callback_data="menu_new_proxy"),
            ],
            [
                InlineKeyboardButton("Status", callback_data="menu_status"),
                InlineKeyboardButton("Delete proxy", callback_data="menu_delete_proxy"),
            ],
            [
                InlineKeyboardButton("Settings", callback_data="menu_settings"),
            ],
        ]
        return InlineKeyboardMarkup(keyboard)

    def proxy_list_keyboard(self, admin_id: int, page: int) -> InlineKeyboardMarkup:
        total = self.db.total_proxies_for_admin(admin_id)
        pages = max(1, math.ceil(total / PAGE_SIZE))
        page = max(0, min(page, pages - 1))
        offset = page * PAGE_SIZE

        proxies = self.db.list_proxies_for_admin(admin_id, offset=offset, limit=PAGE_SIZE)

        rows = []

        # Up to 6 proxies, 2 rows of 3 buttons (or fewer if not enough)
        # Each button is URL button with proxy link
        for i in range(0, len(proxies), 3):
            sub = proxies[i : i + 3]
            btn_row = []
            for p in sub:
                proxy_id = p["id"]
                label = p["label"]
                # We cannot prebuild URL without secrets; build link from secret
                proxy_link = self.mt.build_proxy_link(p["secret"])
                btn_row.append(
                    InlineKeyboardButton(text=label, url=proxy_link)
                )
            rows.append(btn_row)

        # Navigation row
        nav_row = []
        if pages > 1:
            # previous / next with page encoded
            if page > 0:
                nav_row.append(
                    InlineKeyboardButton(
                        "โฌ๏ธ Prev", callback_data=f"proxy_page:{page-1}"
                    )
                )
            if page < pages - 1:
                nav_row.append(
                    InlineKeyboardButton(
                        "Next โก๏ธ", callback_data=f"proxy_page:{page+1}"
                    )
                )

        if nav_row:
            rows.append(nav_row)

        # Back button always at bottom
        rows.append(
            [InlineKeyboardButton("๐ Back", callback_data="back_to_main")]
        )

        return InlineKeyboardMarkup(rows)

    # ---------- handlers ----------

    @admin_only_cfg := None  # placeholder, will be set after class definition
    async def start(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        user = update.effective_user
        assert user is not None

        # Ensure admin row exists
        is_owner = user.id == self.cfg.owner_id
        self.db.ensure_admin(
            telegram_id=user.id,
            display_name=user.full_name,
            is_owner=is_owner,
        )

        await update.message.reply_text(
            "ุณูุงู ๐\n"
            "ุจู ูพูู ูุฏุฑุช MTProto ุฎูุด ุงููุฏ.\n\n"
            "ุงุฒ ููู ุฒุฑ ุงูุชุฎุงุจ ฺฉู:",
            reply_markup=self.main_menu_keyboard(),
        )

    @admin_only_cfg
    async def handle_callback(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        query = update.callback_query
        if not query:
            return

        user = query.from_user
        admin_row = self.db.get_admin_by_telegram(user.id)
        if not admin_row:
            await query.answer()
            return

        admin_id = admin_row["id"]
        data = query.data or ""

        if data == "back_to_main":
            await query.answer()
            await query.edit_message_text(
                "ููู ุงุตู:",
                reply_markup=self.main_menu_keyboard(),
            )
            return

        if data == "menu_proxy_list":
            await query.answer()
            kb = self.proxy_list_keyboard(admin_id=admin_id, page=0)
            total = self.db.total_proxies_for_admin(admin_id)
            text = f"ูุณุช ูพุฑูฺฉุณโูุง ุดูุง (ุชุนุฏุงุฏ: {total}):"
            await query.edit_message_text(text, reply_markup=kb)
            return

        if data.startswith("proxy_page:"):
            page_str = data.split(":", 1)[1]
            try:
                page = int(page_str)
            except ValueError:
                page = 0
            await query.answer()
            kb = self.proxy_list_keyboard(admin_id=admin_id, page=page)
            total = self.db.total_proxies_for_admin(admin_id)
            text = f"ูุณุช ูพุฑูฺฉุณโูุง ุดูุง (ุชุนุฏุงุฏ: {total}) - ุตูุญู {page + 1}:"
            await query.edit_message_text(text, reply_markup=kb)
            return

        if data == "menu_new_proxy":
            await query.answer()
            # For simplicity: auto-generate secret and label
            await self.create_new_proxy_for_admin(query, admin_row)
            return

        # TODO: handle status, delete_proxy, settings

    async def create_new_proxy_for_admin(self, query, admin_row):
        admin_id = admin_row["id"]
        tag_prefix = admin_row["tag_prefix"]

        # If admin has no tag yet, ask them to set one
        if not tag_prefix:
            await query.edit_message_text(
                "ูููุฒ ุจุฑุง ุฎูุฏุช ุชฺฏ ุชูุธู ูฺฉุฑุฏ.\n"
                "ฺฉ ุชฺฏ ุจููุณ (ูุซูุงู hproxy ุง zproxy):\n\n"
                "ุจุนุฏ ุงุฒ ุงู ูุฑ ูพุฑูฺฉุณ ุจุง ุงู ุชฺฏ + ุดูุงุฑู ุณุงุฎุชู ูโุดูุฏ."
            )
            # You should set a flag in user_data to capture next message as tag;
            # omitted here for brevity.
            return

        # Generate secret and register in MTProxy
        secret = self.mt.add_secret()  # generates if None
        # Determine next index for this admin
        count = self.db.count_proxies_for_admin(admin_id)
        index = count + 1
        label = f"{tag_prefix} {index}"

        proxy_id = self.db.create_proxy(admin_id=admin_id, label=label, secret=secret)
        link = self.mt.build_proxy_link(secret)

        kb = InlineKeyboardMarkup(
            [
                [InlineKeyboardButton(label, url=link)],
                [InlineKeyboardButton("๐ Back", callback_data="back_to_main")],
            ]
        )

        await query.edit_message_text(
            f"ูพุฑูฺฉุณ ุฌุฏุฏ ุณุงุฎุชู ุดุฏ:\n\n"
            f"ูุงู: {label}\n"
            f"ID: {proxy_id}",
            reply_markup=kb,
        )


# Fix decorator now that Config exists
cfg_for_decorator = Config.from_env()


def admin_only_cfg(func):
    return admin_only(cfg_for_decorator)(func)


def main():
    cfg = Config.from_env()
    if not cfg.bot_token or not cfg.owner_id:
        raise RuntimeError("BOT_TOKEN or OWNER_ID not set in .env")

    app_logic = MtproxyBotApp(cfg)

    application = Application.builder().token(cfg.bot_token).build()

    # Wrap handlers with admin_only via utils
    application.add_handler(CommandHandler("start", admin_only(cfg)(app_logic.start)))
    application.add_handler(
        CallbackQueryHandler(admin_only(cfg)(app_logic.handle_callback))
    )

    application.run_polling()


if __name__ == "__main__":
    main()
```

> โ๏ธ ุชูุฌู: ุจุฑุง ุณุงุฏู ูฺฏูโุฏุงุดุชู ุฌูุงุจุ ุจุฎุดโูุง ูุซู **ฺฏุฑูุชู ุชฺฏ ุฏุฑ ุงููู ุจุงุฑุ Delete proxyุ Statusุ Settings** ุฑู TODO ฺฏุฐุงุดุชู.
> ุงูุง ุงุณฺฉูุช ุงุตู ููุทู: **owner/admin ููุท โ ุณุงุฎุช ุณฺฉุฑุช โ ุซุจุช ุฏุฑ MTProxy โ ุณุงุฎุช ููฺฉ ุดุดูโุง ุฏุงุฎู ุฏฺฉูู โ ูุณุช ุตูุญูโุจูุฏโุดุฏู** ุงูุงู ุชู ููู ูุงู ูุณุช.

---

## ท. ุงุณฺฉุฑูพุช ูุตุจ ูููโฺุฒ: `setup.sh` (ุฎูุงุตู)

ุงู ุงุณฺฉุฑูพุช ุฏููุงู ูููู ฺุฒู ฺฉู ุชู ููุชโูุงุช ููุดุชู ุจูุฏู: ูุตุจ ูพุงุชููุ venvุ requirementsุ .envุ ูุตุจ MTProxy ุงฺฏุฑ ูุจูุฏุ ุณุงุฎุช ุณุฑูุณ systemd ุจุฑุง ุจุงุช. 

```bash
#!/usr/bin/env bash
set -e

# Basic colors
GREEN="\033[32m"
YELLOW="\033[33m"
RESET="\033[0m"

echo -e "${GREEN}[*] Detecting OS and installing prerequisites...${RESET}"

if command -v apt-get >/dev/null 2>&1; then
  sudo apt-get update
  sudo apt-get install -y python3 python3-venv python3-pip curl
elif command -v yum >/dev/null 2>&1; then
  sudo yum install -y python3 python3-venv python3-pip curl
fi

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "$SCRIPT_DIR"

# Create venv
if [ ! -d "venv" ]; then
  python3 -m venv venv
fi
source venv/bin/activate

# Requirements
cat > requirements.txt <<EOF
python-telegram-bot==21.6
python-dotenv
EOF

pip install -r requirements.txt

# Ask for basic env
ENV_FILE=".env"
if [ ! -f "$ENV_FILE" ]; then
  echo -e "${YELLOW}[?] Enter bot token:${RESET}"
  read -r BOT_TOKEN
  echo -e "${YELLOW}[?] Enter owner Telegram ID:${RESET}"
  read -r OWNER_ID
  echo -e "${YELLOW}[?] Enter MTProxy service name (default MTProxy):${RESET}"
  read -r SERVICE_NAME
  SERVICE_NAME=${SERVICE_NAME:-MTProxy}

  echo "BOT_TOKEN=$BOT_TOKEN" > "$ENV_FILE"
  echo "OWNER_ID=$OWNER_ID" >> "$ENV_FILE"
  echo "ADMIN_IDS=$OWNER_ID" >> "$ENV_FILE"
  echo "MTPROXY_SERVICE_NAME=$SERVICE_NAME" >> "$ENV_FILE"
  echo "MTPROXY_PORT=443" >> "$ENV_FILE"
  echo "MTPROXY_TLS_DOMAIN=" >> "$ENV_FILE"
  echo "DB_PATH=./data/mtproxy-bot.db" >> "$ENV_FILE"
fi

mkdir -p data

# Optionally install MTProxy if not installed (stub)
if ! systemctl list-unit-files | grep -q "MTProxy.service"; then
  echo -e "${YELLOW}[!] MTProxy.service not found. You should install MTProxy first (official script).${RESET}"
  # Here you can integrate official MTProxy installer script
fi

# Create systemd service for bot
SERVICE_FILE="/etc/systemd/system/mtproxy-bot.service"
sudo bash -c "cat > $SERVICE_FILE" <<EOF
[Unit]
Description=MTProxy Manager Telegram Bot
After=network.target

[Service]
Type=simple
WorkingDirectory=$SCRIPT_DIR
ExecStart=$SCRIPT_DIR/venv/bin/python -m bot.bot
Restart=always
User=$USER
Environment=PYTHONUNBUFFERED=1

[Install]
WantedBy=multi-user.target
EOF

sudo systemctl daemon-reload
sudo systemctl enable mtproxy-bot
sudo systemctl restart mtproxy-bot

echo -e "${GREEN}[+] mtproxy-bot service is running.${RESET}"
```

---

## ธ. ุฑูุชุงุฑ ุฏุณุชุฑุณ ฺฉู ุฎูุงุณุช (ุฎู ููู)

ฺุฒ ฺฉู ุชุฃฺฉุฏ ฺฉุฑุฏ:

> ยซุฑุจุงุช ุจู ูฺ ูุฌู ุญุช ู ุฌููู ูู ูุฑุฏ ฺฉ ุชุนู ูุดุฏู ูุฏู ุญุช ุฑุณูพุงูุฏ ุจู ุงุณุชุงุฑุช ูู ูุฏู ุงูฺฏุงุฑ ฺฉุงุฑ ููุฏูยป

ุงู ุชู ฺฉุฏ ุงูโุทูุฑ ูพุงุฏู ุดุฏู:

* `admin_only(cfg)` ุฑู **ูููโ ููุฏูุฑูุง** ูพฺุฏู ุดุฏูุ ุฏุงุฎูุด:

  ```python
  if not is_authorized(cfg, update):
      return
  ```

* `is_authorized` ููุท `user.id` ุฑู ุจุง `cfg.admin_ids` ฺฺฉ ูโฺฉูู (ฺฉู ุดุงูู owner ูู ูุณุช).

* ุงฺฏุฑ user ุชู ุงู ูุณุช ูุจุงุดู:

  * ูฺ `reply_text`ุ ูฺ `answerCallbackQuery` ู ูฺ ูุงฺฏ ุณูุช ูุฒุฑ ุงุชูุงู ููโุงูุชู.
  * ุงุฒ ุจุฑููุ ุฑุจุงุช ุจุฑุง ุจูู ฺฉุงููุงู ูุฑุฏู ุจู ูุธุฑ ูโุฑุณู โ

---

## ูุฏู ุจุนุฏ ฺูุ

ุงูุขู:

* ุงุณฺฉูุช ฺฉุงูู Python + systemd + DB ุฑู ุฏุงุฑุ
* ููุทู **multi-secret per admin ุจุง ุชฺฏ ุงุฎุชุตุงุต** ุขูุงุฏู ุงุณุชุ
* ููู ุงุตู ู ููู `Proxy list` ุจุง ุตูุญูโุจูุฏ ถุชุง ู ุฏฺฉููโูุง ุดุดูโุง URL ูพุงุฏู ุดุฏูุ
* ุดุฑุท ุฏุณุชุฑุณ owner/admin ูู ุณูุช ู ูุญฺฉู ุจุณุชู ุดุฏู.

### ูพุดููุงุฏ ูู:

ฑ. ุงู ุณุงุฎุชุงุฑ ุฑู ุชู ุฑูพู ุฎูุฏุช ุจุณุงุฒ (ูโุชูู ุฑู ูููู ูพุฑูฺโูโ Node overwrite ฺฉูุ ุง ู ูููุฏุฑ ุฌุฏุฏ Python ุจุณุงุฒ).
2. ุงฺฏุฑ ุฎูุงุณุชุ ุชู ูพุงู ุจุนุฏ ุจฺฏู:

* ุชุฑุฌุญ ูโุฏ **ฺฏุฑูุชู ุชฺฏ** ฺุทูุฑ ุจุงุดูุ
  (ูุซูุงู ฺฉโุจุงุฑ `/settag hproxy` ุง ููููโุทูุฑ ฺฉู ุชู TODO ููุดุชูุ ุงูููโุจุงุฑ ฺฉู New proxy ูโุฒูู ุงุฒุด ุจูพุฑุณู.)
* ุฏูุณุช ุฏุงุฑ ููู **Delete proxy / Status / Settings** ุฏููุงู ฺู ฺฉุงุฑูุง ุงูุฌุงู ุจุฏู (ูุซูุงู ููุงุด ุชุนุฏุงุฏ ุณฺฉุฑุชโูุงุ ูุถุนุช ุณุฑูุณุ ุงุถุงููโฺฉุฑุฏู ูพูุฑุช ุฏููุ ุชุบุฑ TLS domain ูโฆ).

ูู ุทุจู ููููุ ูุฑุญููโ ุจุนุฏ ุฑู ุฑู ููู ุงุณฺฉูุช ฺฉุงููโุชุฑ ูโฺฉูู ๐

ูุงุณุชุง ูฺฏูุชู ุจุฑูุงูู ุฑู ููู ฺุดู ูพุงฺฉ ฺฉู ุฏูุจุงุฑู ุงุฒ ุงูู ุจุณุงุฒู ฺฉ ููู ฺฉ ุฏุงุฑู ุฑู ฺฺฉ ฺฉู ู ุงุฒ ูููุฌุง ุดุฑูุน ูฺฉูู ุงฺฏุฑ ูุงู ุง ฺฉุฏ ูุตูู ูุณุช ุจุฑุฑุณ ฺฉู ุชฺฉููุด ฺฉู ู ูุณุฎู ูพุงู ูุฑุณู ุจุนุฏ ูุฑู ุณุฑุงุบ ุงูฺฉู ุฎุจ ฺู ูุดฺฉูุงุช ูุณุชุ ุงูฺฉุ
ุงูุงู ุฏูุชุง ฺฉุงุฑ ุฏุงุฑ ฺฉ ฺฉ ฺฉุฏ ูุง ฺฉ ... ุฏุงุฑู ุฏุฑุณุช ฺฉู ู ุชฺฉูู ฺฉู ุฏูู ุงูฺฉู ูพุฑูฺฉุณ ุฑู ูุงุจู ุงุณุชูุงุฏู ฺฉู ู ููุช ุจุง ุจุฑูุงูู ูพุดูุงุฒ ูุง (ูุฎุตูุตู ฺฉู ุฎูุฏ ุงู ุช ูพุฑู ุฑู ุจู ูพุดูุงุฒ ูุง ุงุถุงูู ฺฉู) ุฑู ูุตุจ ฺฉูู ู ูพุฑูฺฉุณ ุฑู ูุตุจ ฺฉูู ู ูุตูุด ฺฉูู ุจู ุฑุจุงุช ุงุฒ ุฑุจุงุช ุงุฏ ูพุฑูฺฉุณ ฺฉูู ฺฉุงุฑ ฺฉูู 
ุฏุฑ ูุงุฒ ุจุนุฏ ูุฑู ฺฉ ุจุงุช ุฑู ุณุงุฎุชุงุฑ ู ููู ุงูุง ุฑู ุชูุฒ ู ุดุดู ุง ฺฉูู ู ุฏุฑ ูุงุฒ ุจุนุฏ ุงูู ูู ุณุงุฎุชุงุฑ ุงููุฑ ู ุงุฏ ฺฉุฑุฏู ฺฉุงุฑุจุฑ ุฌุฏุฏ ุจู ุจุงุช ุฑู ุงุถุงูู ูฺฉูู ุงูฺฉุ

ุญุงูุง ุฎูุฏุช ูู ฺฉู ฺฉูฺฉ ฺฉู ู ูุงุฒ ุจูุฏ ฺฉู ุงูฺฉุ

ููุธูุฑุช ุงูู ฺฉ ุงู ุงุณฺฉุฑูพุช ฺฉุงุฑ ูฺฉููุ
ูู ูฺฏู ุงูุฌูุฑู ฺฉู MTProxy ุจู ุตูุฑุช ุณุฑูุณ ุฏุฑุณุช ูุตุจ ู ูุตู ูุดุฏู ู ูุงุนุฏุชู ฺฉุงุฑ ููุฏู ุจุง ูุงู ูุง ููุฑุฏ ูุงุฒ ุฑู ุฏููู ุฏููู ู ุงูพุฏุช ุงููู ุจุฒู ฺฉู ูู ุงู MTProxy ูุตุจ ุจุดู ูู ููุช ุงุฒ ุจุงุช ุงุฏ ูฺฉู ฺฉุงุฑ ุจุฏู ุงูฺฉุ

ุจุจู ุฎุฑู ุงูู ุจุงุฑ ฺฏูุชู ุฏูุจุงุฑู ูู ูฺฏู ูู ุงูู ุงูู ุงุฒ ุทุฑู ููพุชุงูพ ููุฏูุฒู ูุงู ูุงุดู ุชฺฉูู ูฺฉูู ุจุง ุฏุณุชูุฑ ฺฏุช ููุฑุณุชู ุฑู ฺฏุชูุงุจ ู ุจุนุฏ ุงุฒ ุณุฑูุฑ ุงูู ูุฎููู ุฑููุฏ ุฑู ฺฏุฑูุชุ ูพุณ ุงฺฏ ูุฎุง ูุฑ ุฏุณุชูุฑ ุจุฒูู ุฑู ุณุฑูุฑ ุจุงุฏ ุชู ุจุฑูุงูู ุง ฺฉู ุงุฒ ุณุฑูุฑ ุฑุงู ูุดู ุงุฏ ฺฉู ููููููุุุุุ

ูููู a ู A) ูุณุฎู ุฑุณู Telegram MTProxy (mtproto-proxy) ุจุงุดูุ ุฑุณู ุจุฑู
ููุท ุฏุฑ ูพุฑุงูุชุฑ ุจฺฏู ุงู tls ฺู ู ุจุง ุงูฺฉู ูู ุจุฎุงู ุฏุงููู ูุชุตู ุจู ุณุฑูุฑู ุฑู ุจู ุนููุงู ุงุฏุฑุณ ุจุฐุงุฑู ุชุฏุงุฎู ุฏุงุฑู ุง ูุ

ุฏุฑ ูุฑ ุตุฑูุช ูููู a ุฑู ุจุฑู ููุงุชู ุจุนุฏู ูุณุฎู ูุฎุชูู ุง ุฌุฏุฏ ุชุฑ ุฑู ุจุนุฏู ุงุฏ ูฺฉูู

ูู ุงฺฏุฑ ุงู ูุณุฎู ุฑุณู ฺฉู ูฺฏ ุจุง ุงู ุณูุฑุณ ูุชูุงูุช ูุณุช ุงูุฌุงู ูุฏู
https://github.com/HirbodBehnam/MTProtoProxyInstaller

ฺูู ุงู ุณูุฑุณ ุฎู ุงู ุช ูพุฑูุด ุฎูุจู ู ูู ูุฎุงู ุงู ุงู ุช ูพุฑู ูุตุจ ุจุดู ุญุช ุจูุด ฺฉุฑุฏุช ูู ูุฏู ฺฉู ุงุฒ ุงูุฌุง ูุตุจ ูุดู

ุงูู ูุฑุงุฑ ุดุฏ ุฑู ฺฏุชูุงุจ ููู ุณุฑูุฑ ฺฏุช ุจุดู ู ุงูฺฉ ุจุดู ฺฉู ุจุฑูุงูู ุจุนุฏ ุจูุฑุณุชู ุฑู ุณุฑูุฑ ุจุนุฏุดู ุงู ฺุฒุง ฺฉู ุจุฑุง ุงู ูุฐุงุฑ ุฑู ุณุฑูุฑ ุจุฒูู ุฑู ุชู ุฎูุฏ ุจุฑูุงูู ุจุฐุงุฑ ฺฉ ุงุชููุงุณูู ุงูุง ุงูุฌุงู ุจุดู ฺูู ูุฑ ูููุน ุจุนุฏ ูุง ุฎุงุณุชู ุจุฑูุงูู ุฑู ุฑุงู ูฺฉูู ุงุณุชูุงุฏู ูุจุฑู. ูููู ฺ ูฺฏูุ

ยฺุฑุง ุงูุฌูุฑ ฺฉุฑุฏุ ุงูุงู ุจุง ูุงู ุงุตู ุจุฑูุงูู ูู ฺ ูุดฺฉู ุฏุงุฑุ ููุชููุณุช ฺฉุงุฑุงุชู ูุงุฑุฏ ูุงู ฺฉูุ ู ุงุฒ ุงูู ุงุณุชูุงุฏู ุจุดูุ 

โโโโ   โโโโโโโโโโโโโโโโโโโโ โโโโโโโ  โโโโโโโ
โโโโโ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โโโโโโโโโโโ   โโโ   โโโโโโโโโโโ  โโโโโโ  โโโโ
โโโโโโโโโโโ   โโโ   โโโโโโโโโโโ  โโโโโโ   โโโ
โโโ โโโ โโโ   โโโ   โโโ  โโโโโโโโโโโโโโโโโโโโ
โโโ     โโโ   โโโ   โโโ  โโโโโโโโโโ  โโโโโโโ
     MTPro Monitor Bot | Auto Installer

Status: Prereqs=OK  Proxy=OFF  BotToken=NOT SET

โญโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฎ
โ Main Menu                     โ
โฐโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฏ
 [1] Prerequisites Menu (install base packages, pm2)
 [2] Bot Menu (install, token, port, host/DNS, pm2 control, manual edit)
 [3] Cleanup Menu (stop, remove, clean cache)
 [0] Exit

Select an option: ^C
root@divine-hobbies:/opt/MTproMonitorbot# git pull
sudo bash setup.sh
Already up to date.
=== mtproxy-bot setup ===

[*] Marking shell scripts as executable...
[+] Script permissions set.

[!] MTProxy.service not found.
    You can install official C MTProxy using Hirbod's installer from inside this project.

Do you want to run scripts/install_mtproxy_official.sh now? [y/N]: y

[*] Running MTProxy official installer wrapper...
=== MTProxy Official Installer (Hirbod) Wrapper ===

Enter MTProxy port [443]: ^C
root@divine-hobbies:/opt/MTproMonitorbot# ^C
root@divine-hobbies:/opt/MTproMonitorbot# ^C
root@divine-hobbies:/opt/MTproMonitorbot#


ุฎุจ ุงฺฏ ูุตูู ูุจู ุจฺฏู ุฏููู ุฏููู ูุงู ูุง ุฑู ูู ุงุฑุณุงู ูฺฉูู ฺฉ ุฏุฑุณุชุด ฺฉู ุงูู ูุณุฎู ฺฉุงููุด ุญุงูุง ุจูุชุฑ ูุชูู ุฏุฑุณุชุด ฺฉู ุงู ุณู ุชุง ฺฉู ุดุงุฏ ูุงุฒุช ุดู ุจุนุฏู ูู ูุฑุณุชุงุฏู ฺฉ ุจุฏูู ฺุงุณ

ุฏุฑ ุญุงู ฺฉ ฺฉุงูู ูุตุจ ฺฉุฑุฏู 3 ุชุง ูพุด ูุฑุถ ูุง ุฑู ุงูุง ุจุงุฒู ุงุฑุงุฏ ุฏุงุฑู 

MTPro Monitor Bot | Bot Menu 
Status: Prereqs=OK  Proxy=OFF  BotToken=SET 
 
โญโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฎ 
โ Bot Menu                     โ 
โฐโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฏ 
 [1] Install / Update MTPro Monitor Bot 
 [2] Set / Change Bot Token 
 [3] Set / Change Default Proxy Port 
 [4] Configure Host / DNS for proxy links 
 [5] Start Bot (pm2) 
 [6] Stop Bot (pm2) 
 [7] Restart Bot (pm2) 
 [8] Show pm2 status 
 [9] Manual Edit (index.js, scripts, usage.json) 
 [0] Back to Main Menu 
 
Select an option: ^C 
root@divine-hobbies:/opt/MTproMonitorbot# ss -tulnp | grep 3535 
โ ุฎุงู 
โ: command not found 
root@divine-hobbies:/opt/MTproMonitorbot# ps aux | grep mtproto 
root       63898  0.0  0.0   6544  2304 pts/1    S+   03:58   0:00 grep --color=auto mtproto 
root@divine-hobbies:/opt/MTproMonitorbot# 


ู ุงูู ุงุฑูุฑ ุงุฒ ุจุงุช ูุณุช ุนฺฉุณ

ูุงูฺฉู ุญุณ ูฺฉูู ููู 2 ุชู ูุงู ุจุง ูุณูุช ูุตุจ ุงู ุช ูพุฑู ุฎูุช ุดุฏู ุฏุฑ ูู ู ูููพูุดุงู ุฒุงุฏ ุฏุงุฑู ฺูู ูุณูุช ูุง ูุณุช ฺฉ ูู ุงููุฑ ูุณุช ูู ุงูู ุทุฑู ู ุงุฏู ุง ุฏุฑููุฑุฏุด ุจุฏู ูุซู ุฎุงุณุชู ุฏ ุงู ุงุณ ุง ฺูุฌ ูพูุฑุช ุง ุงุตู ูููู ูุตุจ ุจุงุช ุฏุฑ ฺฏุฒูู 2 ููู ุงุตู ุจุนุฏ ฺฏุฒูู ุงูู ููู 2 ูุชูู ฺฉู ูุงูฺฉุดู ูุงุดู ฺฺฉ ฺฉู ูุธุฑ ุจุฏ ูุฑ ุฏู ูพูุฑุช ูุฎุงู ุงุฒ ุทุฑู ฺุฑุง ูพูุฑุช ุฏูุงูุช ุฑู ุจุงุฒ 443 ฺฏุฐุงุดุช ุงูู ุนูุถ ฺฉู ฺูู ุงุฑุงุฏ ุฏุงุฑู ุจุฐุงุฑ ุฑู 3535 ู ุงูฺฉู ฺฉุงุฑ ูู ูุฏุงุฏ ููููุทูุฑ ฺฉู ุฏุฏ ุงูู ฺฺฉ ฺฉู ฺุฑุง ูฺ ูพูุฑุช ุจุงุฒ ูฺฉุฑุฏ

ุงูฺฉุ ุงูุงู ุฏููุงู ูุนููู ุดุฏ ูุดฺฉู ฺฉุฌุงุณุช ๐

---

## ฑ. ฺ ูโฺฏู ูุงฺฏโูุง ฺฉู ูุฑุณุชุงุฏุ

```bash
sudo systemctl status MTProxy -l
Unit MTProxy.service could not be found.
```

ุนู **ูฺ ุณุฑูุณ ุจู ุงุณู MTProxy ูุตุจ ูุดุฏู**.

ู `new_proxy.sh` ูู:

```bash
Error: mtconfig.conf not found at /opt/MTProxy/objs/bin/mtconfig.conf
Make sure you have installed MTProxy using MTProtoProxyOfficialInstall.sh
```

ุงู ุฏููุงู ูููู ฺุฒู ฺฉู ุงุณฺฉุฑูพุช ุฎูุฏููู ุฏุงุฑู ุจูุช ูโฺฏู:
**ูููุฒ MTProxy ุฑุณู (ูุณุฎู Hirbod) ุฑู ุงู ุณุฑูุฑ ูุตุจ ูุดุฏู**ุ
ูพุณ ุทุจุนู ูุฑ ุจุงุฑ ฺฉู ูโุฎูุง ูพุฑูฺฉุณ ุฌุฏุฏ ุจุณุงุฒุ ุฎุทุง ุจุฏู ู ุชู ุชูฺฏุฑุงู ุงูู ูพุงู ูุฑูุฒ ุฑู ุจุจู.

ุณู ุชุง ยซูพุดโูุฑุถยป/Prereq ฺฉู ุชู ุงุฒ ููู ูุตุจ ฺฉุฑุฏ (packagesุ pm2ุ ุฎูุฏ bot)
ูฺโฺฉุฏูู ุฎูุฏ MTProxy ุฑู ูุตุจ ููโฺฉูู ุชุง ููุช **ุงูู ฺฏุฒููโ ูุตุจ MTProxy ุฑู ูู ฺฉ ุจุงุฑ ุชุง ุขุฎุฑ ุงุฌุฑุง ูฺฉู**.

ุงูุงู ูุถุนุช ูุงูุน:

* โ `MTProxy.service` ูุฌูุฏ ูุฏุงุฑู
* โ `/opt/MTProxy/objs/bin/mtconfig.conf` ูุฌูุฏ ูุฏุงุฑู
* ๐ต ูพุณ ุทุจุนู `new_proxy.sh` ู ุจุงุช ููุฏโุงุช ุฒูุฑ ุงูฺฉ ูโุฒูู.

---

## ฒ. ูุฏู ุงูู: ฺฉ ุจุงุฑ *ูุงูุน* MTProxy ุฑุณู ุฑู ูุตุจ ฺฉู

ูฺฉุชู ููู:
ุงู ฺฉุงุฑ ฺฉู ูโฺฏู ูู ุฏุงุฎู **ุจุฑูุงูู ุฎูุฏุช** ุงูุฌุงู ูโุดู (ุงุฒ ููู mtpromonitor)ุ
ูู ุฏููุง ุงุฒ **ูููู ุณูุฑุณ Hirbod** ุงุณุชูุงุฏู ูโฺฉูู ฺฉู ุฎูุฏุช ุฎูุงุณุชู ุจูุฏุ
ูู ููุท ู wrapper ุฏูุฑุด ฺฏุฐุงุดุชู ฺฉู ูุดูฺฏ ุชู ุจุฑูุงููโุงุช ุฌุง ุจฺฏุฑู.

### ุฑู ุณุฑูุฑุ ุงู ฺฉุงุฑ ุฑู ุจฺฉู:

```bash
cd /opt/MTproMonitorbot
bash mtpromonitor.sh
```

ุจุนุฏ:

1. ุงุฒ **Main Menu** ุจุฑู ุฑู:

   * ฺฏุฒูู ฑ โ `Prerequisites Menu`
2. ุฏุงุฎู Prerequisites ุจุฑ ุฑู:

   * ฺฏุฒูู ณ โ `Install official MTProxy (Hirbod MTProtoProxyInstaller)`
     (ูููู ุชุงุจุน `install_mtproxy_official_menu` ฺฉู ุชู ูุงู ุฎูุฏุช ุงุถุงููโุงุด ฺฉุฑุฏู)

ุงุณฺฉุฑูพุช `scripts/install_mtproxy_official.sh` ุจุงุฒ ูโุดู ู ุงุฒุช ูโูพุฑุณู:

* ูพูุฑุช โ ุงูโุฌุง ุนุฏุฏ **ณตณต** ุฑู ุจุฏู
* TLS domain โ ุงฺฏุฑ ุฏุงููู ุฏุงุฑ (ูุซูุงู `proxy.mydomain.com`) ูโุฎูุง fake TLS ุจุงุดูุ ูููู ุฑู ุจุฏูุ
  ุงฺฏุฑ ููโุฎูุง ูุนูุงูุ ุฎุงู ุจุฐุงุฑ ู ููุท Enter ุจุฒู.

ูฺฉุชู ููู:
๐ **ุฏฺฏู ุงูุฌุง Ctrl+C ูุฒู** ูุซู ุฏูุนู ูุจูุ
ุจุฐุงุฑ ุงุณฺฉุฑูพุช Hirbod ุชุง ุขุฎุฑ ุงุฌุฑุง ุจุดู ู ุจุฑฺฏุฑุฏู ุจู ููู.

ุจุนุฏ ุงุฒ ุงู ฺฉุงุฑุ ุจุงุฏ ุฑู ุณุฑูุฑ ุงู ุฏูุชุง ุฏุฑุณุช ุดุฏู ุจุงุดู:

```bash
sudo systemctl status MTProxy -l    # โ ุจุงุฏ ุณุฑูุณ ุฑู ุจุจูุ ู ideally active
ls /opt/MTProxy/objs/bin/mtconfig.conf
```

ุงฺฏุฑ ุงูุงู:

* `status` ุณุฑูุณ ุฑู ูุดูู ุจุฏู (ุญุช ุงฺฏุฑ `active` ูุจุงุดูุ ููู ุงูู Unit ูพุฏุง ุจุดู)
* ู `mtconfig.conf` ูุงูุนุงู ูุฌูุฏ ุฏุงุดุชู ุจุงุดู

ุงูู ูููุน ุชุงุฒู `new_proxy.sh` ู ุดุงูุณ ุฏุงุฑู ุฏุฑุณุช ฺฉุงุฑ ฺฉูู.

---

## ณ. ุชุณุช ูุฌุฏุฏ ุงุณฺฉุฑูพุช ุณุงุฎุช ูพุฑูฺฉุณ ุจุนุฏ ุงุฒ ูุตุจ

ุจุนุฏ ุงุฒ ุงูฺฉู ุจุงูุง ูุทูุฆู ุดุฏ MTProxy ูุตุจ ุดุฏู:

```bash
cd /opt/MTproMonitorbot
sudo ./scripts/new_proxy.sh
```

ุณู ุญุงูุช:

1. **ฺฉ ุฎุท ูุซู ุงู ุฏุฏ**:

   ```text
   1 aabbccddeeff00112233445566778899 3535 proxy-1 tg://proxy?server=...&port=3535&secret=dd...
   ```

   ุนู backend ุฏุฑุณุช ฺฉุงุฑ ฺฉุฑุฏ โ
   ุจุนุฏ ูโุชูู ูููู ููฺฉ ุฑู ุงุฒ ุชุฑููุงู ฺฉูพ ฺฉูุ ุชู ุชูฺฏุฑุงู ุจุฒู ุจุจู ูุตู ูโุดู ุง ูู.
   ุงฺฏุฑ ูุตู ุดุฏ โ ูุดฺฉู ุจุงุช นฐูช ุญู ุดุฏูุ ููุท ุจุงุฏ ฺฺฉ ฺฉูู `index.js` ุฏุฑุณุช parse ูโฺฉูู.

2. ุฏูุจุงุฑู ุงุฑูุฑ `mtconfig.conf not found` ฺฏุฑูุช โ ุนู ูุตุจ ุฑุณู ูููุฒ ุฏุฑุณุช ุงูุฌุงู ูุดุฏู (ูุฏู ฒ ูุตูู ูููุฏู).

3. ุงุฑูุฑ ุฏฺฏูโุง ฺฏุฑูุช (ูุซูุงู `systemctl restart MTProxy` failed ุง `Bad configuration`) โ
   ุงูู ูููุน ูุชู ูููู ุงุฑูุฑ ุฑู ุจูุฑุณุช ฺฉู ุจุฏููู config ฺุทูุฑ ุฎุฑุงุจ ุดุฏู.

---

## ด. ุฌูุงุจ ุจู ุณุคุงูโูุงุช ุฏุฑุจุงุฑู ููู ู ูพูุฑุช ณตณต

### ด.ฑ. ยซฺุฑุง Proxy=OFF / ูุถุนุช ุณุฑูุณ ูุงูุดุฎุตุยป

ุชุง ููุช `MTProxy.service` ุงุตูุงู ูุฌูุฏ ูุฏุงุฑูุ
ููุทู ุงุณฺฉุฑูพุชโุช ุชู ุจุฎุด ูุถุนุช ุทุจุนโู ฺฉู ุจฺฏู:

* `Proxy=OFF`
* ุง ยซmtproxy: ูุดุฎุต ูุณุชยป

ุจุนุฏ ุงุฒ ูุตุจ ุฑุณู ฺฉู ุจุงูุง ฺฏูุชู:

* `systemctl list-unit-files | grep MTProxy` ุจุงุฏ ุงุณู ุณุฑูุณ ุฑู ูุดูู ุจุฏู
* ูโุชููู ููููโุฌุง ููุทู ุชุดุฎุต ุฑู ุฑู ุงุณู **`MTProxy`** ุณุช ฺฉูู (ูู `mtproxy` ฺฉูฺฺฉ) ุชุง Status ุฏููโุชุฑ ุจุดู โ ุงู ุฑู ูโุฐุงุฑู ุจุฑุง ุจุนุฏ ุงุฒ ุงูฺฉู ุณุฑูุณ ุจุงูุง ุงููุฏุ ฺูู ุงูุงู ุงุตูุงู unit ูุฏุงุฑ ฺฉู ุชุณุช ฺฉูู.

### ด.ฒ. ยซฺุฑุง ูููุฒ ุฌุง 443 ูโุจูู ู ฺุฑุง 3535 ุฑู ฺฏุฐุงุดุช ูู ฺฉุงุฑ ูุฏุงุฏุยป

ุณูโุชุง ุฌุง ูุฎุชูู ูพูุฑุช ุฏุงุฑู:

* ูพูุฑุช ุฏุงุฎู MTProxy ุชู `mtconfig.conf` (ฺฉู installer ุฑุณู ุณุช ูโฺฉูู)
* `data/default_port` ฺฉู ุจุงุช ุงุฒุด ุจูโุนููุงู ยซูพูุฑุช ูพุดููุงุฏยป ุงุณุชูุงุฏู ูโฺฉูู
* fallback ุฏุงุฎู `install_mtproxy_official.sh` ฺฉู ุงฺฏุฑ ูุงู ูุจูุฏุ ูุจูุงู ดดณ ุจูุฏ (ูู ููููโุฌุง ุงุดุชุจุงู ฺฉุฑุฏู ุจุงุฏ ุงุฒ ุงูู ุจุฑุงุช ุฑู ณตณต ูโุฐุงุดุชู)

ุงูุงู ุจุฑุง ุงูฺฉู ููู sync ุจุดู:

* ุชู `scripts/install_mtproxy_official.sh` ููุฏุงุฑ `DEFAULT_PORT` ุฑู ุจฺฏุฐุงุฑ `3535`
* ูุทูุฆู ุดู ูุงู `data/default_port` ูู ุฏุงุฎูุด ููุท ููุดุชู: `3535`
* ุจุนุฏ ูุตุจ ุฑุณู (ูุฏู ฒ) ุฑู ุงูุฌุงู ุจุฏู ุชุง ุฎูุฏ MTProxy ูู ุฑู ณตณต ุชูุธู ุจุดู.

ุจุนุฏ ุงุฒ ุงูู:

```bash
sudo ss -tulnp | grep 3535
```

ุจุงุฏ ู ุฎุท mtproto/MTProxy ูุดูู ุจุฏู ฺฉู ุฑู ณตณต ฺฏูุด ูโุฏู.

---

## ต. ุฏุฑ ููุฑุฏ ูุงุทโุดุฏู ููููุง (Bot Menu vs ูุตุจ MTProxy)

ุญุฑูุช ฺฉุงููุงู ุฏุฑุณุชู:

* ุงูุงู ูู ุฏุฑ **Prerequisites** ุฏุงุฑู ูุตุจ MTProxy
* ูู ุชู **Bot Menu** ฺุฒูุง ูุซู ุชูุธู ูพูุฑุชุ DNS ูโฆ
* ุญุณ ยซูููพูุดุงูยป ูโุฏู.

ูู ูู ุจุงูุงุช ููโูุธุฑ ูุณุชู ฺฉู ุจุงุฏ:

* ูุตุจ MTProxy + ูพฺฉุฌโูุง ุชู ฺฉ ุจุฎุด ยซServer / Proxy Setupยป ุจุงุดู
* ุชูุธู token / default_port / DNS ุชู ยซBot Setupยป
* ุจุนุฏุงู ฺฉ ููู ุฌุฏุง ุจุฑุง ยซProxy Managementยป (ูุณุชุ ุณุงุฎุชุ ุญุฐูุ ุขูุงุฑ) ุจุณุงุฒู.

ูู ุงูุงู ุงฺฏุฑ ูุงุฑุฏ ุฑูฺฉุชูุฑ ููููุง ุจุดูุ ูุณุทุด backend ูููุฒ ูุตุจ ูุดุฏูุ ููุท ฺฏุฌโุชุฑ ูโุดู.
ุจุฑุง ููู ุจุนุฏ ุงุฒ ุงูฺฉู:

โ `MTProxy.service` ูุงูุนุงู ูุตุจ ู ูุนุงู ุดุฏ
โ `scripts/new_proxy.sh` ุจุง ุฏุณุช ฺฉ ูพุฑูฺฉุณ ูุงูุน ุณุงุฎุช

ุงููโููุช ุจุง ุฎุงู ุฑุงุญุช ููููุง ุฑู ุชูุฒ ูโฺฉูู ู ฺุฒูุง duplicate ุฑู ุงุฒ Bot Menu ุฏุฑูโุขุฑู.

---

## ถ. ุฎูุงุตูู ฺฉุงุฑูุง ฺฉู ุงูุงู ุจุงุฏ ุจฺฉู

1. **ูุตุจ ูุงูุน MTProxy ุฑุณู (ฺฉ ุจุงุฑ ุชุง ุขุฎุฑ)**

   * ุงุฒ `mtpromonitor.sh` โ Prerequisites โ ฺฏุฒูู ูุตุจ MTProxy
   * ูพูุฑุช = ณตณต
   * TLS domain: ูุฑฺ ูโุฎูุง / ุฎุงู
   * ุตุจุฑ ฺฉู ุชุง ุงุณฺฉุฑูพุช ฺฉุงูู ุชููู ุจุดู (ุจุฏูู Ctrl+C)

2. ุจุนุฏ ุฑู ุณุฑูุฑ ฺฺฉ ฺฉู:

   ```bash
   sudo systemctl status MTProxy -l
   ls /opt/MTProxy/objs/bin/mtconfig.conf
   ```

3. ุงฺฏุฑ ุงูโูุง ุงูฺฉ ุจูุฏ:

   ```bash
   cd /opt/MTproMonitorbot
   sudo ./scripts/new_proxy.sh
   ```

   ู ุฎุฑูุฌ / ุฎุทุง ุฑู (ูุฑฺ ูุณุช) ุงูโุฌุง ุจุฑุงู ุจูุฑุณุช.
   ุงูู ุฎุฑูุฌุ ูุทุน ุจูู ูโฺฏู ูุฑุญูู ุจุนุฏ ฺฉุฏูู ุชฺฉู ุฑู ุจุงุฏ ุฏุฑุณุช ฺฉูู
   (configุ ุณุฑูุณุ ุง parse ุชู bot).

ุงุฒ ุงูุฌุง ุจู ุจุนุฏ ุฏฺฏู ุญุฑู ุงุฒ setup.sh ู ฺุฒ ุฌุฏุง ูุณุชุ
ูููโฺุฒ ุฏุงุฑู ุชู ุฎูุฏ **ุจุฑูุงููโ ุงุตู ุฎูุฏุช** (`mtpromonitor.sh` + scripts) ูโฺุฑุฎูุ
ู ููุท ุฏุงุฑู ูุทูุฆู ูโุดู ยซู ุจุงุฑ ุฏุฑุณุช MTProxy ูุตุจ ุจุดูยป ุชุง ุจููโุงุด ูุฏูโุจูโูุฏู ุฏุจุงฺฏ ฺฉูู ๐ช

MTPro Monitor Bot | MTProxy Install
Status: Prereqs=OK  Proxy=OFF  BotToken=SET

โญโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฎ
โ Install Official MTProxy       โ
โฐโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฏ

This will run the official C MTProxy installer by Hirbod (MTProtoProxyInstaller).
You will be asked for port and (optional) TLS domain inside that script.

Continue and run installer now? [y/N]: y
=== MTProxy Official Installer (Hirbod) Wrapper ===

Enter MTProxy port [3535]: 3535
Enter TLS domain (fake TLS host, empty to disable):

Port      : 3535
TLS domain: <none>

Press ENTER to start installation using Hirbod script...
sudo systemctl status MTProxy -l    # โ ุจุงุฏ ุณุฑูุณ ุฑู ุจุจูุ ู ideally active
ls /opt/MTProxy/objs/bin/mtconfig.conf
Unit MTProxy.service could not be found.
ls: cannot access '/opt/MTProxy/objs/bin/mtconfig.conf': No such file or directory
root@divine-hobbies:/opt/MTproMonitorbot# ^C
root@divine-hobbies:/opt/MTproMonitorbot# cd /opt/MTproMonitorbot
sudo ./scripts/new_proxy.sh
Error: mtconfig.conf not found at /opt/MTProxy/objs/bin/mtconfig.conf
Make sure you have installed MTProxy using MTProtoProxyOfficialInstall.sh
root@divine-hobbies:/opt/MTproMonitorbot# sudo ss -tulnp | grep 3535
root@divine-hobbies:/opt/MTproMonitorbot# sudo systemctl status MTProxy -l
ls /opt/MTProxy/objs/bin/mtconfig.conf
Unit MTProxy.service could not be found.
ls: cannot access '/opt/MTProxy/objs/bin/mtconfig.conf': No such file or directory
root@divine-hobbies:/opt/MTproMonitorbot# cd /opt/MTproMonitorbot
sudo ./scripts/new_proxy.sh
Error: mtconfig.conf not found at /opt/MTProxy/objs/bin/mtconfig.conf
Make sure you have installed MTProxy using MTProtoProxyOfficialInstall.sh
root@divine-hobbies:/opt/MTproMonitorbot#


